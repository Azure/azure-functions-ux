//! Copyright (c) Microsoft Corporation. All rights reserved. azure-mobile-apps-client v2.0.1
!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.WindowsAzure=f()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){(function(Buffer,process){function _capitalize(str){return str.charAt(0).toUpperCase()+str.slice(1)}function _toss(name,expected,oper,arg,actual){throw new assert.AssertionError({message:util.format("%s (%s) is required",name,expected),actual:void 0===actual?typeof arg:actual(arg),expected:expected,operator:oper||"===",stackStartFunction:_toss.caller})}function _getClass(arg){return Object.prototype.toString.call(arg).slice(8,-1)}function noop(){}function _setExports(ndebug){var out,keys=Object.keys(types);return out=process.env.NODE_NDEBUG?noop:function(arg,msg){arg||_toss(msg,"true",arg)},keys.forEach(function(k){if(ndebug)return void(out[k]=noop);var type=types[k];out[k]=function(arg,msg){type.check(arg)||_toss(msg,k,type.operator,arg,type.actual)}}),keys.forEach(function(k){var name="optional"+_capitalize(k);if(ndebug)return void(out[name]=noop);var type=types[k];out[name]=function(arg,msg){void 0!==arg&&null!==arg&&(type.check(arg)||_toss(msg,k,type.operator,arg,type.actual))}}),keys.forEach(function(k){var name="arrayOf"+_capitalize(k);if(ndebug)return void(out[name]=noop);var type=types[k],expected="["+k+"]";out[name]=function(arg,msg){Array.isArray(arg)||_toss(msg,expected,type.operator,arg,type.actual);var i;for(i=0;i<arg.length;i++)type.check(arg[i])||_toss(msg,expected,type.operator,arg,type.actual)}}),keys.forEach(function(k){var name="optionalArrayOf"+_capitalize(k);if(ndebug)return void(out[name]=noop);var type=types[k],expected="["+k+"]";out[name]=function(arg,msg){if(void 0!==arg&&null!==arg){Array.isArray(arg)||_toss(msg,expected,type.operator,arg,type.actual);var i;for(i=0;i<arg.length;i++)type.check(arg[i])||_toss(msg,expected,type.operator,arg,type.actual)}}}),Object.keys(assert).forEach(function(k){return"AssertionError"===k?void(out[k]=assert[k]):ndebug?void(out[k]=noop):void(out[k]=assert[k])}),out._setExports=_setExports,out}var assert=_dereq_("assert"),Stream=_dereq_("stream").Stream,util=_dereq_("util"),UUID_REGEXP=/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/,types={bool:{check:function(arg){return"boolean"==typeof arg}},func:{check:function(arg){return"function"==typeof arg}},string:{check:function(arg){return"string"==typeof arg}},object:{check:function(arg){return"object"==typeof arg&&null!==arg}},number:{check:function(arg){return"number"==typeof arg&&!isNaN(arg)}},finite:{check:function(arg){return"number"==typeof arg&&!isNaN(arg)&&isFinite(arg)}},buffer:{check:function(arg){return Buffer.isBuffer(arg)},operator:"Buffer.isBuffer"},array:{check:function(arg){return Array.isArray(arg)},operator:"Array.isArray"},stream:{check:function(arg){return arg instanceof Stream},operator:"instanceof",actual:_getClass},date:{check:function(arg){return arg instanceof Date},operator:"instanceof",actual:_getClass},regexp:{check:function(arg){return arg instanceof RegExp},operator:"instanceof",actual:_getClass},uuid:{check:function(arg){return"string"==typeof arg&&UUID_REGEXP.test(arg)},operator:"isUUID"}};module.exports=_setExports(process.env.NODE_NDEBUG)}).call(this,{isBuffer:_dereq_("../is-buffer/index.js")},_dereq_("_process"))},{"../is-buffer/index.js":32,_process:34,assert:2,stream:50,util:54}],2:[function(_dereq_,module,exports){function replacer(key,value){return util.isUndefined(value)?""+value:util.isNumber(value)&&!isFinite(value)?value.toString():util.isFunction(value)||util.isRegExp(value)?value.toString():value}function truncate(s,n){return util.isString(s)?s.length<n?s:s.slice(0,n):s}function getMessage(self){return truncate(JSON.stringify(self.actual,replacer),128)+" "+self.operator+" "+truncate(JSON.stringify(self.expected,replacer),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}function ok(value,message){value||fail(value,!0,message,"==",assert.ok)}function _deepEqual(actual,expected){if(actual===expected)return!0;if(util.isBuffer(actual)&&util.isBuffer(expected)){if(actual.length!=expected.length)return!1;for(var i=0;i<actual.length;i++)if(actual[i]!==expected[i])return!1;return!0}return util.isDate(actual)&&util.isDate(expected)?actual.getTime()===expected.getTime():util.isRegExp(actual)&&util.isRegExp(expected)?actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase:util.isObject(actual)||util.isObject(expected)?objEquiv(actual,expected):actual==expected}function isArguments(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function objEquiv(a,b){if(util.isNullOrUndefined(a)||util.isNullOrUndefined(b))return!1;if(a.prototype!==b.prototype)return!1;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;var aIsArgs=isArguments(a),bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return!1;if(aIsArgs)return a=pSlice.call(a),b=pSlice.call(b),_deepEqual(a,b);var key,i,ka=objectKeys(a),kb=objectKeys(b);if(ka.length!=kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!=kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!_deepEqual(a[key],b[key]))return!1;return!0}function expectedException(actual,expected){return!(!actual||!expected)&&("[object RegExp]"==Object.prototype.toString.call(expected)?expected.test(actual):actual instanceof expected||!0===expected.call({},actual))}function _throws(shouldThrow,block,expected,message){var actual;util.isString(expected)&&(message=expected,expected=null);try{block()}catch(e){actual=e}if(message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:"."),shouldThrow&&!actual&&fail(actual,expected,"Missing expected exception"+message),!shouldThrow&&expectedException(actual,expected)&&fail(actual,expected,"Got unwanted exception"+message),shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual)throw actual}var util=_dereq_("util/"),pSlice=Array.prototype.slice,hasOwn=Object.prototype.hasOwnProperty,assert=module.exports=ok;assert.AssertionError=function(options){this.name="AssertionError",this.actual=options.actual,this.expected=options.expected,this.operator=options.operator,options.message?(this.message=options.message,this.generatedMessage=!1):(this.message=getMessage(this),this.generatedMessage=!0);var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,stackStartFunction);else{var err=new Error;if(err.stack){var out=err.stack,fn_name=stackStartFunction.name,idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}},util.inherits(assert.AssertionError,Error),assert.fail=fail,assert.ok=ok,assert.equal=function(actual,expected,message){actual!=expected&&fail(actual,expected,message,"==",assert.equal)},assert.notEqual=function(actual,expected,message){actual==expected&&fail(actual,expected,message,"!=",assert.notEqual)},assert.deepEqual=function(actual,expected,message){_deepEqual(actual,expected)||fail(actual,expected,message,"deepEqual",assert.deepEqual)},assert.notDeepEqual=function(actual,expected,message){_deepEqual(actual,expected)&&fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)},assert.strictEqual=function(actual,expected,message){actual!==expected&&fail(actual,expected,message,"===",assert.strictEqual)},assert.notStrictEqual=function(actual,expected,message){actual===expected&&fail(actual,expected,message,"!==",assert.notStrictEqual)},assert.throws=function(block,error,message){_throws.apply(this,[!0].concat(pSlice.call(arguments)))},assert.doesNotThrow=function(block,message){_throws.apply(this,[!1].concat(pSlice.call(arguments)))},assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)hasOwn.call(obj,key)&&keys.push(key);return keys}},{"util/":54}],3:[function(_dereq_,module,exports){var types=_dereq_("./utilities/types"),expressions=_dereq_("./expressions");module.exports=types.defineClass(null,{visit:function(expr){return expr.accept(this)},visitConstant:function(expr){return expr},visitFloatConstant:function(expr){return expr},visitBinary:function(expr){var left=null,right=null;return null!==expr.left&&(left=this.visit(expr.left)),null!==expr.right&&(right=this.visit(expr.right)),left!=expr.left||right!=expr.right?new expressions.Binary(left,right,expr.expressionType):expr},visitUnary:function(expr){var operand=this.visit(expr.operand);return operand!=expr.operand?new expressions.Unary(operand,expr.expressionType):expr},visitMember:function(expr){return expr},visitParameter:function(expr){return expr},visitFunction:function(expr){var updated=!1,instance=expr.instance;expr.instance&&(instance=this.visit(expr.instance))!=expr.instance&&(updated=!0);var args=[expr.args.length],i=0,self=this;return expr.args.forEach(function(arg){var newArg=self.visit(arg);args[i++]=arg,newArg!=arg&&(updated=!0)}),updated?new expressions.FunctionCall(instance,expr.memberInfo,args):expr}})},{"./expressions":6,"./utilities/types":12}],4:[function(_dereq_,module,exports){function rewriteBitComparison(left,right){return isBooleanExpression(left)&&isBitConstant(right)?!0===right.value?left:new expressions.Unary(left,"Not"):isBooleanExpression(right)&&isBitConstant(left)?!0===left.value?right:new expressions.Unary(right,"Not"):null}function isBitConstant(expr){return"Constant"==expr.expressionType&&(!0===expr.value||!1===expr.value)}function ensureExpressionIsBoolean(expr){return isBooleanExpression(expr)?expr:new expressions.Binary(expr,new expressions.Constant(!0),"Equal")}function isBooleanExpression(expr){if(!expr)return!1;switch(expr.expressionType){case"And":case"Or":case"GreaterThan":case"GreaterThanOrEqual":case"LessThan":case"LessThanOrEqual":case"Not":case"Equal":case"NotEqual":return!0}if("Call"==expr.expressionType)switch(expr.memberInfo.memberName){case"startswith":case"endswith":case"substringof":return!0}return!1}var types=_dereq_("./utilities/types"),ExpressionVisitor=_dereq_("./ExpressionVisitor"),expressions=_dereq_("./expressions"),SqlBooleanizer=types.deriveClass(ExpressionVisitor,null,{visitUnary:function(expr){var operand=this.visit(expr.operand);return operand&&"Not"==expr.expressionType?new expressions.Unary(ensureExpressionIsBoolean(operand),"Not"):operand!=expr.operand?new expressions.Unary(operand,expr.expressionType):expr},visitBinary:function(expr){var left=null,right=null;if(null!==expr.left&&(left=this.visit(expr.left)),null!==expr.right&&(right=this.visit(expr.right)),"And"==expr.expressionType||"Or"==expr.expressionType)left=ensureExpressionIsBoolean(left),right=ensureExpressionIsBoolean(right);else if("Equal"==expr.expressionType||"NotEqual"==expr.expressionType){var converted=rewriteBitComparison(left,right);if(converted)return converted}return left!=expr.left||right!=expr.right?new expressions.Binary(left,right,expr.expressionType):expr}});module.exports=function(expr){return expr=(new SqlBooleanizer).visit(expr),expr=ensureExpressionIsBoolean(expr)}},{"./ExpressionVisitor":3,"./expressions":6,"./utilities/types":12}],5:[function(_dereq_,module,exports){(function(Buffer){function ctor(tableMetadata){this.tableMetadata=tableMetadata}var types=_dereq_("./utilities/types"),expressions=_dereq_("./expressions"),ExpressionVisitor=_dereq_("./ExpressionVisitor"),TypeConverter=types.deriveClass(ExpressionVisitor,ctor,{visitBinary:function(expr){var left=expr.left?this.visit(expr.left):null,right=expr.right?this.visit(expr.right):null;return this._isStringConstant(left)&&this._isBinaryMemberAccess(right)?left.value=new Buffer(left.value,"base64"):this._isStringConstant(right)&&this._isBinaryMemberAccess(left)&&(right.value=new Buffer(right.value,"base64")),left!=expr.left||right!=expr.right?new expressions.Binary(left,right,expr.expressionType):expr},_isStringConstant:function(expr){return expr&&"Constant"===expr.expressionType&&types.isString(expr.value)},_isBinaryMemberAccess:function(expr){return expr&&"MemberAccess"===expr.expressionType&&types.isString(expr.member)&&(this.tableMetadata.binaryColumns&&this.tableMetadata.binaryColumns.indexOf(expr.member.toLowerCase())>-1||"version"===expr.member.toLowerCase())}});module.exports=function(expr,tableMetadata){return new TypeConverter(tableMetadata).visit(expr)}}).call(this,_dereq_("buffer").Buffer)},{"./ExpressionVisitor":3,"./expressions":6,"./utilities/types":12,buffer:24}],6:[function(_dereq_,module,exports){var types=_dereq_("./utilities/types"),Expression=types.defineClass(null,{accept:function(visitor){return visitor.visit(this)}},null);module.exports={MappedMemberInfo:types.defineClass(function(type,memberName,isStatic,isMethod){this.type=type,this.memberName=memberName,this.isStatic=isStatic,this.isMethod=isMethod},null,null),Constant:types.deriveClass(Expression,function(value){this.value=value,this.expressionType="Constant"},{accept:function(visitor){return visitor.visitConstant(this)}},null),FloatConstant:types.deriveClass(Expression,function(value){this.value=value,this.expressionType="FloatConstant"},{accept:function(visitor){return visitor.visitFloatConstant(this)}},null),Binary:types.deriveClass(Expression,function(left,right,expressionType){this.left=left,this.right=right,this.expressionType=expressionType},{accept:function(visitor){return visitor.visitBinary(this)}},null),Unary:types.deriveClass(Expression,function(operand,expressionType){this.operand=operand,this.expressionType=expressionType},{accept:function(visitor){return visitor.visitUnary(this)}},null),Member:types.deriveClass(Expression,function(instance,member){this.instance=instance,this.member=member,this.expressionType="MemberAccess"},{accept:function(visitor){return visitor.visitMember(this)}},null),FunctionCall:types.deriveClass(Expression,function(instance,memberInfo,args){this.instance=instance,this.memberInfo=memberInfo,this.args=args,this.expressionType="Call"},{accept:function(visitor){return visitor.visitFunction(this)}},null),Parameter:types.defineClass(function(){this.ExpressionType="Parameter"},{accept:function(visitor){return visitor.visitParameter(this)}},null),Convert:types.deriveClass(Expression,function(desiredType,operand){this.desiredType=desiredType,this.operand=operand,this.expressionType="Convert"},{accept:function(visitor){return visitor.visitUnary(this)}},null)}},{"./utilities/types":12}],7:[function(_dereq_,module,exports){function ctor(tableConfig){this.tableConfig=tableConfig||{},this.flavor=this.tableConfig.flavor||"mssql",this.statement={sql:"",parameters:[],multiple:!0},this.paramNumber=0,this.parameterPrefix="p","sqlite"!==this.flavor&&(this.schemaName=this.tableConfig.schema||"dbo")}function isConstantOfType(expr,type){return"Constant"==expr.expressionType&&typeof expr.value===type}var types=_dereq_("./utilities/types"),util=_dereq_("util"),parseOData=_dereq_("./parseOData"),ExpressionVisitor=_dereq_("./ExpressionVisitor"),convertTypes=_dereq_("./convertTypes"),booleanize=_dereq_("./booleanize"),helpers=_dereq_("./helpers"),expressions=_dereq_("./expressions"),SqlFormatter=types.deriveClass(ExpressionVisitor,ctor,{format:function(query){query.skip>0&&(void 0===query.take||null===query.take)&&("sqlite"!==this.flavor?query.take=9007199254740992:query.take=-1);var statements=[];return this.statement.sql=this._formatQuery(query).trim(),statements.push(this.statement),("allpages"===query.inlineCount||query.includeTotalCount)&&(this.statement={sql:"",parameters:[],multiple:!0},this.statement.sql=this._formatCountQuery(helpers.formatTableName(this.schemaName,query.table),query).trim(),statements.push(this.statement)),statements},_formatQuery:function(query){if("sqlite"!==this.flavor&&query.skip>=0&&query.take>=0&&null!==query.skip&&null!==query.take)return this._formatPagedQuery(query);var takeClause="",skipClause="",whereClause="",orderbyClause="",limit=-1,selection=query.selections?this._formatSelection(query.selections):"*",resultLimit=query.resultLimit||Number.MAX_VALUE;query.take>=0&&null!==query.take?limit=Math.min(resultLimit,query.take):resultLimit!=Number.MAX_VALUE&&(limit=query.resultLimit),"sqlite"!==this.flavor?-1!=limit&&(takeClause="TOP "+limit.toString()+" "):(query.skip>0&&(skipClause=" OFFSET "+query.skip.toString()),(query.skip>0||limit>=0)&&(takeClause=" LIMIT "+limit.toString()));var filter=this._formatFilter(query);filter.length>0&&(whereClause=" WHERE "+filter);var ordering=this._formatOrderBy(query);ordering.length>0&&(orderbyClause=" ORDER BY "+ordering);var tableName=helpers.formatTableName(this.schemaName,query.table);return"sqlite"!==this.flavor?util.format("SELECT %s%s FROM %s%s%s",takeClause,selection,tableName,whereClause,orderbyClause):util.format("SELECT %s FROM %s%s%s%s%s",selection,tableName,whereClause,orderbyClause,takeClause,skipClause)},_formatPagedQuery:function(query){var selection="";selection=query.selections?this._formatSelection(query.selections):"*";var filter=this._formatFilter(query,"(1 = 1)"),ordering=this._formatOrderBy(query,"[id]"),tableName=helpers.formatTableName(this.schemaName,query.table);return util.format("SELECT %s FROM %s WHERE %s ORDER BY %s OFFSET %d ROWS FETCH NEXT %d ROWS ONLY",selection,tableName,filter,ordering,query.skip,query.take)},_formatCountQuery:function(table,query){var filter;(query.filters||void 0!==query.id||this.tableConfig.supportsSoftDelete)&&(this.statement.sql="",filter=this._formatFilter(query));var sql="SELECT COUNT(*) AS [count] FROM "+table;return filter&&(sql+=" WHERE "+filter),sql},_formatOrderBy:function(query,defaultOrder){if(!query.ordering)return defaultOrder||"";var orderings=parseOData.orderBy(query.ordering),order="",self=this;return orderings.forEach(function(ordering){order.length>0&&(order+=", "),self.statement.sql="",self.visit(ordering.selector),ordering.ascending||(self.statement.sql+=" DESC"),order+=self.statement.sql}),order},_formatSelection:function(selection,prefix){var formattedSelection="";return selection.split(",").forEach(function(column){var member=column.trim();formattedSelection.length>0&&(formattedSelection+=", "),formattedSelection+=(prefix||"")+helpers.formatMember(member)}),formattedSelection},_formatFilter:function(query,defaultFilter){var filterExpr;if(query.filters&&query.filters.length>0&&(filterExpr=parseOData(query.filters)),void 0!==query.id){var id=this.tableConfig.hasStringId?"'"+query.id.replace(/'/g,"''")+"'":query.id,idFilterExpr=parseOData(util.format("(id eq %s)",id));filterExpr=filterExpr?new expressions.Binary(filterExpr,idFilterExpr,"And"):idFilterExpr}if(this.tableConfig.softDelete&&!query.includeDeleted){var deletedFilter=parseOData(util.format("(deleted eq false)"));filterExpr=filterExpr?new expressions.Binary(filterExpr,deletedFilter,"And"):deletedFilter}return filterExpr?(this.statement.sql="",filterExpr=this._finalizeExpression(filterExpr),this.visit(filterExpr),this.statement.sql):defaultFilter||""},_finalizeExpression:function(expr){return expr=booleanize(expr),expr=convertTypes(expr,this.tableConfig)},visitBinary:function(expr){this.statement.sql+="(";var left=null,right=null;if("Modulo"==expr.expressionType&&(expr.left=new expressions.Convert("numeric",expr.left)),expr.left&&(left=this.visit(expr.left)),expr.right&&null===expr.right.value)"Equal"==expr.expressionType?this.statement.sql+=" IS NULL":"NotEqual"==expr.expressionType&&(this.statement.sql+=" IS NOT NULL");else{switch(expr.expressionType){case"Equal":this.statement.sql+=" = ";break;case"NotEqual":this.statement.sql+=" != ";break;case"LessThan":this.statement.sql+=" < ";break;case"LessThanOrEqual":this.statement.sql+=" <= ";break;case"GreaterThan":this.statement.sql+=" > ";break;case"GreaterThanOrEqual":this.statement.sql+=" >= ";break;case"And":this.statement.sql+=" AND ";break;case"Or":this.statement.sql+=" OR ";break;case"Concat":"sqlite"===this.flavor?this.statement.sql+=" || ":this.statement.sql+=" + ";break;case"Add":this.statement.sql+=" + ";break;case"Subtract":this.statement.sql+=" - ";break;case"Multiply":this.statement.sql+=" * ";break;case"Divide":this.statement.sql+=" / ";break;case"Modulo":this.statement.sql+=" % "}expr.right&&(right=this.visit(expr.right))}return this.statement.sql+=")",left!==expr.left||right!==expr.right?new expressions.Binary(left,right):expr},visitConstant:function(expr){return null===expr.value?(this.statement.sql+="NULL",expr):(this.statement.sql+=this._createParameter(expr.value),expr)},visitFloatConstant:function(expr){return null===expr.value?(this.statement.sql+="NULL",expr):(this.statement.sql+=this._createParameter(expr.value,"float"),expr)},_createParameter:function(value,type){var parameter={name:this.parameterPrefix+(++this.paramNumber).toString(),pos:this.paramNumber,value:value,type:type};return this.statement.parameters.push(parameter),"@"+this.parameterPrefix+this.paramNumber.toString()},visitMember:function(expr){return"string"==typeof expr.member?this.statement.sql+=helpers.formatMember(expr.member):this._formatMappedMember(expr),expr},visitUnary:function(expr){return"Not"==expr.expressionType?(this.statement.sql+="NOT ",this.visit(expr.operand)):"Convert"==expr.expressionType&&(this.statement.sql+=util.format("CONVERT(%s, ",expr.desiredType),this.visit(expr.operand),this.statement.sql+=")"),expr},visitFunction:function(expr){return expr.memberInfo&&this._formatMappedFunction(expr),expr},_formatMappedFunction:function(expr){"string"==expr.memberInfo.type?this._formatMappedStringMember(expr.instance,expr.memberInfo,expr.args):"date"==expr.memberInfo.type?this._formatMappedDateMember(expr.instance,expr.memberInfo,expr.args):"math"==expr.memberInfo.type&&this._formatMappedMathMember(expr.instance,expr.memberInfo,expr.args)},_formatMappedMember:function(expr){"string"==expr.member.type&&this._formatMappedStringMember(expr.instance,expr.member,null)},_formatMappedDateMember:function(instance,mappedMemberInfo,args){"day"==mappedMemberInfo.memberName?(this.statement.sql+="DAY(",this.visit(instance),this.statement.sql+=")"):"month"==mappedMemberInfo.memberName?(this.statement.sql+="MONTH(",this.visit(instance),this.statement.sql+=")"):"year"==mappedMemberInfo.memberName?(this.statement.sql+="YEAR(",this.visit(instance),this.statement.sql+=")"):"hour"==mappedMemberInfo.memberName?(this.statement.sql+="DATEPART(HOUR, ",this.visit(instance),this.statement.sql+=")"):"minute"==mappedMemberInfo.memberName?(this.statement.sql+="DATEPART(MINUTE, ",this.visit(instance),this.statement.sql+=")"):"second"==mappedMemberInfo.memberName&&(this.statement.sql+="DATEPART(SECOND, ",this.visit(instance),this.statement.sql+=")")},_formatMappedMathMember:function(instance,mappedMemberInfo,args){var functionName=mappedMemberInfo.memberName;"floor"==functionName?(this.statement.sql+="FLOOR(",this.visit(instance),this.statement.sql+=")"):"ceiling"==functionName?(this.statement.sql+="CEILING(",this.visit(instance),this.statement.sql+=")"):"round"==functionName&&(this.statement.sql+="ROUND(",this.visit(instance),this.statement.sql+=", 0)")},_formatMappedStringMember:function(instance,mappedMemberInfo,args){var functionName=mappedMemberInfo.memberName;if("substringof"==functionName)this.statement.sql+="(",this.visit(instance),this.statement.sql+=" LIKE ",this.statement.sql+="('%' + ",this.visit(args[0]),this.statement.sql+=" + '%')",this.statement.sql+=")";else if("startswith"==functionName)this.statement.sql+="(",this.visit(instance),this.statement.sql+=" LIKE ",this.statement.sql+="(",this.visit(args[0]),this.statement.sql+=" + '%')",this.statement.sql+=")";else if("endswith"==functionName)this.statement.sql+="(",this.visit(instance),this.statement.sql+=" LIKE ",this.statement.sql+="('%' + ",this.visit(args[0]),this.statement.sql+=")",this.statement.sql+=")";else if("concat"==functionName){"sqlite"!==this.flavor&&(isConstantOfType(args[0],"string")?isConstantOfType(args[1],"string")||(args[1]=new expressions.Convert(helpers.getSqlType(""),args[1])):args[0]=new expressions.Convert(helpers.getSqlType(""),args[0]));var concat=new expressions.Binary(args[0],args[1],"Concat");this.visit(concat)}else"tolower"==functionName?(this.statement.sql+="LOWER(",this.visit(instance),this.statement.sql+=")"):"toupper"==functionName?(this.statement.sql+="UPPER(",this.visit(instance),this.statement.sql+=")"):"length"==functionName?(this.statement.sql+="(LEN(",this.visit(instance),this.statement.sql+=" + 'X') - 1)"):"trim"==functionName?(this.statement.sql+="LTRIM(RTRIM(",this.visit(instance),this.statement.sql+="))"):"indexof"==functionName?"sqlite"===this.flavor?(this.statement.sql+="(INSTR(",this.visit(args[0]),this.statement.sql+=", ",this.visit(instance),this.statement.sql+=") - 1)"):(this.statement.sql+="(PATINDEX('%' + ",this.visit(args[0]),this.statement.sql+=" + '%', ",this.visit(instance),this.statement.sql+=") - 1)"):"replace"==functionName?(this.statement.sql+="REPLACE(",this.visit(instance),this.statement.sql+=", ",this.visit(args[0]),this.statement.sql+=", ",this.visit(args[1]),this.statement.sql+=")"):"substring"==functionName&&("sqlite"===this.flavor?this.statement.sql+="SUBSTR(":this.statement.sql+="SUBSTRING(",this.visit(instance),this.statement.sql+=", ",this.visit(args[0]),this.statement.sql+=" + 1, ",1==args.length?(this.statement.sql+="LEN(",this.visit(instance),this.statement.sql+=")"):2==args.length&&this.visit(args[1]),this.statement.sql+=")")}});module.exports=function(query,tableConfig){return query.table=tableConfig&&(tableConfig.containerName||tableConfig.databaseTableName||tableConfig.name)||query.table,new SqlFormatter(tableConfig).format(query)},module.exports.filter=function(query,parameterPrefix,tableConfig){var formatter=new SqlFormatter(tableConfig);return formatter.parameterPrefix=parameterPrefix||"p",formatter._formatFilter(query),formatter.statement}},{"./ExpressionVisitor":3,"./booleanize":4,"./convertTypes":5,"./expressions":6,"./helpers":8,"./parseOData":10,"./utilities/types":12,util:54}],8:[function(_dereq_,module,exports){var types=_dereq_("./utilities/types"),strings=_dereq_("./utilities/strings"),helpers=module.exports={isValidIdentifier:function(identifier){if(!identifier||!types.isString(identifier)||identifier.length>128)return!1;for(var i=0;i<identifier.length;i++){var char=identifier[i];if(0===i){if(!strings.isLetter(char)&&"_"!=char)return!1}else if(!strings.isLetter(char)&&!strings.isDigit(char)&&"_"!=char)return!1}return!0},validateIdentifier:function(identifier){if(!this.isValidIdentifier(identifier))throw new Error(identifier+" is not a valid identifier. Identifiers must be under 128 characters in length, start with a letter or underscore, and can contain only alpha-numeric and underscore characters.")},formatTableName:function(schemaName,tableName){return this.validateIdentifier(tableName),void 0!==schemaName?(schemaName=module.exports.formatSchemaName(schemaName),this.validateIdentifier(schemaName),"["+schemaName+"].["+tableName+"]"):"["+tableName+"]"},formatSchemaName:function(appName){return appName.replace(/-/g,"_")},formatMember:function(memberName){return this.validateIdentifier(memberName),"["+memberName+"]"},getSqlType:function(value,primaryKey){if(void 0===value||null===value)throw new Error("Cannot create column for null or undefined value");switch(value.constructor){case String:return primaryKey?"NVARCHAR(255)":"NVARCHAR(MAX)";case Number:return primaryKey?"INT":"FLOAT(53)";case Boolean:return"BIT";case Date:return"DATETIMEOFFSET(7)";default:throw new Error("Unable to map value "+value.toString()+" to a SQL type.")}},getPredefinedColumnType:function(value){switch(value){case"string":return"NVARCHAR(MAX)";case"number":return"FLOAT(53)";case"boolean":case"bool":return"BIT";case"datetime":case"date":return"DATETIMEOFFSET(7)"}throw new Error("Unrecognised column type: "+value)},getPredefinedType:function(value){switch(value){case"nvarchar":return"string";case"float":return"number";case"bit":return"boolean";case"datetimeoffset":return"datetime";case"timestamp":return"string";default:return value}},getSystemPropertiesDDL:function(){return{version:"version ROWVERSION NOT NULL",createdAt:"createdAt DATETIMEOFFSET(7) NOT NULL DEFAULT CONVERT(DATETIMEOFFSET(7),SYSUTCDATETIME(),0)",updatedAt:"updatedAt DATETIMEOFFSET(7) NOT NULL DEFAULT CONVERT(DATETIMEOFFSET(7),SYSUTCDATETIME(),0)",deleted:"deleted bit NOT NULL DEFAULT 0"}},getSystemProperties:function(){return Object.keys(helpers.getSystemPropertiesDDL())},isSystemProperty:function(property){return helpers.getSystemProperties().some(function(systemProperty){return property===systemProperty})}}},{"./utilities/strings":11,"./utilities/types":12}],9:[function(_dereq_,module,exports){var format=_dereq_("./format");module.exports={format:format}},{"./format":7}],10:[function(_dereq_,module,exports){function ctor(expression){this.keywords=this._createKeywords(),this.it=new expressions.Parameter,this.text=expression,this.textLen=this.text.length,this.token={},this._setTextPos(0),this._nextToken()}var util=_dereq_("util"),types=_dereq_("./utilities/types"),strings=_dereq_("./utilities/strings"),expressions=_dereq_("./expressions"),ODataParser=types.defineClass(ctor,{parse:function(){var expr=this._parseExpression();return this._validateToken("End","Syntax error"),expr},parseOrdering:function(){for(var orderings=[];;){var expr=this._parseExpression(),ascending=!0;if(this._tokenIdentifierIs("asc")?this._nextToken():this._tokenIdentifierIs("desc")&&(this._nextToken(),ascending=!1),orderings.push({selector:expr,ascending:ascending}),"Comma"!=this.token.id)break;this._nextToken()}return this._validateToken("End","Syntax error"),orderings},_tokenIdentifierIs:function(id){return"Identifier"==this.token.id&&id==this.token.text},_parseExpression:function(){return this._parseLogicalOr()},_parseLogicalOr:function(){for(var left=this._parseLogicalAnd();"Or"==this.token.id;){this._nextToken();var right=this._parseLogicalAnd();left=new expressions.Binary(left,right,"Or")}return left},_parseLogicalAnd:function(){for(var left=this._parseComparison();"And"==this.token.id;){this._nextToken();var right=this._parseComparison();left=new expressions.Binary(left,right,"And")}return left},_parseComparison:function(){for(var left=this._parseAdditive();"Equal"==this.token.id||"NotEqual"==this.token.id||"GreaterThan"==this.token.id||"GreaterThanEqual"==this.token.id||"LessThan"==this.token.id||"LessThanEqual"==this.token.id;){var opId=this.token.id;this._nextToken();var right=this._parseAdditive();switch(opId){case"Equal":left=new expressions.Binary(left,right,"Equal");break;case"NotEqual":left=new expressions.Binary(left,right,"NotEqual");break;case"GreaterThan":left=new expressions.Binary(left,right,"GreaterThan");break;case"GreaterThanEqual":left=new expressions.Binary(left,right,"GreaterThanOrEqual");break;case"LessThan":left=new expressions.Binary(left,right,"LessThan");break;case"LessThanEqual":left=new expressions.Binary(left,right,"LessThanOrEqual")}}return left},_parseAdditive:function(){
for(var left=this._parseMultiplicative();"Add"==this.token.id||"Sub"==this.token.id;){var opId=this.token.id;this._nextToken();var right=this._parseMultiplicative();switch(opId){case"Add":left=new expressions.Binary(left,right,"Add");break;case"Sub":left=new expressions.Binary(left,right,"Subtract")}}return left},_parseMultiplicative:function(){for(var left=this._parseUnary();"Multiply"==this.token.id||"Divide"==this.token.id||"Modulo"==this.token.id;){var opId=this.token.id;this._nextToken();var right=this._parseUnary();switch(opId){case"Multiply":left=new expressions.Binary(left,right,"Multiply");break;case"Divide":left=new expressions.Binary(left,right,"Divide");break;case"Modulo":left=new expressions.Binary(left,right,"Modulo")}}return left},_parseUnary:function(){if("Minus"==this.token.id||"Not"==this.token.id){var opId=this.token.id,opPos=this.token.pos;if(this._nextToken(),"Minus"==opId&&("IntegerLiteral"==this.token.id||"RealLiteral"==this.token.id))return this.token.text="-"+this.token.text,this.token.pos=opPos,this._parsePrimary();var expr=this._parseUnary();return expr="Minus"==opId?new expressions.Unary(expr,"Negate"):new expressions.Unary(expr,"Not")}return this._parsePrimary()},_parsePrimary:function(){for(var expr=this._parsePrimaryStart();;){if("Dot"!=this.token.id)break;this._nextToken(),expr=this._parseMemberAccess(expr)}return expr},_parseMemberAccess:function(instance){var errorPos=this.token.pos,id=this._getIdentifier();if(this._nextToken(),"OpenParen"==this.token.id){var mappedFunction=this._mapFunction(id);if(null!==mappedFunction)return this._parseMappedFunction(mappedFunction,errorPos);throw this._parseError(util.format("Unknown identifier '%s'",id),errorPos)}return new expressions.Member(instance,id)},_parseMappedFunction:function(mappedMember,errorPos){var args,mappedMemberName=mappedMember.memberName,instance=null;if(this._beginValidateFunction(mappedMemberName,errorPos),"OpenParen"!=this.token.id)throw this._parseError("'(' expected");if(args=this._parseArgumentList(),this._completeValidateFunction(mappedMemberName,args),mappedMember.mapParams&&mappedMember.mapParams(args),mappedMember.isStatic)instance=null;else{if(0===args.length)throw this._parseError(util.format("No applicable method '%s' exists in type '%s'",mappedMember.memberName,mappedMember.type),errorPos);instance=args[0],args=args.slice(1)}return mappedMember.isMethod?new expressions.FunctionCall(instance,mappedMember,args):new expressions.Member(instance,mappedMember)},_beginValidateFunction:function(functionName,errorPos){if("replace"===functionName){if(this.inStringReplace)throw this._parseError("Calls to 'replace' cannot be nested.",errorPos);this.inStringReplace=!0}},_completeValidateFunction:function(functionName,functionArgs,errorPos){switch(functionName){case"day":case"month":case"year":case"hour":case"minute":case"second":case"floor":case"ceiling":case"round":case"tolower":case"toupper":case"length":case"trim":this._validateFunctionParameters(functionName,functionArgs,1);break;case"substringof":case"startswith":case"endswith":case"concat":case"indexof":this._validateFunctionParameters(functionName,functionArgs,2);break;case"replace":this._validateFunctionParameters(functionName,functionArgs,3);var replaceArg=functionArgs[2];if("Constant"!==replaceArg.expressionType||replaceArg.value.length>100)throw this._parseError("The third parameter to 'replace' must be a string constant less than 100 in length.",errorPos);break;case"substring":if(2!=functionArgs.length&&3!=functionArgs.length)throw new Error("Function 'substring' requires 2 or 3 parameters.")}this.inStringReplace=!1},_validateFunctionParameters:function(functionName,args,expectedArgCount){if(args.length!==expectedArgCount){var error=util.format("Function '%s' requires %d %s",functionName,expectedArgCount,expectedArgCount>1?"parameters.":"parameter.");throw new Error(error)}},_parseArgumentList:function(){this._validateToken("OpenParen","'(' expected"),this._nextToken();var args="CloseParen"!=this.token.id?this._parseArguments():[];return this._validateToken("CloseParen","')' or ',' expected"),this._nextToken(),args},_parseArguments:function(){for(var args=[];;){if(args.push(this._parseExpression()),"Comma"!=this.token.id)break;this._nextToken()}return args},_mapFunction:function(functionName){var mappedMember=this._mapStringFunction(functionName);return null!==mappedMember?mappedMember:null!==(mappedMember=this._mapDateFunction(functionName))?mappedMember:(mappedMember=this._mapMathFunction(functionName),null!==mappedMember?mappedMember:null)},_mapStringFunction:function(functionName){if("startswith"==functionName)return new expressions.MappedMemberInfo("string",functionName,!1,!0);if("endswith"==functionName)return new expressions.MappedMemberInfo("string",functionName,!1,!0);if("length"==functionName)return new expressions.MappedMemberInfo("string",functionName,!1,!1);if("toupper"==functionName)return new expressions.MappedMemberInfo("string",functionName,!1,!0);if("tolower"==functionName)return new expressions.MappedMemberInfo("string",functionName,!1,!0);if("trim"==functionName)return new expressions.MappedMemberInfo("string",functionName,!1,!0);if("substringof"==functionName){var memberInfo=new expressions.MappedMemberInfo("string",functionName,!1,!0);return memberInfo.mapParams=function(args){var tmp=args[0];args[0]=args[1],args[1]=tmp},memberInfo}return"indexof"==functionName?new expressions.MappedMemberInfo("string",functionName,!1,!0):"replace"==functionName?new expressions.MappedMemberInfo("string",functionName,!1,!0):"substring"==functionName?new expressions.MappedMemberInfo("string",functionName,!1,!0):"trim"==functionName?new expressions.MappedMemberInfo("string",functionName,!1,!0):"concat"==functionName?new expressions.MappedMemberInfo("string",functionName,!0,!0):null},_mapDateFunction:function(functionName){return"day"==functionName?new expressions.MappedMemberInfo("date",functionName,!1,!0):"month"==functionName?new expressions.MappedMemberInfo("date",functionName,!1,!0):"year"==functionName?new expressions.MappedMemberInfo("date",functionName,!1,!0):"hour"==functionName?new expressions.MappedMemberInfo("date",functionName,!1,!0):"minute"==functionName?new expressions.MappedMemberInfo("date",functionName,!1,!0):"second"==functionName?new expressions.MappedMemberInfo("date",functionName,!1,!0):null},_mapMathFunction:function(functionName){return"floor"==functionName?new expressions.MappedMemberInfo("math",functionName,!1,!0):"ceiling"==functionName?new expressions.MappedMemberInfo("math",functionName,!1,!0):"round"==functionName?new expressions.MappedMemberInfo("math",functionName,!1,!0):null},_getIdentifier:function(){return this._validateToken("Identifier","Identifier expected"),this.token.text},_parsePrimaryStart:function(){switch(this.token.id){case"Identifier":return this._parseIdentifier();case"StringLiteral":return this._parseStringLiteral();case"IntegerLiteral":return this._parseIntegerLiteral();case"RealLiteral":return this._parseRealLiteral();case"OpenParen":return this._parseParenExpression();default:throw this._parseError("Expression expected")}},_parseIntegerLiteral:function(){this._validateToken("IntegerLiteral");var text=this.token.text,value=parseInt(text,10);if(isNaN(value)||value!=text)throw this._parseError(util.format("Invalid integer literal '%s'",text));return this._nextToken(),"L"==this.token.text.toUpperCase()?(this._nextToken(),new expressions.Constant(value)):new expressions.Constant(value)},_parseRealLiteral:function(){this._validateToken("RealLiteral");var text=this.token.text,last=text.slice(-1);"F"!=last.toUpperCase()&&"M"!=last.toUpperCase()&&"D"!=last.toUpperCase()||(text=text.slice(0,-1));var value=parseFloat(text);if(isNaN(value)||value!=text)throw this._parseError(util.format("Invalid real literal '%s'",text));return this._nextToken(),new expressions.FloatConstant(value)},_parseParenExpression:function(){this._validateToken("OpenParen","'(' expected"),this._nextToken();var e=this._parseExpression();return this._validateToken("CloseParen","')' or operator expected"),this._nextToken(),e},_parseIdentifier:function(){this._validateToken("Identifier");var value=this.keywords[this.token.text];if(value){if("string"==typeof value&&"'"==this.ch)return this._parseTypeConstruction(value);if("string"!=typeof value)return this._nextToken(),value}if(null!==this.it)return this._parseMemberAccess(this.it);throw this._parseError(util.format("Unknown identifier '%s'",this.token.text))},_parseTypeConstruction:function(type){var typeIdentifier=this.token.text,errorPos=this.token.pos;this._nextToken();var typeExpression=null;if("StringLiteral"==this.token.id){errorPos=this.token.pos;var stringExpr=this._parseStringLiteral(),literalValue=stringExpr.value,date=null;try{"datetime"==type?(date=strings.parseISODate(literalValue))&&(typeExpression=new expressions.Constant(date)):"datetimeoffset"==type&&(date=strings.parseDateTimeOffset(literalValue))&&(typeExpression=new expressions.Constant(date))}catch(e){throw this._parseError(e,errorPos)}}if(!typeExpression)throw this._parseError(util.format("Invalid '%s' type creation expression",typeIdentifier),errorPos);return typeExpression},_parseStringLiteral:function(){this._validateToken("StringLiteral");var s=this.token.text.substr(1,this.token.text.length-2).replace(/''/g,"'");return this._nextToken(),new expressions.Constant(s)},_validateToken:function(tokenId,error){if(this.token.id!=tokenId)throw this._parseError(error||"Syntax error")},_createKeywords:function(){return{true:new expressions.Constant(!0),false:new expressions.Constant(!1),null:new expressions.Constant(null),datetime:"datetime",datetimeoffset:"datetimeoffset"}},_setTextPos:function(pos){this.textPos=pos,this.ch=this.textPos<this.textLen?this.text[this.textPos]:"\\0"},_nextToken:function(){for(;this._isWhiteSpace(this.ch);)this._nextChar();var t,tokenPos=this.textPos;switch(this.ch){case"(":this._nextChar(),t="OpenParen";break;case")":this._nextChar(),t="CloseParen";break;case",":this._nextChar(),t="Comma";break;case"-":this._nextChar(),t="Minus";break;case"/":this._nextChar(),t="Dot";break;case"'":var quote=this.ch;do{for(this._nextChar();this.textPos<this.textLen&&this.ch!=quote;)this._nextChar();if(this.textPos==this.textLen)throw this._parseError("Unterminated string literal",this.textPos);this._nextChar()}while(this.ch==quote);t="StringLiteral";break;default:if(this._isIdentifierStart(this.ch)||"@"==this.ch||"_"==this.ch){do{this._nextChar()}while(this._isIdentifierPart(this.ch)||"_"==this.ch);t="Identifier";break}if(strings.isDigit(this.ch)){t="IntegerLiteral";do{this._nextChar()}while(strings.isDigit(this.ch));if("."==this.ch){t="RealLiteral",this._nextChar(),this._validateDigit();do{this._nextChar()}while(strings.isDigit(this.ch))}if("E"==this.ch||"e"==this.ch){t="RealLiteral",this._nextChar(),"+"!=this.ch&&"-"!=this.ch||this._nextChar(),this._validateDigit();do{this._nextChar()}while(strings.isDigit(this.ch))}"F"!=this.ch&&"f"!=this.ch&&"M"!=this.ch&&"m"!=this.ch&&"D"!=this.ch&&"d"!=this.ch||(t="RealLiteral",this._nextChar());break}if(this.textPos==this.textLen){t="End";break}throw this._parseError("Syntax error '"+this.ch+"'",this.textPos)}this.token.id=t,this.token.text=this.text.substr(tokenPos,this.textPos-tokenPos),this.token.pos=tokenPos,this.token.id=this._reclassifyToken(this.token)},_reclassifyToken:function(token){if("Identifier"==token.id){if("or"==token.text)return"Or";if("add"==token.text)return"Add";if("and"==token.text)return"And";if("div"==token.text)return"Divide";if("sub"==token.text)return"Sub";if("mul"==token.text)return"Multiply";if("mod"==token.text)return"Modulo";if("ne"==token.text)return"NotEqual";if("not"==token.text)return"Not";if("le"==token.text)return"LessThanEqual";if("lt"==token.text)return"LessThan";if("eq"==token.text)return"Equal";if("ge"==token.text)return"GreaterThanEqual";if("gt"==token.text)return"GreaterThan"}return token.id},_nextChar:function(){this.textPos<this.textLen&&this.textPos++,this.ch=this.textPos<this.textLen?this.text[this.textPos]:"\\0"},_isWhiteSpace:function(ch){return/\s/.test(ch)},_validateDigit:function(){if(!strings.isDigit(this.ch))throw this._parseError("Digit expected",this.textPos)},_parseError:function(error,pos){return pos=pos||this.token.pos||0,new Error(error+" (at index "+pos+")")},_isIdentifierStart:function(ch){return strings.isLetter(ch)},_isIdentifierPart:function(ch){return!!this._isIdentifierStart(ch)||(!!strings.isDigit(ch)||("_"==ch||"-"==ch))}});module.exports=function(predicate){return new ODataParser(predicate).parse()},module.exports.orderBy=function(ordering){return new ODataParser(ordering).parseOrdering()}},{"./expressions":6,"./utilities/strings":11,"./utilities/types":12,util:54}],11:[function(_dereq_,module,exports){var stringIdValidatorRegex=/([\u0000-\u001F]|[\u007F-\u009F]|["\+\?\\\/\`]|^\.{1,2}$)/,iso8601Regex=/^(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})(\.(\d{3}))?Z$/,msDateRegex=/^\/Date\((-?)(\d+)(([+\-])(\d{2})(\d{2})?)?\)\/$/,strings=module.exports={isLetter:function(ch){return ch>="A"&&ch<="Z"||ch>="a"&&ch<="z"},isDigit:function(ch){return ch>="0"&&ch<="9"},isValidStringId:function(id){return!stringIdValidatorRegex.test(id)},getVersionFromEtag:function(etag){return etag.replace(/^"|\\(?=")|"$/g,"")},getEtagFromVersion:function(version){return'"'+version.replace(/\"/g,'\\"')+'"'},convertDate:function(value){var date=strings.parseISODate(value);return date||((date=strings.parseMsDate(value))||null)},parseISODate:function(value){return iso8601Regex.test(value)?strings.parseDateTimeOffset(value):null},parseDateTimeOffset:function(value){var ms=Date.parse(value);return isNaN(ms)?null:new Date(ms)},parseMsDate:function(value){var match=msDateRegex.exec(value);if(match){var milliseconds=parseInt(match[2],10),offsetMinutes=0;if(match[5]){offsetMinutes=60*parseInt(match[5],10)+parseInt(match[6]||"0",10)}"-"===match[1]&&(milliseconds=-milliseconds),"-"===match[4]&&(offsetMinutes=-offsetMinutes);var date=new Date;return date.setTime(milliseconds+6e4*offsetMinutes),date}return null},parseBoolean:function(bool){return void 0===bool||null===bool||"string"!=typeof bool?void 0:"true"===bool.toLowerCase()||"false"!==bool.toLowerCase()&&void 0}}},{}],12:[function(_dereq_,module,exports){var types=module.exports={curry:function(fn){var slice=Array.prototype.slice,args=slice.call(arguments,1);return function(){return fn.apply(null,args.concat(slice.call(arguments)))}},extend:function(target,members){for(var member in members)members.hasOwnProperty(member)&&(target[member]=members[member]);return target},defineClass:function(ctor,instanceMembers,classMembers){return ctor=ctor||function(){},instanceMembers&&types.extend(ctor.prototype,instanceMembers),classMembers&&types.extend(ctor,classMembers),ctor},deriveClass:function(baseClass,ctor,instanceMembers){var basePrototype=baseClass.prototype,prototype={};types.extend(prototype,basePrototype);var getPrototype=function(name,fn){return function(){var tmp=this._super;this._super=basePrototype;var ret=fn.apply(this,arguments);return this._super=tmp,ret}};if(instanceMembers)for(var name in instanceMembers)instanceMembers.hasOwnProperty(name)&&(prototype[name]="function"==typeof instanceMembers[name]&&"function"==typeof basePrototype[name]?getPrototype(name,instanceMembers[name]):instanceMembers[name]);return ctor=ctor?function(fn){return function(){var tmp=this._super;this._super=basePrototype;var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(ctor):function(){},ctor.prototype=prototype,ctor.prototype.constructor=ctor,ctor},classof:function(o){return null===o?"null":void 0===o?"undefined":Object.prototype.toString.call(o).slice(8,-1).toLowerCase()},isArray:function(o){return"array"===types.classof(o)},isObject:function(o){return"object"===types.classof(o)},isDate:function(o){return"date"===types.classof(o)},isFunction:function(o){return"function"===types.classof(o)},isString:function(o){return"string"===types.classof(o)},isNumber:function(o){return"number"===types.classof(o)},isError:function(o){return"error"===types.classof(o)},isGuid:function(value){return types.isString(value)&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(value)},isEmpty:function(obj){if(null===obj||void 0===obj)return!0;for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0}}},{}],13:[function(_dereq_,module,exports){(function(){var JavaScriptToQueryVisitor,PartialEvaluator,esprima;esprima=_dereq_("esprima"),_dereq_("./JavaScriptNodes"),PartialEvaluator=_dereq_("./PartialEvaluator").PartialEvaluator,JavaScriptToQueryVisitor=_dereq_("./JavaScriptToQueryVisitor").JavaScriptToQueryVisitor,exports.JavaScript=function(){function JavaScript(){}return JavaScript.transformConstraint=function(func,env){var context,translator;return context=JavaScript.getExpression(func,env),context.expression=PartialEvaluator.evaluate(context),translator=new JavaScriptToQueryVisitor(context),translator.visit(context.expression)},JavaScript.getProjectedFields=function(func){return[]},JavaScript.getExpression=function(func,env){var environment,expr,i,j,len,name,names,program,ref,ref1,ref10,ref11,ref12,ref13,ref2,ref3,ref4,ref5,ref6,ref7,ref8,ref9,source;if(source="var _$$_stmt_$$_ = "+func+";",program=esprima.parse(source,{range:!0}),!(expr="Program"===(null!=program?program.type:void 0)&&1===(null!=program&&null!=(ref=program.body)?ref.length:void 0)&&"VariableDeclaration"===(null!=(ref1=program.body[0])?ref1.type:void 0)&&1===(null!=(ref2=program.body[0])&&null!=(ref3=ref2.declarations)?ref3.length:void 0)&&"VariableDeclarator"===(null!=(ref4=program.body[0].declarations[0])?ref4.type:void 0)&&"FunctionExpression"===(null!=(ref5=program.body[0].declarations[0])&&null!=(ref6=ref5.init)?ref6.type:void 0)&&"BlockStatement"===(null!=(ref7=program.body[0].declarations[0].init)&&null!=(ref8=ref7.body)?ref8.type:void 0)&&1===(null!=(ref9=program.body[0].declarations[0].init.body)&&null!=(ref10=ref9.body)?ref10.length:void 0)&&"ReturnStatement"===(null!=(ref11=program.body[0].declarations[0].init.body.body[0])?ref11.type:void 0)&&(null!=(ref12=program.body[0].declarations[0].init.body.body[0])?ref12.argument:void 0)))throw"Expected a predicate with a single return statement, not "+func;if(names=null!=(ref13=program.body[0].declarations[0].init.params)?ref13.map(function(p){return p.name}):void 0,names.length>env.length)throw"Expected value(s) for parameter(s) "+names.slice(env.length);if(env.length>names.length)throw"Expected parameter(s) for value(s) "+env.slice(names.length);for(environment={},i=j=0,len=names.length;j<len;i=++j)name=names[i],environment[name]=env[i];return{source:source,expression:expr,environment:environment}},JavaScript}()}).call(this)},{"./JavaScriptNodes":14,"./JavaScriptToQueryVisitor":15,"./PartialEvaluator":18,esprima:27}],14:[function(_dereq_,module,exports){(function(){var Declaration,Expression,JavaScriptNode,JavaScriptVisitor,Node,Pattern,Statement,Visitor,ref,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ref=_dereq_("./Node"),Node=ref.Node,Visitor=ref.Visitor,exports.JavaScriptNode=JavaScriptNode=function(superClass){function JavaScriptNode(){JavaScriptNode.__super__.constructor.call(this)}return extend(JavaScriptNode,superClass),JavaScriptNode}(Node),exports.JavaScriptVisitor=JavaScriptVisitor=function(superClass){function JavaScriptVisitor(){JavaScriptVisitor.__super__.constructor.call(this)}return extend(JavaScriptVisitor,superClass),JavaScriptVisitor.prototype.JavaScriptNode=function(node){return node},JavaScriptVisitor}(Visitor),exports.Program=function(superClass){function Program(elements){this.elements=elements,Program.__super__.constructor.call(this)}return extend(Program,superClass),Program}(JavaScriptNode),JavaScriptVisitor.prototype.Program=function(node){return node=this.JavaScriptNode(node),node.elements=this.visit(node.elements),node},exports.Function=function(superClass){function Function(id,params,body){this.id=id,this.params=params,this.body=body,Function.__super__.constructor.call(this)}return extend(Function,superClass),Function}(JavaScriptNode),JavaScriptVisitor.prototype.Function=function(node){return node=this.JavaScriptNode(node),node.id=this.visit(node.id),node.params=this.visit(node.params),node.body=this.visit(node.body),node},exports.Statement=Statement=function(superClass){function Statement(){Statement.__super__.constructor.call(this)}return extend(Statement,superClass),Statement}(JavaScriptNode),JavaScriptVisitor.prototype.Statement=function(node){return node=this.JavaScriptNode(node)},exports.EmptyStatement=function(superClass){function EmptyStatement(){EmptyStatement.__super__.constructor.call(this)}return extend(EmptyStatement,superClass),EmptyStatement}(JavaScriptNode),JavaScriptVisitor.prototype.EmptyStatement=function(node){return node=this.JavaScriptNode(node)},exports.BlockStatement=function(superClass){function BlockStatement(body){this.body=body,BlockStatement.__super__.constructor.call(this)}return extend(BlockStatement,superClass),BlockStatement}(Statement),JavaScriptVisitor.prototype.BlockStatement=function(node){return node=this.Statement(node),node.body=this.visit(node.body),node},exports.ExpressionStatement=function(superClass){function ExpressionStatement(){ExpressionStatement.__super__.constructor.call(this)}return extend(ExpressionStatement,superClass),ExpressionStatement}(Statement),JavaScriptVisitor.prototype.ExpressionStatement=function(node){return node=this.Statement(node)},exports.IfStatement=function(superClass){function IfStatement(test,consequent,alternate){this.test=test,this.consequent=consequent,this.alternate=alternate,IfStatement.__super__.constructor.call(this)}return extend(IfStatement,superClass),IfStatement}(Statement),JavaScriptVisitor.prototype.IfStatement=function(node){return node=this.Statement(node),node.test=this.visit(node.test),node.consequent=this.visit(node.consequent),node.alternate=this.visit(node.alternate),node},exports.LabeledStatement=function(superClass){function LabeledStatement(label,body){this.label=label,this.body=body,LabeledStatement.__super__.constructor.call(this)}return extend(LabeledStatement,superClass),LabeledStatement}(Statement),JavaScriptVisitor.prototype.LabeledStatement=function(node){return node=this.Statement(node),node.label=this.visit(node.label),node.body=this.visit(node.body),node},exports.BreakStatement=function(superClass){function BreakStatement(label){this.label=label,BreakStatement.__super__.constructor.call(this)}return extend(BreakStatement,superClass),BreakStatement}(Statement),JavaScriptVisitor.prototype.BreakStatement=function(node){return node=this.Statement(node),node.label=this.visit(node.label),node},exports.ContinueStatement=function(superClass){function ContinueStatement(label){this.label=label,ContinueStatement.__super__.constructor.call(this)}return extend(ContinueStatement,superClass),ContinueStatement}(Statement),JavaScriptVisitor.prototype.ContinueStatement=function(node){return node=this.Statement(node),node.label=this.visit(node.label),node},exports.WithStatement=function(superClass){function WithStatement(object,body){this.object=object,this.body=body,WithStatement.__super__.constructor.call(this)}return extend(WithStatement,superClass),WithStatement}(Statement),JavaScriptVisitor.prototype.WithStatement=function(node){return node=this.Statement(node),node.object=this.visit(node.object),node.body=this.visit(node.body),node},exports.SwitchStatement=function(superClass){function SwitchStatement(discriminant,cases){this.discriminant=discriminant,this.cases=cases,SwitchStatement.__super__.constructor.call(this)}return extend(SwitchStatement,superClass),SwitchStatement}(Statement),JavaScriptVisitor.prototype.SwitchStatement=function(node){return node=this.Statement(node),node.discriminant=this.visit(node.discriminant),node.cases=this.visit(node.cases),node},exports.ReturnStatement=function(superClass){function ReturnStatement(argument){this.argument=argument,ReturnStatement.__super__.constructor.call(this)}return extend(ReturnStatement,superClass),ReturnStatement}(Statement),JavaScriptVisitor.prototype.ReturnStatement=function(node){return node=this.Statement(node),node.argument=this.visit(node.argument),node},exports.ThrowStatement=function(superClass){function ThrowStatement(argument){this.argument=argument,ThrowStatement.__super__.constructor.call(this)}return extend(ThrowStatement,superClass),ThrowStatement}(Statement),JavaScriptVisitor.prototype.ThrowStatement=function(node){return node=this.Statement(node),node.argument=this.visit(node.argument),node},exports.TryStatement=function(superClass){function TryStatement(block,handlers,finalizer){this.block=block,this.handlers=handlers,this.finalizer=finalizer,TryStatement.__super__.constructor.call(this)}return extend(TryStatement,superClass),TryStatement}(Statement),JavaScriptVisitor.prototype.TryStatement=function(node){return node=this.Statement(node),node.block=this.visit(node.block),node.handlers=this.visit(node.handlers),node.finalizer=this.visit(node.finalizer),node},exports.WhileStatement=function(superClass){function WhileStatement(test,body){this.test=test,this.body=body,WhileStatement.__super__.constructor.call(this)}return extend(WhileStatement,superClass),WhileStatement}(Statement),JavaScriptVisitor.prototype.WhileStatement=function(node){return node=this.Statement(node),node.test=this.visit(node.test),node.body=this.visit(node.body),node},exports.DoWhileStatement=function(superClass){function DoWhileStatement(body,test){this.body=body,this.test=test,DoWhileStatement.__super__.constructor.call(this)}return extend(DoWhileStatement,superClass),DoWhileStatement}(Statement),JavaScriptVisitor.prototype.DoWhileStatement=function(node){return node=this.Statement(node),node.body=this.visit(node.body),node.test=this.visit(node.test),node},exports.ForStatement=function(superClass){function ForStatement(init,test,update,body){this.init=init,this.test=test,this.update=update,this.body=body,ForStatement.__super__.constructor.call(this)}return extend(ForStatement,superClass),ForStatement}(Statement),JavaScriptVisitor.prototype.ForStatement=function(node){return node=this.Statement(node),node.init=this.visit(node.init),node.test=this.visit(node.test),node.update=this.visit(node.update),node.body=this.visit(node.body),node},exports.ForInStatement=function(superClass){function ForInStatement(left,right,body){this.left=left,this.right=right,this.body=body,ForInStatement.__super__.constructor.call(this)}return extend(ForInStatement,superClass),ForInStatement}(Statement),JavaScriptVisitor.prototype.ForInStatement=function(node){return node=this.Statement(node),node.left=this.visit(node.left),node.right=this.visit(node.right),node.body=this.visit(node.body),node},exports.DebuggerStatement=function(superClass){function DebuggerStatement(){DebuggerStatement.__super__.constructor.call(this)}return extend(DebuggerStatement,superClass),DebuggerStatement}(Statement),JavaScriptVisitor.prototype.DebuggerStatement=function(node){return node=this.Statement(node)},exports.Declaration=Declaration=function(superClass){function Declaration(){Declaration.__super__.constructor.call(this)}return extend(Declaration,superClass),Declaration}(Statement),JavaScriptVisitor.prototype.Declaration=function(node){return node=this.Statement(node)},exports.FunctionDeclaration=function(superClass){function FunctionDeclaration(id,params,body){this.id=id,this.params=params,this.body=body,FunctionDeclaration.__super__.constructor.call(this)}return extend(FunctionDeclaration,superClass),FunctionDeclaration}(Declaration),JavaScriptVisitor.prototype.FunctionDeclaration=function(node){return node=this.Declaration(node),node.id=this.visit(node.id),node.params=this.visit(node.params),node.body=this.visit(node.body),node},exports.VariableDeclaration=function(superClass){function VariableDeclaration(declarations,kind){this.declarations=declarations,this.kind=kind,VariableDeclaration.__super__.constructor.call(this)}return extend(VariableDeclaration,superClass),VariableDeclaration}(Declaration),JavaScriptVisitor.prototype.VariableDeclaration=function(node){return node=this.Declaration(node),node.declarations=this.visit(node.declarations),node},exports.VariableDeclarator=function(superClass){function VariableDeclarator(id,init){this.id=id,this.init=init,VariableDeclarator.__super__.constructor.call(this)}return extend(VariableDeclarator,superClass),VariableDeclarator}(JavaScriptNode),JavaScriptVisitor.prototype.VariableDeclarator=function(node){return node=this.JavaScriptNode(node),node.id=this.visit(node.id),node.init=this.visit(node.init),node},exports.Expression=Expression=function(superClass){function Expression(){return Expression.__super__.constructor.apply(this,arguments)}return extend(Expression,superClass),Expression.prototype.constuctor=function(){return Expression.__super__.constuctor.call(this)},Expression}(JavaScriptNode),JavaScriptVisitor.prototype.Expression=function(node){return node=this.JavaScriptNode(node)},exports.ThisExpression=function(superClass){function ThisExpression(){ThisExpression.__super__.constructor.call(this)}return extend(ThisExpression,superClass),ThisExpression}(Expression),JavaScriptVisitor.prototype.ThisExpression=function(node){return node=this.Expression(node)},exports.ArrayExpression=function(superClass){function ArrayExpression(elements){this.elements=elements,ArrayExpression.__super__.constructor.call(this)}return extend(ArrayExpression,superClass),ArrayExpression}(Expression),JavaScriptVisitor.prototype.ArrayExpression=function(node){return node=this.Expression(node),node.elements=this.visit(node.elements),node},exports.ObjectExpression=function(superClass){function ObjectExpression(properties){this.properties=properties,ObjectExpression.__super__.constructor.call(this)}return extend(ObjectExpression,superClass),ObjectExpression}(Expression),JavaScriptVisitor.prototype.ObjectExpression=function(node){var i,len,ref1,setter;for(node=this.Expression(node),ref1=node.properties,i=0,len=ref1.length;i<len;i++)setter=ref1[i],setter.key=this.visit(setter.key),setter.value=this.visit(setter.value);return node},exports.FunctionExpression=function(superClass){function FunctionExpression(id,params,body){this.id=id,this.params=params,this.body=body,FunctionExpression.__super__.constructor.call(this)}return extend(FunctionExpression,superClass),FunctionExpression}(Expression),JavaScriptVisitor.prototype.FunctionExpression=function(node){return node=this.Expression(node),node.id=this.visit(node.id),node.params=this.visit(node.params),node.body=this.visit(node.body),node},exports.SequenceExpression=function(superClass){function SequenceExpression(expressions){this.expressions=expressions,SequenceExpression.__super__.constructor.call(this)}return extend(SequenceExpression,superClass),SequenceExpression}(Expression),JavaScriptVisitor.prototype.SequenceExpression=function(node){return node=this.Expression(node),node.expressions=this.visit(node.expressions),node},exports.UnaryExpression=function(superClass){function UnaryExpression(operator,prefix,argument){this.operator=operator,this.prefix=prefix,this.argument=argument,UnaryExpression.__super__.constructor.call(this)}return extend(UnaryExpression,superClass),UnaryExpression}(Expression),JavaScriptVisitor.prototype.UnaryExpression=function(node){return node=this.Expression(node),node.argument=this.visit(node.argument),node},exports.BinaryExpression=function(superClass){function BinaryExpression(operator,left,right){this.operator=operator,this.left=left,this.right=right,BinaryExpression.__super__.constructor.call(this)}
return extend(BinaryExpression,superClass),BinaryExpression}(Expression),JavaScriptVisitor.prototype.BinaryExpression=function(node){return node=this.Expression(node),node.left=this.visit(node.left),node.right=this.visit(node.right),node},exports.AssignmentExpression=function(superClass){function AssignmentExpression(operator,left,right){this.operator=operator,this.left=left,this.right=right,AssignmentExpression.__super__.constructor.call(this)}return extend(AssignmentExpression,superClass),AssignmentExpression}(Expression),JavaScriptVisitor.prototype.AssignmentExpression=function(node){return node=this.Expression(node),node.left=this.visit(node.left),node.right=this.visit(node.right),node},exports.UpdateExpression=function(superClass){function UpdateExpression(operator,argument,prefix){this.operator=operator,this.argument=argument,this.prefix=prefix,UpdateExpression.__super__.constructor.call(this)}return extend(UpdateExpression,superClass),UpdateExpression}(Expression),JavaScriptVisitor.prototype.UpdateExpression=function(node){return node=this.Expression(node),node.argument=this.visit(node.argument),node},exports.LogicalExpression=function(superClass){function LogicalExpression(operator,left,right){this.operator=operator,this.left=left,this.right=right,LogicalExpression.__super__.constructor.call(this)}return extend(LogicalExpression,superClass),LogicalExpression}(Expression),JavaScriptVisitor.prototype.LogicalExpression=function(node){return node=this.Expression(node),node.left=this.visit(node.left),node.right=this.visit(node.right),node},exports.ConditionalExpression=function(superClass){function ConditionalExpression(test,alternate,consequent){this.test=test,this.alternate=alternate,this.consequent=consequent,ConditionalExpression.__super__.constructor.call(this)}return extend(ConditionalExpression,superClass),ConditionalExpression}(Expression),JavaScriptVisitor.prototype.ConditionalExpression=function(node){return node=this.Expression(node),node.test=this.visit(node.test),node.alternate=this.visit(node.alternate),node.consequent=this.visit(node.consequent),node},exports.NewExpression=function(superClass){function NewExpression(callee,_arguments){this.callee=callee,this.arguments=_arguments,NewExpression.__super__.constructor.call(this)}return extend(NewExpression,superClass),NewExpression}(Expression),JavaScriptVisitor.prototype.NewExpression=function(node){return node=this.Expression(node),node.callee=this.visit(node.callee),node.arguments=this.visit(node.arguments),node},exports.CallExpression=function(superClass){function CallExpression(callee,_arguments){this.callee=callee,this.arguments=_arguments,CallExpression.__super__.constructor.call(this)}return extend(CallExpression,superClass),CallExpression}(Expression),JavaScriptVisitor.prototype.CallExpression=function(node){return node=this.Expression(node),node.callee=this.visit(node.callee),node.arguments=this.visit(node.arguments),node},exports.MemberExpression=function(superClass){function MemberExpression(object,property,computed){this.object=object,this.property=property,this.computed=computed,MemberExpression.__super__.constructor.call(this)}return extend(MemberExpression,superClass),MemberExpression}(Expression),JavaScriptVisitor.prototype.MemberExpression=function(node){return node=this.Expression(node),node.object=this.visit(node.object),node.property=this.visit(node.property),node},exports.Pattern=Pattern=function(superClass){function Pattern(){Pattern.__super__.constructor.call(this)}return extend(Pattern,superClass),Pattern}(JavaScriptNode),JavaScriptVisitor.prototype.Pattern=function(node){return node=this.JavaScriptNode(node)},exports.ObjectPattern=function(superClass){function ObjectPattern(properties){this.properties=properties,ObjectPattern.__super__.constructor.call(this)}return extend(ObjectPattern,superClass),ObjectPattern}(Pattern),JavaScriptVisitor.prototype.ObjectPattern=function(node){var i,len,ref1,setter;for(node=this.Pattern(node),ref1=node.properties,i=0,len=ref1.length;i<len;i++)setter=ref1[i],setter.key=this.visit(setter.key),setter.value=this.visit(setter.value);return node},exports.ArrayPattern=function(superClass){function ArrayPattern(elements){this.elements=elements,ArrayPattern.__super__.constructor.call(this)}return extend(ArrayPattern,superClass),ArrayPattern}(Pattern),JavaScriptVisitor.prototype.ArrayPattern=function(node){return node=this.Pattern(node),node.elements=this.visit(node.elements),node},exports.SwitchCase=function(superClass){function SwitchCase(test,consequent){this.test=test,this.consequent=consequent,SwitchCase.__super__.constructor.call(this)}return extend(SwitchCase,superClass),SwitchCase}(JavaScriptNode),JavaScriptVisitor.prototype.SwitchCase=function(node){return node=this.JavaScriptNode(node),node.test=this.visit(node.test),node.consequent=this.visit(node.consequent),node},exports.CatchClause=function(superClass){function CatchClause(param,body){this.param=param,this.body=body,CatchClause.__super__.constructor.call(this)}return extend(CatchClause,superClass),CatchClause}(JavaScriptNode),JavaScriptVisitor.prototype.CatchClause=function(node){return node=this.JavaScriptNode(node),node.param=this.visit(node.param),node.body=this.visit(node.body),node},exports.Identifier=function(superClass){function Identifier(name){this.name=name,Identifier.__super__.constructor.call(this)}return extend(Identifier,superClass),Identifier}(JavaScriptNode),JavaScriptVisitor.prototype.Identifier=function(node){return node=this.JavaScriptNode(node)},exports.Literal=function(superClass){function Literal(value){this.value=value,Literal.__super__.constructor.call(this)}return extend(Literal,superClass),Literal}(Expression),JavaScriptVisitor.prototype.Literal=function(node){return node=this.Expression(node)}}).call(this)},{"./Node":16}],15:[function(_dereq_,module,exports){(function(){var JS,Q,_,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;_=_dereq_("./Utilities"),JS=_dereq_("./JavaScriptNodes"),Q=_dereq_("./QueryNodes"),exports.JavaScriptToQueryVisitor=function(superClass){function JavaScriptToQueryVisitor(context){this.context=context}return extend(JavaScriptToQueryVisitor,superClass),JavaScriptToQueryVisitor.prototype.getSource=function(node){var ref,ref1;return this.context.source.slice(null!=node&&null!=(ref=node.range)?ref[0]:void 0,+((null!=node&&null!=(ref1=node.range)?ref1[1]:void 0)-1)+1||9e9)},JavaScriptToQueryVisitor.prototype.invalid=function(node){throw"The expression '"+this.getSource(node)+"'' is not supported."},JavaScriptToQueryVisitor.prototype.translateUnary=function(node,mapping){var op,value;return op=mapping[node.operator],op?(value=this.visit(node.argument),new Q.UnaryExpression(op,value)):null},JavaScriptToQueryVisitor.prototype.translateBinary=function(node,mapping){var left,op,right;return op=mapping[node.operator],op?(left=this.visit(node.left),right=this.visit(node.right),new Q.BinaryExpression(op,left,right)):null},JavaScriptToQueryVisitor.prototype.visit=function(node){var visited;return visited=JavaScriptToQueryVisitor.__super__.visit.call(this,node),node===visited&&this.invalid(node),visited},JavaScriptToQueryVisitor.prototype.MemberExpression=function(node){var expr;return expr=function(){var ref,ref1,ref2,ref3;return"ThisExpression"===(null!=node&&null!=(ref=node.object)?ref.type:void 0)&&"Identifier"===(null!=node&&null!=(ref1=node.property)?ref1.type:void 0)?new Q.MemberExpression(node.property.name):"MemberExpression"===(null!=node&&null!=(ref2=node.object)?ref2.type:void 0)&&"ThisExpression"===(null!=(ref3=node.object.object)?ref3.type:void 0)&&"Identifier"===node.property.type&&"length"===node.property.name?new Q.InvocationExpression(Q.Methods.Length,new Q.MemberExpression(node.object.property.name)):void 0}(),null!=expr?expr:JavaScriptToQueryVisitor.__super__.MemberExpression.call(this,node)},JavaScriptToQueryVisitor.prototype.Literal=function(node){return new Q.ConstantExpression(node.value)},JavaScriptToQueryVisitor.prototype.UnaryExpression=function(node){var mapping,ref;return"+"===node.operator?this.visit(node.argument):(mapping={"!":Q.UnaryOperators.Not,"-":Q.UnaryOperators.Negate},null!=(ref=this.translateUnary(node,mapping))?ref:JavaScriptToQueryVisitor.__super__.UnaryExpression.call(this,node))},JavaScriptToQueryVisitor.prototype.UpdateExpression=function(node){var mapping,ref;return mapping={"++":Q.UnaryOperators.Increment,"--":Q.UnaryOperators.Decrement},null!=(ref=this.translateUnary(node,mapping))?ref:JavaScriptToQueryVisitor.__super__.UpdateExpression.call(this,node)},JavaScriptToQueryVisitor.prototype.LogicalExpression=function(node){var mapping,ref;return mapping={"&&":Q.BinaryOperators.And,"||":Q.BinaryOperators.Or},null!=(ref=this.translateBinary(node,mapping))?ref:JavaScriptToQueryVisitor.__super__.LogicalExpression.call(this,node)},JavaScriptToQueryVisitor.prototype.BinaryExpression=function(node){var k,left,mapping,properties,ref,v,value;return mapping={"+":Q.BinaryOperators.Add,"-":Q.BinaryOperators.Subtract,"*":Q.BinaryOperators.Multiply,"/":Q.BinaryOperators.Divide,"%":Q.BinaryOperators.Modulo,">":Q.BinaryOperators.GreaterThan,">=":Q.BinaryOperators.GreaterThanOrEqual,"<":Q.BinaryOperators.LessThan,"<=":Q.BinaryOperators.LessThanOrEqual,"!=":Q.BinaryOperators.NotEqual,"!==":Q.BinaryOperators.NotEqual,"==":Q.BinaryOperators.Equal,"===":Q.BinaryOperators.Equal},function(){var ref1,ref2;return null!=(ref=this.translateBinary(node,mapping))?ref:"in"===node.operator&&"Literal"===(null!=(ref1=node.right)?ref1.type:void 0)&&_.isArray(null!=(ref2=node.right)?ref2.value:void 0)?node.right.value.length>0?(left=this.visit(node.left),Q.QueryExpression.groupClauses(Q.BinaryOperators.Or,function(){var i,len,ref3,results;for(ref3=node.right.value,results=[],i=0,len=ref3.length;i<len;i++){if(value=ref3[i],_.isObject(value)){if(properties=function(){var results1;results1=[];for(k in value)v=value[k],results1.push(v);return results1}(),1!==(null!=properties?properties.length:void 0))throw"in operator requires comparison objects with a single field, not "+value+" ("+JSON.stringify(value)+"), for expression '"+this.getSource(node)+"'";value=properties[0]}results.push(new Q.BinaryExpression(Q.BinaryOperators.Equal,left,new Q.ConstantExpression(value)))}return results}.call(this))):new Q.BinaryExpression(Q.BinaryOperators.Equal,new Q.ConstantExpression(!0),new Q.ConstantExpression(!1)):JavaScriptToQueryVisitor.__super__.BinaryExpression.call(this,node)}.call(this)},JavaScriptToQueryVisitor.prototype.CallExpression=function(node){var expr,func,getSingleArg,getTwoArgs,member,method,ref;return getSingleArg=function(_this){return function(name){var ref;if(1!==(null!=(ref=node.arguments)?ref.length:void 0))throw"Function "+name+" expects one argument in expression '"+_this.getSource(node)+"'";return _this.visit(node.arguments[0])}}(this),getTwoArgs=function(_this){return function(member,name){var ref;if(2!==(null!=(ref=node.arguments)?ref.length:void 0))throw"Function "+name+" expects two arguments in expression '"+_this.getSource(node)+"'";return[member,_this.visit(node.arguments[0]),_this.visit(node.arguments[1])]}}(this),func=null!=node&&null!=(ref=node.callee)?ref.value:void 0,expr=function(){var ref1,ref2,ref3,ref4,ref5,ref6,ref7;if(func===Math.floor)return new Q.InvocationExpression(Q.Methods.Floor,[getSingleArg("floor")]);if(func===Math.ceil)return new Q.InvocationExpression(Q.Methods.Ceiling,[getSingleArg("ceil")]);if(func===Math.round)return new Q.InvocationExpression(Q.Methods.Round,[getSingleArg("round")]);if("MemberExpression"===node.callee.type&&!0===(null!=(ref1=node.callee.object)?ref1.__hasThisExp:void 0)){if(member="CallExpression"===(null!=node&&null!=(ref2=node.callee)&&null!=(ref3=ref2.object)?ref3.type:void 0)?this.visit(node.callee.object):new Q.MemberExpression(null!=(ref4=node.callee.object)&&null!=(ref5=ref4.property)?ref5.name:void 0),"toUpperCase"===(method=null!=(ref6=node.callee)&&null!=(ref7=ref6.property)?ref7.name:void 0))return new Q.InvocationExpression(Q.Methods.ToUpperCase,[member]);if("toLowerCase"===method)return new Q.InvocationExpression(Q.Methods.ToLowerCase,[member]);if("trim"===method)return new Q.InvocationExpression(Q.Methods.Trim,[member]);if("indexOf"===method)return new Q.InvocationExpression(Q.Methods.IndexOf,[member,getSingleArg("indexOf")]);if("concat"===method)return new Q.InvocationExpression(Q.Methods.Concat,[member,getSingleArg("concat")]);if("substring"===method||"substr"===method)return new Q.InvocationExpression(Q.Methods.Substring,getTwoArgs(member,"substring"));if("replace"===method)return new Q.InvocationExpression(Q.Methods.Replace,getTwoArgs(member,"replace"));if("getFullYear"===method||"getUTCFullYear"===method)return new Q.InvocationExpression(Q.Methods.Year,[member]);if("getYear"===method)return new Q.BinaryExpression(Q.BinaryOperators.Subtract,new Q.InvocationExpression(Q.Methods.Year,[member]),new Q.ConstantExpression(1900));if("getMonth"===method||"getUTCMonth"===method)return new Q.BinaryExpression(Q.BinaryOperators.Subtract,new Q.InvocationExpression(Q.Methods.Month,[member]),new Q.ConstantExpression(1));if("getDate"===method||"getUTCDate"===method)return new Q.InvocationExpression(Q.Methods.Day,[member])}}.call(this),null!=expr?expr:JavaScriptToQueryVisitor.__super__.CallExpression.call(this,node)},JavaScriptToQueryVisitor}(JS.JavaScriptVisitor)}).call(this)},{"./JavaScriptNodes":14,"./QueryNodes":20,"./Utilities":21}],16:[function(_dereq_,module,exports){(function(){var _;_=_dereq_("./Utilities"),exports.Node=function(){function Node(){this.type=_.functionName(this.constructor)}return Node.prototype.type="Node",Node}(),exports.Visitor=function(){function Visitor(){}return Visitor.prototype.visit=function(node){var element,i,len,results;if(_.isArray(node)){for(results=[],i=0,len=node.length;i<len;i++)element=node[i],results.push(this.visit(element));return results}if(null!=node?node.type:void 0){if(_.isFunction(this[node.type]))return this[node.type](node);throw"Unsupported expression "+this.getSource(node)}return node},Visitor.prototype.getSource=function(node){return null},Visitor}()}).call(this)},{"./Utilities":21}],17:[function(_dereq_,module,exports){(function(){var ODataFilterQueryVisitor,Q,Query,_,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;_=_dereq_("./Utilities"),Q=_dereq_("./QueryNodes"),Query=_dereq_("./Query").Query,exports.ODataProvider=function(){function ODataProvider(){}return ODataProvider.prototype.toQuery=function(query){var odata,s,url;return odata=this.toOData(query,!0),url="/"+odata.table,s="?",odata.filters&&(url+=s+"$filter="+odata.filters,s="&"),odata.orderClauses&&(url+=s+"$orderby="+odata.orderClauses,s="&"),odata.skip&&(url+=s+"$skip="+odata.skip,s="&"),(odata.take||0===odata.take)&&(url+=s+"$top="+odata.take,s="&"),odata.selections&&(url+=s+"$select="+odata.selections,s="&"),odata.includeTotalCount&&(url+=s+"$inlinecount=allpages"),odata.includeDeleted&&(url+=s+"__includeDeleted=true"),url},ODataProvider.prototype.toOData=function(query,encodeForUri){var asc,components,name,order,orderClauses,ordering,ref,ref1;return null==encodeForUri&&(encodeForUri=!1),components=null!=(ref=null!=query?query.getComponents():void 0)?ref:{},ordering=function(){var ref1,results;ref1=null!=components?components.ordering:void 0,results=[];for(name in ref1)asc=ref1[name],results.push(asc?name:name+" desc");return results}(),orderClauses=function(){var i,len,ref1,results;for(ref1=null!=components?components.orderClauses:void 0,results=[],i=0,len=ref1.length;i<len;i++)order=ref1[i],results.push(order.ascending?order.name:order.name+" desc");return results}(),{table:null!=components?components.table:void 0,filters:ODataFilterQueryVisitor.convert(components.filters,encodeForUri),ordering:null!=ordering?ordering.toString():void 0,orderClauses:null!=orderClauses?orderClauses.toString():void 0,skip:null!=components?components.skip:void 0,take:null!=components?components.take:void 0,selections:null!=components&&null!=(ref1=components.selections)?ref1.toString():void 0,includeTotalCount:null!=components?components.includeTotalCount:void 0,includeDeleted:null!=components?components.includeDeleted:void 0}},ODataProvider.prototype.fromOData=function(table,filters,ordering,skip,take,selections,includeTotalCount,includeDeleted){var direction,field,i,item,j,len,len1,query,ref,ref1,ref2,ref3;for(query=new Query(table),filters&&query.where(filters),(skip||0===skip)&&query.skip(skip),(take||0===take)&&query.take(take),includeTotalCount&&query.includeTotalCount(),includeDeleted&&query.includeDeleted(),ref1=null!=(ref=null!=selections?selections.split(","):void 0)?ref:[],i=0,len=ref1.length;i<len;i++)field=ref1[i],query.select(field.trim());for(ref2=function(){var k,len1,ref2,ref3,results;for(ref3=null!=(ref2=null!=ordering?ordering.split(","):void 0)?ref2:[],results=[],k=0,len1=ref3.length;k<len1;k++)item=ref3[k],results.push(item.trim().split(" "));return results}(),j=0,len1=ref2.length;j<len1;j++)ref3=ref2[j],field=ref3[0],direction=ref3[1],"DESC"!==(null!=direction?direction.toUpperCase():void 0)?query.orderBy(field):query.orderByDescending(field);return query},ODataProvider}(),ODataFilterQueryVisitor=function(superClass){function ODataFilterQueryVisitor(encodeForUri1){this.encodeForUri=encodeForUri1}return extend(ODataFilterQueryVisitor,superClass),ODataFilterQueryVisitor.convert=function(filters,encodeForUri){var ref,visitor;return visitor=new ODataFilterQueryVisitor(encodeForUri),null!=(ref=filters?visitor.visit(filters):void 0)?ref:null},ODataFilterQueryVisitor.prototype.toOData=function(value){var text;if(_.isNumber(value)||_.isBoolean(value))return value.toString();if(_.isString(value))return value=value.replace(/'/g,"''"),null!=this.encodeForUri&&!0===this.encodeForUri&&(value=encodeURIComponent(value)),"'"+value+"'";if(_.isDate(value))return text=JSON.stringify(value),text.length>2&&(text=text.slice(1,+(text.length-2)+1||9e9)),"datetime'"+(text=text.replace(/(T\d{2}:\d{2}:\d{2})Z$/,function(all,time){var msec;return msec=String(value.getMilliseconds()+1e3).substring(1),time+"."+msec+"Z"}))+"'";if(value)throw"Unsupported literal value "+value;return"null"},ODataFilterQueryVisitor.prototype.ConstantExpression=function(node){return this.toOData(node.value)},ODataFilterQueryVisitor.prototype.MemberExpression=function(node){return node.member},ODataFilterQueryVisitor.prototype.UnaryExpression=function(node){if(node.operator===Q.UnaryOperators.Not)return"not "+this.visit(node.operand);if(node.operator===Q.UnaryOperators.Negate)return"(0 sub "+this.visit(node.operand)+")";throw"Unsupported operator "+node.operator},ODataFilterQueryVisitor.prototype.BinaryExpression=function(node){var mapping,op;if(mapping={And:"and",Or:"or",Add:"add",Subtract:"sub",Multiply:"mul",Divide:"div",Modulo:"mod",GreaterThan:"gt",GreaterThanOrEqual:"ge",LessThan:"lt",LessThanOrEqual:"le",NotEqual:"ne",Equal:"eq"},op=mapping[node.operator])return"("+this.visit(node.left)+" "+op+" "+this.visit(node.right)+")";throw"Unsupported operator "+node.operator},ODataFilterQueryVisitor.prototype.InvocationExpression=function(node){var mapping,method;if(mapping={Length:"length",ToUpperCase:"toupper",ToLowerCase:"tolower",Trim:"trim",IndexOf:"indexof",Replace:"replace",Substring:"substring",Concat:"concat",Day:"day",Month:"month",Year:"year",Floor:"floor",Ceiling:"ceiling",Round:"round"},method=mapping[node.method])return method+"("+this.visit(node.args)+")";throw"Invocation of unsupported method "+node.method},ODataFilterQueryVisitor.prototype.LiteralExpression=function(node){var ch,i,inString,len,literal,parenBalance,ref;for(literal="",parenBalance=0,inString=!1,ref=node.queryString,i=0,len=ref.length;i<len&&(ch=ref[i],!(parenBalance<0));i++)if(inString)literal+=ch,inString="'"!==ch;else if("?"===ch){if(!node.args||node.args.length<=0)throw"Too few arguments for "+node.queryString+".";literal+=this.toOData(node.args.shift())}else"'"===ch?(literal+=ch,inString=!0):"("===ch?(parenBalance+=1,literal+=ch):")"===ch?(parenBalance-=1,literal+=ch):literal+=ch;if(node.args&&node.args.length>0)throw"Too many arguments for "+node.queryString;if(0!==parenBalance)throw"Unbalanced parentheses in "+node.queryString;return literal.trim().length>0?"("+literal+")":literal},ODataFilterQueryVisitor}(Q.QueryExpressionVisitor)}).call(this)},{"./Query":19,"./QueryNodes":20,"./Utilities":21}],18:[function(_dereq_,module,exports){(function(){var IndependenceNominator,JS,PartialEvaluator,_,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;_=_dereq_("./Utilities"),JS=_dereq_("./JavaScriptNodes"),exports.PartialEvaluator=PartialEvaluator=function(superClass){function PartialEvaluator(context1){this.context=context1}return extend(PartialEvaluator,superClass),PartialEvaluator.prototype.visit=function(node){var key,params,ref,ref1,ref2,ref3,source,thunk,value,values;return node.__independent&&"Literal"!==node.type&&node.type?"Identifier"===node.type&&this.context.environment[node.name]?new JS.Literal(this.context.environment[node.name]):(source=this.context.source.slice(null!=node&&null!=(ref=node.range)?ref[0]:void 0,+((null!=node&&null!=(ref1=node.range)?ref1[1]:void 0)-1)+1||9e9),params=null!=(ref2=function(){var ref3,results;ref3=this.context.environment,results=[];for(key in ref3)value=ref3[key],results.push(key);return results}.call(this))?ref2:[],values=null!=(ref3=function(){var ref4,results;ref4=this.context.environment,results=[];for(key in ref4)value=ref4[key],results.push(JSON.stringify(value));return results}.call(this))?ref3:[],thunk="(function("+params+") { return "+source+"; })("+values+")",value=eval(thunk),new JS.Literal(value)):PartialEvaluator.__super__.visit.call(this,node)},PartialEvaluator.evaluate=function(context){var evaluator,nominator;return nominator=new IndependenceNominator(context),nominator.visit(context.expression),evaluator=new PartialEvaluator(context),evaluator.visit(context.expression)},PartialEvaluator}(JS.JavaScriptVisitor),exports.IndependenceNominator=IndependenceNominator=function(superClass){function IndependenceNominator(context1){this.context=context1}return extend(IndependenceNominator,superClass),IndependenceNominator.prototype.Literal=function(node){return IndependenceNominator.__super__.Literal.call(this,node),node.__independent=!0,node.__hasThisExp=!1,node},IndependenceNominator.prototype.ThisExpression=function(node){return IndependenceNominator.__super__.ThisExpression.call(this,node),node.__independent=!1,node.__hasThisExp=!0,node},IndependenceNominator.prototype.Identifier=function(node){return IndependenceNominator.__super__.Identifier.call(this,node),node.__independent=!0,node.__hasThisExp=!1,node},IndependenceNominator.prototype.MemberExpression=function(node){var ref;return IndependenceNominator.__super__.MemberExpression.call(this,node),node.__hasThisExp=null!=(ref=node.object)?ref.__hasThisExp:void 0,node.__hasThisExp&&(node.__independent=!1,null!=node&&(node.property.__independent=!1)),node},IndependenceNominator.prototype.CallExpression=function(node){return IndependenceNominator.__super__.CallExpression.call(this,node),node.__hasThisExp=node.callee.__hasThisExp,node},IndependenceNominator.prototype.ObjectExpression=function(node){var i,independence,j,len,len1,ref,ref1,setter;for(IndependenceNominator.__super__.ObjectExpression.call(this,node),ref=node.properties,i=0,len=ref.length;i<len;i++)setter=ref[i],setter.key.__independent=!1;for(independence=!0,ref1=node.properties,j=0,len1=ref1.length;j<len1;j++)setter=ref1[j],independence&=setter.value.__independent;return node.__independent=!!independence,node},IndependenceNominator.prototype.visit=function(node){var i,independence,isIndependent,len,name,v,value;if(IndependenceNominator.__super__.visit.call(this,node),!Object.prototype.hasOwnProperty.call(node,"__independent")){independence=!0,isIndependent=function(node){var ref;return!_.isObject(node)||null!=(ref=value.__independent)&&ref};for(name in node)if(value=node[name],_.isArray(value))for(i=0,len=value.length;i<len;i++)v=value[i],independence&=isIndependent(v);else _.isObject(value)&&(independence&=isIndependent(value));node.__independent=!!independence}return node},IndependenceNominator}(JS.JavaScriptVisitor)}).call(this)},{"./JavaScriptNodes":14,"./Utilities":21}],19:[function(_dereq_,module,exports){(function(){var JavaScript,ODataProvider,Q,Query,_,slice=[].slice;_=_dereq_("./Utilities"),Q=_dereq_("./QueryNodes"),JavaScript=_dereq_("./JavaScript").JavaScript,exports.Query=Query=function(){function Query(table,context){var _context,_filters,_includeDeleted,_includeTotalCount,_orderClauses,_ordering,_projection,_selections,_skip,_table,_take,_version;if(!table||!_.isString(table))throw"Expected the name of a table!";_table=table,_context=context,_filters=null,_projection=null,_selections=[],_ordering={},_orderClauses=[],_skip=null,_take=null,_includeTotalCount=!1,_includeDeleted=!1,_version=0,this.getComponents=function(){return{filters:_filters,selections:_selections,projection:_projection,ordering:_ordering,orderClauses:_orderClauses,skip:_skip,take:_take,table:_table,context:_context,includeTotalCount:_includeTotalCount,includeDeleted:_includeDeleted,version:_version}},this.setComponents=function(components){var ascending,i,len,name,property,ref,ref1,ref10,ref11,ref2,ref3,ref4,ref5,ref6,ref7,ref8,ref9;if(_version++,_filters=null!=(ref=null!=components?components.filters:void 0)?ref:null,_selections=null!=(ref1=null!=components?components.selections:void 0)?ref1:[],_projection=null!=(ref2=null!=components?components.projection:void 0)?ref2:null,_skip=null!=(ref3=null!=components?components.skip:void 0)?ref3:null,_take=null!=(ref4=null!=components?components.take:void 0)?ref4:null,_includeTotalCount=null!=(ref5=null!=components?components.includeTotalCount:void 0)&&ref5,_includeDeleted=null!=(ref6=null!=components?components.includeDeleted:void 0)&&ref6,_table=null!=(ref7=null!=components?components.table:void 0)?ref7:null,_context=null!=(ref8=null!=components?components.context:void 0)?ref8:null,null!=components?components.orderClauses:void 0)for(_orderClauses=null!=(ref9=null!=components?components.orderClauses:void 0)?ref9:[],_ordering={},i=0,len=_orderClauses.length;i<len;i++)ref10=_orderClauses[i],name=ref10.name,ascending=ref10.ascending,_ordering[name]=ascending;else{_ordering=null!=(ref11=null!=components?components.ordering:void 0)?ref11:{},_orderClauses=[];for(property in _ordering)_orderClauses.push({name:property,ascending:!!_ordering[property]})}return this},this.where=function(){var args,constraint,expr,name,value;return constraint=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],_version++,expr=function(){if(_.isFunction(constraint))return JavaScript.transformConstraint(constraint,args);if(_.isObject(constraint))return Q.QueryExpression.groupClauses(Q.BinaryOperators.And,function(){var results;results=[];for(name in constraint)value=constraint[name],results.push(expr=new Q.BinaryExpression(Q.BinaryOperators.Equal,new Q.MemberExpression(name),new Q.ConstantExpression(value)));return results}());if(_.isString(constraint))return new Q.LiteralExpression(constraint,args);throw"Expected a function, object, or string, not "+constraint}(),_filters=Q.QueryExpression.groupClauses(Q.BinaryOperators.And,[_filters,expr]),this},this.select=function(){var i,len,param,parameters,projectionOrParameter;if(projectionOrParameter=arguments[0],parameters=2<=arguments.length?slice.call(arguments,1):[],_version++,_.isString(projectionOrParameter))for(_selections.push(projectionOrParameter),i=0,len=parameters.length;i<len;i++){if(param=parameters[i],!_.isString(param))throw"Expected string parameters, not "+param;_selections.push(param)}else{if(!_.isFunction(projectionOrParameter))throw"Expected a string or a function, not "+projectionOrParameter;_projection=projectionOrParameter,_selections=JavaScript.getProjectedFields(_projection)}return this},this.orderBy=function(){var i,j,len,len1,order,param,parameters,replacement;for(parameters=1<=arguments.length?slice.call(arguments,0):[],_version++,i=0,len=parameters.length;i<len;i++){if(param=parameters[i],!_.isString(param))throw"Expected string parameters, not "+param;for(_ordering[param]=!0,replacement=!1,j=0,len1=_orderClauses.length;j<len1;j++)order=_orderClauses[j],order.name===param&&(replacement=!0,order.ascending=!0);replacement||_orderClauses.push({name:param,ascending:!0})}return this},this.orderByDescending=function(){var i,j,len,len1,order,param,parameters,replacement;for(parameters=1<=arguments.length?slice.call(arguments,0):[],_version++,i=0,len=parameters.length;i<len;i++){if(param=parameters[i],!_.isString(param))throw"Expected string parameters, not "+param;for(_ordering[param]=!1,replacement=!1,j=0,len1=_orderClauses.length;j<len1;j++)order=_orderClauses[j],order.name===param&&(replacement=!0,order.ascending=!1);replacement||_orderClauses.push({name:param,ascending:!1})}return this},this.skip=function(count){if(_version++,!_.isNumber(count))throw"Expected a number, not "+count;return _skip=count,this},this.take=function(count){if(_version++,!_.isNumber(count))throw"Expected a number, not "+count;return _take=count,this},this.includeTotalCount=function(){return _version++,_includeTotalCount=!0,this},this.includeDeleted=function(){return _version++,_includeDeleted=!0,this}}return Query.registerProvider=function(name,provider){return Query.Providers[name]=provider,Query.prototype["to"+name]=function(){return null!=provider&&"function"==typeof provider.toQuery?provider.toQuery(this):void 0}},Query.Providers={},Query.Expressions=Q,Query}(),ODataProvider=_dereq_("./ODataProvider").ODataProvider,Query.registerProvider("OData",new ODataProvider)}).call(this)},{"./JavaScript":13,"./ODataProvider":17,"./QueryNodes":20,"./Utilities":21}],20:[function(_dereq_,module,exports){(function(){var BinaryExpression,Node,QueryExpression,QueryExpressionVisitor,Visitor,ref,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ref=_dereq_("./Node"),Node=ref.Node,Visitor=ref.Visitor,exports.QueryExpression=QueryExpression=function(superClass){function QueryExpression(){QueryExpression.__super__.constructor.call(this)}return extend(QueryExpression,superClass),QueryExpression.groupClauses=function(operator,clauses){var combine;return combine=function(left,right){return left?right?new BinaryExpression(operator,left,right):left:right},clauses.reduce(combine,null)},QueryExpression}(Node),exports.QueryExpressionVisitor=QueryExpressionVisitor=function(superClass){function QueryExpressionVisitor(){QueryExpressionVisitor.__super__.constructor.call(this)}return extend(QueryExpressionVisitor,superClass),QueryExpressionVisitor.prototype.QueryExpression=function(node){return node},QueryExpressionVisitor}(Visitor),exports.ConstantExpression=function(superClass){function ConstantExpression(value){this.value=value,ConstantExpression.__super__.constructor.call(this)}return extend(ConstantExpression,superClass),ConstantExpression}(QueryExpression),
QueryExpressionVisitor.prototype.ConstantExpression=function(node){return this.QueryExpression(node)},exports.MemberExpression=function(superClass){function MemberExpression(member){this.member=member,MemberExpression.__super__.constructor.call(this)}return extend(MemberExpression,superClass),MemberExpression}(QueryExpression),QueryExpressionVisitor.prototype.MemberExpression=function(node){return this.QueryExpression(node)},exports.BinaryExpression=BinaryExpression=function(superClass){function BinaryExpression(operator1,left1,right1){this.operator=operator1,this.left=left1,this.right=right1,BinaryExpression.__super__.constructor.call(this)}return extend(BinaryExpression,superClass),BinaryExpression}(QueryExpression),QueryExpressionVisitor.prototype.BinaryExpression=function(node){return node=this.QueryExpression(node),node.left=this.visit(node.left),node.right=this.visit(node.right),node},exports.BinaryOperators={And:"And",Or:"Or",Add:"Add",Subtract:"Subtract",Multiply:"Multiply",Divide:"Divide",Modulo:"Modulo",GreaterThan:"GreaterThan",GreaterThanOrEqual:"GreaterThanOrEqual",LessThan:"LessThan",LessThanOrEqual:"LessThanOrEqual",NotEqual:"NotEqual",Equal:"Equal"},exports.UnaryExpression=function(superClass){function UnaryExpression(operator1,operand){this.operator=operator1,this.operand=operand,UnaryExpression.__super__.constructor.call(this)}return extend(UnaryExpression,superClass),UnaryExpression}(QueryExpression),QueryExpressionVisitor.prototype.UnaryExpression=function(node){return node=this.QueryExpression(node),node.operand=this.visit(node.operand),node},exports.UnaryOperators={Not:"Not",Negate:"Negate",Increment:"Increment",Decrement:"Decrement"},exports.InvocationExpression=function(superClass){function InvocationExpression(method,args){this.method=method,this.args=args,InvocationExpression.__super__.constructor.call(this)}return extend(InvocationExpression,superClass),InvocationExpression}(QueryExpression),QueryExpressionVisitor.prototype.InvocationExpression=function(node){return node=this.QueryExpression(node),node.args=this.visit(node.args),node},exports.Methods={Length:"Length",ToUpperCase:"ToUpperCase",ToLowerCase:"ToLowerCase",Trim:"Trim",IndexOf:"IndexOf",Replace:"Replace",Substring:"Substring",Concat:"Concat",Day:"Day",Month:"Month",Year:"Year",Floor:"Floor",Ceiling:"Ceiling",Round:"Round"},exports.LiteralExpression=function(superClass){function LiteralExpression(queryString,args){this.queryString=queryString,this.args=null!=args?args:[],LiteralExpression.__super__.constructor.call(this)}return extend(LiteralExpression,superClass),LiteralExpression}(QueryExpression),QueryExpressionVisitor.prototype.LiteralExpression=function(node){return this.QueryExpression(node)}}).call(this)},{"./Node":16}],21:[function(_dereq_,module,exports){(function(){var classOf,slice=[].slice;classOf=function(obj){return Object.prototype.toString.call(obj).slice(8,-1).toLowerCase()},null==Array.prototype.reduce&&(Array.prototype.reduce=function(){var accumulator,array,arrayLength,currentIndex,currentValue,moreArgs;if(accumulator=arguments[0],moreArgs=2<=arguments.length?slice.call(arguments,1):[],array=this,arrayLength=array.length,currentIndex=0,currentValue=void 0,null==array)throw new TypeError("Object is null or undefined");if("function"!=typeof accumulator)throw new TypeError("First argument is not callable");if(0===moreArgs.length){if(0===arrayLength)throw new TypeError("Array length is 0 and no second argument");currentValue=array[0],currentIndex=1}else currentValue=moreArgs[0];for(;currentIndex<arrayLength;)currentIndex in array&&(currentValue=accumulator.call(void 0,currentValue,array[currentIndex],array)),++currentIndex;return currentValue}),null==Array.prototype.map&&(Array.prototype.map=function(callback,thisArg){var elem,i,index,inputArray,len,len1,outputArray;if(void 0===this||null===this)throw new TypeError("this is null or not defined");if("function"!=typeof callback)throw new TypeError(callback+" is not a function");for(thisArg=thisArg||void 0,inputArray=Object(this),len=inputArray.length>>>0,outputArray=new Array(len),index=i=0,len1=inputArray.length;i<len1;index=++i)elem=inputArray[index],index in inputArray&&(outputArray[index]=callback.call(thisArg,elem,index,inputArray));return outputArray}),null==Array.isArray&&(Array.isArray=function(vArg){return"[object Array]"===Object.prototype.toString.call(vArg)}),exports.isObject=function(obj){return"object"===Object.prototype.toString.call(obj).slice(8,-1).toLowerCase()},exports.isString=function(obj){return"string"==typeof obj},exports.isFunction=function(obj){return"function"==typeof obj},exports.isArray=Array.isArray,exports.isNumber=function(obj){return"number"==typeof obj},exports.isBoolean=function(obj){return"boolean"==typeof obj},exports.isDate=function(obj){return"date"===classOf(obj)},exports.functionName=function(fn){var index,prefix,source;return"function"==typeof Function.prototype.name?Function.prototype.name.call(fn):(source=fn.toString(),prefix="function ",source.slice(0,+(prefix.length-1)+1||9e9)===prefix&&(index=source.indexOf("(",prefix.length))>prefix.length?source.slice(prefix.length,+(index-1)+1||9e9):null)}}).call(this)},{}],22:[function(_dereq_,module,exports){!function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS||code===PLUS_URL_SAFE?62:code===SLASH||code===SLASH_URL_SAFE?63:code<NUMBER?-1:code<NUMBER+10?code-NUMBER+26+26:code<UPPER+26?code-UPPER:code<LOWER+26?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;i<l;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;i<length;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0),PLUS_URL_SAFE="-".charCodeAt(0),SLASH_URL_SAFE="_".charCodeAt(0);exports.toByteArray=b64ToByteArray,exports.fromByteArray=uint8ToBase64}(void 0===exports?this.base64js={}:exports)},{}],23:[function(_dereq_,module,exports){},{}],24:[function(_dereq_,module,exports){(function(global){"use strict";function typedArraySupport(){function Bar(){}try{var arr=new Uint8Array(1);return arr.foo=function(){return 42},arr.constructor=Bar,42===arr.foo()&&arr.constructor===Bar&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){return this instanceof Buffer?(Buffer.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof arg?fromNumber(this,arg):"string"==typeof arg?fromString(this,arg,arguments.length>1?arguments[1]:"utf8"):fromObject(this,arg)):arguments.length>1?new Buffer(arg,arguments[1]):new Buffer(arg)}function fromNumber(that,length){if(that=allocate(that,length<0?0:0|checked(length)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<length;i++)that[i]=0;return that}function fromString(that,string,encoding){return"string"==typeof encoding&&""!==encoding||(encoding="utf8"),that=allocate(that,0|byteLength(string,encoding)),that.write(string,encoding),that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(null==object)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(object.buffer instanceof ArrayBuffer)return fromTypedArray(that,object);if(object instanceof ArrayBuffer)return fromArrayBuffer(that,object)}return object.length?fromArrayLike(that,object):fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=0|checked(buffer.length);return that=allocate(that,length),buffer.copy(that,0,0,length),that}function fromArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function fromTypedArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function fromArrayBuffer(that,array){return Buffer.TYPED_ARRAY_SUPPORT?(array.byteLength,that=Buffer._augment(new Uint8Array(array))):that=fromTypedArray(that,new Uint8Array(array)),that}function fromArrayLike(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function fromJsonObject(that,object){var array,length=0;"Buffer"===object.type&&isArray(object.data)&&(array=object.data,length=0|checked(array.length)),that=allocate(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function allocate(that,length){return Buffer.TYPED_ARRAY_SUPPORT?(that=Buffer._augment(new Uint8Array(length)),that.__proto__=Buffer.prototype):(that.length=length,that._isBuffer=!0),0!==length&&length<=Buffer.poolSize>>>1&&(that.parent=rootParent),that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);return delete buf.parent,buf}function byteLength(string,encoding){"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if(start|=0,end=void 0===end||end===1/0?this.length:0|end,encoding||(encoding="utf8"),start<0&&(start=0),end>this.length&&(end=this.length),end<=start)return"";for(;;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new Error("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;i++){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128==(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++)ret+=String.fromCharCode(127&buf[i]);return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(offset<0)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=stringtrim(str).replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!=0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;i++){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}var base64=_dereq_("base64-js"),ieee754=_dereq_("ieee754"),isArray=_dereq_("isarray");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT?(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array):(Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0),Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len&&a[i]===b[i];)++i;return i!==len&&(x=a[i],y=b[i]),x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(0===list.length)return new Buffer(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;i++)length+=list[i].length;var buf=new Buffer(length),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.byteLength=byteLength,Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?0:Buffer.compare(this,b)},Buffer.prototype.indexOf=function(val,byteOffset){function arrayIndexOf(arr,val,byteOffset){for(var foundIndex=-1,i=0;byteOffset+i<arr.length;i++)if(arr[byteOffset+i]===val[-1===foundIndex?0:i-foundIndex]){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===val.length)return byteOffset+foundIndex}else foundIndex=-1;return-1}if(byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset>>=0,0===this.length)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0&&(byteOffset=Math.max(this.length+byteOffset,0)),"string"==typeof val)return 0===val.length?-1:String.prototype.indexOf.call(this,val,byteOffset);if(Buffer.isBuffer(val))return arrayIndexOf(this,val,byteOffset);if("number"==typeof val)return Buffer.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,val,byteOffset):arrayIndexOf(this,[val],byteOffset);throw new TypeError("val must be string, number or Buffer")},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else if(isFinite(offset))offset|=0,isFinite(length)?(length|=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=0|length,length=swap}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)newBuf=Buffer._augment(this.subarray(start,end));else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;i<sliceLen;i++)newBuf[i]=this[i+start]}return newBuf.length&&(newBuf.parent=this.parent||this),newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset|=0,byteLength|=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset|=0,byteLength|=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=value<0?1:0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=value<0?1:0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),
end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;i--)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;i++)target[i+targetStart]=this[i+start];else target._set(this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),end<start)throw new RangeError("end < start");if(end!==start&&0!==this.length){if(start<0||start>=this.length)throw new RangeError("start out of bounds");if(end<0||end>this.length)throw new RangeError("end out of bounds");var i;if("number"==typeof value)for(i=start;i<end;i++)this[i]=value;else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;i<end;i++)this[i]=bytes[i%len]}return this}},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer.TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;i<len;i+=1)buf[i]=this[i];return buf.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(arr){return arr.constructor=Buffer,arr._isBuffer=!0,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.equals=BP.equals,arr.compare=BP.compare,arr.indexOf=BP.indexOf,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUIntLE=BP.readUIntLE,arr.readUIntBE=BP.readUIntBE,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readIntLE=BP.readIntLE,arr.readIntBE=BP.readIntBE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUIntLE=BP.writeUIntLE,arr.writeUIntBE=BP.writeUIntBE,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeIntLE=BP.writeIntLE,arr.writeIntBE=BP.writeIntBE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":22,ieee754:30,isarray:25}],25:[function(_dereq_,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],26:[function(_dereq_,module,exports){(function(Buffer){function isArray(arg){return Array.isArray?Array.isArray(arg):"[object Array]"===objectToString(arg)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return"[object Date]"===objectToString(d)}function isError(e){return"[object Error]"===objectToString(e)||e instanceof Error}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg}function objectToString(o){return Object.prototype.toString.call(o)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=Buffer.isBuffer}).call(this,{isBuffer:_dereq_("../../is-buffer/index.js")})},{"../../is-buffer/index.js":32}],27:[function(_dereq_,module,exports){!function(root,factory){"use strict";"function"==typeof define&&define.amd?define(["exports"],factory):factory(void 0!==exports?exports:root.esprima={})}(this,function(exports){"use strict";function assert(condition,message){if(!condition)throw new Error("ASSERT: "+message)}function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function octalToDecimal(ch){var octal="0"!==ch,code="01234567".indexOf(ch);return index<length&&isOctalDigit(source[index])&&(octal=!0,code=8*code+"01234567".indexOf(source[index++]),"0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])&&(code=8*code+"01234567".indexOf(source[index++]))),{code:code,octal:octal}}function isWhiteSpace(ch){return 32===ch||9===ch||11===ch||12===ch||160===ch||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return 10===ch||13===ch||8232===ch||8233===ch}function fromCodePoint(cp){return cp<65536?String.fromCharCode(cp):String.fromCharCode(55296+(cp-65536>>10))+String.fromCharCode(56320+(cp-65536&1023))}function isIdentifierStart(ch){return 36===ch||95===ch||ch>=65&&ch<=90||ch>=97&&ch<=122||92===ch||ch>=128&&Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch))}function isIdentifierPart(ch){return 36===ch||95===ch||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||92===ch||ch>=128&&Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch))}function isFutureReservedWord(id){switch(id){case"enum":case"export":case"import":case"super":return!0;default:return!1}}function isStrictModeReservedWord(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function isRestrictedWord(id){return"eval"===id||"arguments"===id}function isKeyword(id){switch(id.length){case 2:return"if"===id||"in"===id||"do"===id;case 3:return"var"===id||"for"===id||"new"===id||"try"===id||"let"===id;case 4:return"this"===id||"else"===id||"case"===id||"void"===id||"with"===id||"enum"===id;case 5:return"while"===id||"break"===id||"catch"===id||"throw"===id||"const"===id||"yield"===id||"class"===id||"super"===id;case 6:return"return"===id||"typeof"===id||"delete"===id||"switch"===id||"export"===id||"import"===id;case 7:return"default"===id||"finally"===id||"extends"===id;case 8:return"function"===id||"continue"===id||"debugger"===id;case 10:return"instanceof"===id;default:return!1}}function addComment(type,value,start,end,loc){var comment;assert("number"==typeof start,"Comment must have valid position"),state.lastCommentStart=start,comment={type:type,value:value},extra.range&&(comment.range=[start,end]),extra.loc&&(comment.loc=loc),extra.comments.push(comment),extra.attachComment&&(extra.leadingComments.push(comment),extra.trailingComments.push(comment)),extra.tokenize&&(comment.type=comment.type+"Comment",extra.delegate&&(comment=extra.delegate(comment)),extra.tokens.push(comment))}function skipSingleLineComment(offset){var start,loc,ch,comment;for(start=index-offset,loc={start:{line:lineNumber,column:index-lineStart-offset}};index<length;)if(ch=source.charCodeAt(index),++index,isLineTerminator(ch))return hasLineTerminator=!0,extra.comments&&(comment=source.slice(start+offset,index-1),loc.end={line:lineNumber,column:index-lineStart-1},addComment("Line",comment,start,index-1,loc)),13===ch&&10===source.charCodeAt(index)&&++index,++lineNumber,void(lineStart=index);extra.comments&&(comment=source.slice(start+offset,index),loc.end={line:lineNumber,column:index-lineStart},addComment("Line",comment,start,index,loc))}function skipMultiLineComment(){var start,loc,ch,comment;for(extra.comments&&(start=index-2,loc={start:{line:lineNumber,column:index-lineStart-2}});index<length;)if(ch=source.charCodeAt(index),isLineTerminator(ch))13===ch&&10===source.charCodeAt(index+1)&&++index,hasLineTerminator=!0,++lineNumber,++index,lineStart=index;else if(42===ch){if(47===source.charCodeAt(index+1))return++index,++index,void(extra.comments&&(comment=source.slice(start+2,index-2),loc.end={line:lineNumber,column:index-lineStart},addComment("Block",comment,start,index,loc)));++index}else++index;extra.comments&&(loc.end={line:lineNumber,column:index-lineStart},comment=source.slice(start+2,index),addComment("Block",comment,start,index,loc)),tolerateUnexpectedToken()}function skipComment(){var ch,start;for(hasLineTerminator=!1,start=0===index;index<length;)if(ch=source.charCodeAt(index),isWhiteSpace(ch))++index;else if(isLineTerminator(ch))hasLineTerminator=!0,++index,13===ch&&10===source.charCodeAt(index)&&++index,++lineNumber,lineStart=index,start=!0;else if(47===ch)if(47===(ch=source.charCodeAt(index+1)))++index,++index,skipSingleLineComment(2),start=!0;else{if(42!==ch)break;++index,++index,skipMultiLineComment()}else if(start&&45===ch){if(45!==source.charCodeAt(index+1)||62!==source.charCodeAt(index+2))break;index+=3,skipSingleLineComment(3)}else{if(60!==ch)break;if("!--"!==source.slice(index+1,index+4))break;++index,++index,++index,++index,skipSingleLineComment(4)}}function scanHexEscape(prefix){var i,len,ch,code=0;for(len="u"===prefix?4:2,i=0;i<len;++i){if(!(index<length&&isHexDigit(source[index])))return"";ch=source[index++],code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase())}return String.fromCharCode(code)}function scanUnicodeCodePointEscape(){var ch,code;for(ch=source[index],code=0,"}"===ch&&throwUnexpectedToken();index<length&&(ch=source[index++],isHexDigit(ch));)code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase());return(code>1114111||"}"!==ch)&&throwUnexpectedToken(),fromCodePoint(code)}function codePointAt(i){var cp,first,second;return cp=source.charCodeAt(i),cp>=55296&&cp<=56319&&(second=source.charCodeAt(i+1))>=56320&&second<=57343&&(first=cp,cp=1024*(first-55296)+second-56320+65536),cp}function getComplexIdentifier(){var cp,ch,id;for(cp=codePointAt(index),id=fromCodePoint(cp),index+=id.length,92===cp&&(117!==source.charCodeAt(index)&&throwUnexpectedToken(),++index,"{"===source[index]?(++index,ch=scanUnicodeCodePointEscape()):(ch=scanHexEscape("u"),cp=ch.charCodeAt(0),ch&&"\\"!==ch&&isIdentifierStart(cp)||throwUnexpectedToken()),id=ch);index<length&&(cp=codePointAt(index),isIdentifierPart(cp));)ch=fromCodePoint(cp),id+=ch,index+=ch.length,92===cp&&(id=id.substr(0,id.length-1),117!==source.charCodeAt(index)&&throwUnexpectedToken(),++index,"{"===source[index]?(++index,ch=scanUnicodeCodePointEscape()):(ch=scanHexEscape("u"),cp=ch.charCodeAt(0),ch&&"\\"!==ch&&isIdentifierPart(cp)||throwUnexpectedToken()),id+=ch);return id}function getIdentifier(){var start,ch;for(start=index++;index<length;){if(92===(ch=source.charCodeAt(index)))return index=start,getComplexIdentifier();if(ch>=55296&&ch<57343)return index=start,getComplexIdentifier();if(!isIdentifierPart(ch))break;++index}return source.slice(start,index)}function scanIdentifier(){var start,id,type;return start=index,id=92===source.charCodeAt(index)?getComplexIdentifier():getIdentifier(),type=1===id.length?Token.Identifier:isKeyword(id)?Token.Keyword:"null"===id?Token.NullLiteral:"true"===id||"false"===id?Token.BooleanLiteral:Token.Identifier,{type:type,value:id,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanPunctuator(){var token,str;switch(token={type:Token.Punctuator,value:"",lineNumber:lineNumber,lineStart:lineStart,start:index,end:index},str=source[index]){case"(":extra.tokenize&&(extra.openParenToken=extra.tokenValues.length),++index;break;case"{":extra.tokenize&&(extra.openCurlyToken=extra.tokenValues.length),state.curlyStack.push("{"),++index;break;case".":++index,"."===source[index]&&"."===source[index+1]&&(index+=2,str="...");break;case"}":++index,state.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++index;break;default:str=source.substr(index,4),">>>="===str?index+=4:(str=str.substr(0,3),"==="===str||"!=="===str||">>>"===str||"<<="===str||">>="===str?index+=3:(str=str.substr(0,2),"&&"===str||"||"===str||"=="===str||"!="===str||"+="===str||"-="===str||"*="===str||"/="===str||"++"===str||"--"===str||"<<"===str||">>"===str||"&="===str||"|="===str||"^="===str||"%="===str||"<="===str||">="===str||"=>"===str?index+=2:(str=source[index],"<>=!+-*%&|^/".indexOf(str)>=0&&++index)))}return index===token.start&&throwUnexpectedToken(),token.end=index,token.value=str,token}function scanHexLiteral(start){for(var number="";index<length&&isHexDigit(source[index]);)number+=source[index++];return 0===number.length&&throwUnexpectedToken(),isIdentifierStart(source.charCodeAt(index))&&throwUnexpectedToken(),{type:Token.NumericLiteral,value:parseInt("0x"+number,16),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanBinaryLiteral(start){var ch,number;for(number="";index<length&&("0"===(ch=source[index])||"1"===ch);)number+=source[index++];return 0===number.length&&throwUnexpectedToken(),index<length&&(ch=source.charCodeAt(index),(isIdentifierStart(ch)||isDecimalDigit(ch))&&throwUnexpectedToken()),{type:Token.NumericLiteral,value:parseInt(number,2),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanOctalLiteral(prefix,start){var number,octal;for(isOctalDigit(prefix)?(octal=!0,number="0"+source[index++]):(octal=!1,++index,number="");index<length&&isOctalDigit(source[index]);)number+=source[index++];return octal||0!==number.length||throwUnexpectedToken(),(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index)))&&throwUnexpectedToken(),{type:Token.NumericLiteral,value:parseInt(number,8),octal:octal,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function isImplicitOctalLiteral(){var i,ch;for(i=index+1;i<length;++i){if("8"===(ch=source[i])||"9"===ch)return!1;if(!isOctalDigit(ch))return!0}return!0}function scanNumericLiteral(){var number,start,ch;if(ch=source[index],assert(isDecimalDigit(ch.charCodeAt(0))||"."===ch,"Numeric literal must start with a decimal digit or a decimal point"),start=index,number="","."!==ch){if(number=source[index++],ch=source[index],"0"===number){if("x"===ch||"X"===ch)return++index,scanHexLiteral(start);if("b"===ch||"B"===ch)return++index,scanBinaryLiteral(start);if("o"===ch||"O"===ch)return scanOctalLiteral(ch,start);if(isOctalDigit(ch)&&isImplicitOctalLiteral())return scanOctalLiteral(ch,start)}for(;isDecimalDigit(source.charCodeAt(index));)number+=source[index++];ch=source[index]}if("."===ch){for(number+=source[index++];isDecimalDigit(source.charCodeAt(index));)number+=source[index++];ch=source[index]}if("e"===ch||"E"===ch)if(number+=source[index++],ch=source[index],"+"!==ch&&"-"!==ch||(number+=source[index++]),isDecimalDigit(source.charCodeAt(index)))for(;isDecimalDigit(source.charCodeAt(index));)number+=source[index++];else throwUnexpectedToken();return isIdentifierStart(source.charCodeAt(index))&&throwUnexpectedToken(),{type:Token.NumericLiteral,value:parseFloat(number),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanStringLiteral(){var quote,start,ch,unescaped,octToDec,str="",octal=!1;for(quote=source[index],assert("'"===quote||'"'===quote,"String literal must starts with a quote"),start=index,++index;index<length;){if((ch=source[index++])===quote){quote="";break}if("\\"===ch)if((ch=source[index++])&&isLineTerminator(ch.charCodeAt(0)))++lineNumber,"\r"===ch&&"\n"===source[index]&&++index,lineStart=index;else switch(ch){case"u":case"x":if("{"===source[index])++index,str+=scanUnicodeCodePointEscape();else{if(!(unescaped=scanHexEscape(ch)))throw throwUnexpectedToken();str+=unescaped}break;case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="\t";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="\v";break;case"8":case"9":str+=ch,tolerateUnexpectedToken();break;default:isOctalDigit(ch)?(octToDec=octalToDecimal(ch),octal=octToDec.octal||octal,str+=String.fromCharCode(octToDec.code)):str+=ch}else{if(isLineTerminator(ch.charCodeAt(0)))break;str+=ch}}return""!==quote&&(index=start,throwUnexpectedToken()),{type:Token.StringLiteral,value:str,octal:octal,lineNumber:startLineNumber,lineStart:startLineStart,start:start,end:index}}function scanTemplate(){var ch,start,rawOffset,terminated,head,tail,restore,unescaped,cooked="";for(terminated=!1,tail=!1,start=index,head="`"===source[index],rawOffset=2,++index;index<length;){if("`"===(ch=source[index++])){rawOffset=1,tail=!0,terminated=!0;break}if("$"===ch){if("{"===source[index]){state.curlyStack.push("${"),++index,terminated=!0;break}cooked+=ch}else if("\\"===ch)if(ch=source[index++],isLineTerminator(ch.charCodeAt(0)))++lineNumber,"\r"===ch&&"\n"===source[index]&&++index,lineStart=index;else switch(ch){case"n":cooked+="\n";break;case"r":cooked+="\r";break;case"t":cooked+="\t";break;case"u":case"x":"{"===source[index]?(++index,cooked+=scanUnicodeCodePointEscape()):(restore=index,unescaped=scanHexEscape(ch),unescaped?cooked+=unescaped:(index=restore,cooked+=ch));break;case"b":cooked+="\b";break;case"f":cooked+="\f";break;case"v":cooked+="\v";break;default:"0"===ch?(isDecimalDigit(source.charCodeAt(index))&&throwError(Messages.TemplateOctalLiteral),cooked+="\0"):isOctalDigit(ch)?throwError(Messages.TemplateOctalLiteral):cooked+=ch}else isLineTerminator(ch.charCodeAt(0))?(++lineNumber,"\r"===ch&&"\n"===source[index]&&++index,lineStart=index,cooked+="\n"):cooked+=ch}return terminated||throwUnexpectedToken(),head||state.curlyStack.pop(),{type:Token.Template,value:{cooked:cooked,raw:source.slice(start+1,index-rawOffset)},head:head,tail:tail,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function testRegExp(pattern,flags){var astralSubstitute="￿",tmp=pattern;flags.indexOf("u")>=0&&(tmp=tmp.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,function($0,$1,$2){var codePoint=parseInt($1||$2,16);return codePoint>1114111&&throwUnexpectedToken(null,Messages.InvalidRegExp),codePoint<=65535?String.fromCharCode(codePoint):astralSubstitute}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,astralSubstitute));try{RegExp(tmp)}catch(e){throwUnexpectedToken(null,Messages.InvalidRegExp)}try{return new RegExp(pattern,flags)}catch(exception){return null}}function scanRegExpBody(){var ch,str,classMarker,terminated,body;for(ch=source[index],assert("/"===ch,"Regular expression literal must start with a slash"),str=source[index++],classMarker=!1,terminated=!1;index<length;)if(ch=source[index++],str+=ch,"\\"===ch)ch=source[index++],isLineTerminator(ch.charCodeAt(0))&&throwUnexpectedToken(null,Messages.UnterminatedRegExp),str+=ch;else if(isLineTerminator(ch.charCodeAt(0)))throwUnexpectedToken(null,Messages.UnterminatedRegExp);else if(classMarker)"]"===ch&&(classMarker=!1);else{if("/"===ch){terminated=!0;break}"["===ch&&(classMarker=!0)}return terminated||throwUnexpectedToken(null,Messages.UnterminatedRegExp),body=str.substr(1,str.length-2),{value:body,literal:str}}function scanRegExpFlags(){var ch,str,flags,restore;for(str="",flags="";index<length&&(ch=source[index],isIdentifierPart(ch.charCodeAt(0)));)if(++index,"\\"===ch&&index<length)if("u"===(ch=source[index])){if(++index,restore=index,ch=scanHexEscape("u"))for(flags+=ch,str+="\\u";restore<index;++restore)str+=source[restore];else index=restore,flags+="u",str+="\\u";tolerateUnexpectedToken()}else str+="\\",tolerateUnexpectedToken();else flags+=ch,str+=ch;return{value:flags,literal:str}}function scanRegExp(){var start,body,flags,value;return scanning=!0,lookahead=null,skipComment(),start=index,body=scanRegExpBody(),flags=scanRegExpFlags(),value=testRegExp(body.value,flags.value),scanning=!1,extra.tokenize?{type:Token.RegularExpression,value:value,regex:{pattern:body.value,flags:flags.value},lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}:{literal:body.literal+flags.literal,value:value,regex:{pattern:body.value,flags:flags.value},start:start,end:index}}function collectRegex(){var pos,loc,regex,token;return skipComment(),pos=index,loc={start:{line:lineNumber,column:index-lineStart}},regex=scanRegExp(),loc.end={line:lineNumber,column:index-lineStart},extra.tokenize||(extra.tokens.length>0&&(token=extra.tokens[extra.tokens.length-1],token.range[0]===pos&&"Punctuator"===token.type&&("/"!==token.value&&"/="!==token.value||extra.tokens.pop())),extra.tokens.push({type:"RegularExpression",value:regex.literal,regex:regex.regex,range:[pos,index],loc:loc})),regex}function isIdentifierName(token){return token.type===Token.Identifier||token.type===Token.Keyword||token.type===Token.BooleanLiteral||token.type===Token.NullLiteral}function advanceSlash(){function testKeyword(value){return value&&value.length>1&&value[0]>="a"&&value[0]<="z"}var regex,previous,check;switch(previous=extra.tokenValues[extra.tokenValues.length-1],regex=null!==previous,previous){case"this":case"]":regex=!1;break;case")":check=extra.tokenValues[extra.openParenToken-1],regex="if"===check||"while"===check||"for"===check||"with"===check;break;case"}":regex=!1,testKeyword(extra.tokenValues[extra.openCurlyToken-3])?(check=extra.tokenValues[extra.openCurlyToken-4],regex=!!check&&FnExprTokens.indexOf(check)<0):testKeyword(extra.tokenValues[extra.openCurlyToken-4])&&(check=extra.tokenValues[extra.openCurlyToken-5],regex=!check||FnExprTokens.indexOf(check)<0)}return regex?collectRegex():scanPunctuator()}function advance(){var cp,token;return index>=length?{type:Token.EOF,lineNumber:lineNumber,lineStart:lineStart,start:index,end:index}:(cp=source.charCodeAt(index),isIdentifierStart(cp)?(token=scanIdentifier(),strict&&isStrictModeReservedWord(token.value)&&(token.type=Token.Keyword),token):40===cp||41===cp||59===cp?scanPunctuator():39===cp||34===cp?scanStringLiteral():46===cp?isDecimalDigit(source.charCodeAt(index+1))?scanNumericLiteral():scanPunctuator():isDecimalDigit(cp)?scanNumericLiteral():extra.tokenize&&47===cp?advanceSlash():96===cp||125===cp&&"${"===state.curlyStack[state.curlyStack.length-1]?scanTemplate():cp>=55296&&cp<57343&&(cp=codePointAt(index),isIdentifierStart(cp))?scanIdentifier():scanPunctuator())}function collectToken(){var loc,token,value,entry;return loc={start:{line:lineNumber,column:index-lineStart}},token=advance(),loc.end={line:lineNumber,column:index-lineStart},token.type!==Token.EOF&&(value=source.slice(token.start,token.end),entry={type:TokenName[token.type],value:value,range:[token.start,token.end],loc:loc},token.regex&&(entry.regex={pattern:token.regex.pattern,flags:token.regex.flags}),extra.tokenValues&&extra.tokenValues.push("Punctuator"===entry.type||"Keyword"===entry.type?entry.value:null),extra.tokenize&&(extra.range||delete entry.range,extra.loc||delete entry.loc,extra.delegate&&(entry=extra.delegate(entry))),extra.tokens.push(entry)),token}function lex(){var token;return scanning=!0,lastIndex=index,lastLineNumber=lineNumber,lastLineStart=lineStart,skipComment(),token=lookahead,startIndex=index,startLineNumber=lineNumber,startLineStart=lineStart,lookahead=void 0!==extra.tokens?collectToken():advance(),scanning=!1,token}function peek(){scanning=!0,skipComment(),lastIndex=index,lastLineNumber=lineNumber,lastLineStart=lineStart,startIndex=index,startLineNumber=lineNumber,startLineStart=lineStart,lookahead=void 0!==extra.tokens?collectToken():advance(),scanning=!1}function Position(){this.line=startLineNumber,this.column=startIndex-startLineStart}function SourceLocation(){this.start=new Position,this.end=null}function WrappingSourceLocation(startToken){this.start={line:startToken.lineNumber,column:startToken.start-startToken.lineStart},this.end=null}function Node(){extra.range&&(this.range=[startIndex,0]),extra.loc&&(this.loc=new SourceLocation)}function WrappingNode(startToken){extra.range&&(this.range=[startToken.start,0]),extra.loc&&(this.loc=new WrappingSourceLocation(startToken))}function recordError(error){var e,existing;for(e=0;e<extra.errors.length;e++)if(existing=extra.errors[e],existing.index===error.index&&existing.message===error.message)return;extra.errors.push(error)}function constructError(msg,column){var error=new Error(msg);try{throw error}catch(base){Object.create&&Object.defineProperty&&(error=Object.create(base),Object.defineProperty(error,"column",{value:column}))}finally{return error}}function createError(line,pos,description){var msg,column,error;return msg="Line "+line+": "+description,column=pos-(scanning?lineStart:lastLineStart)+1,error=constructError(msg,column),error.lineNumber=line,error.description=description,error.index=pos,error}function throwError(messageFormat){var args,msg;throw args=Array.prototype.slice.call(arguments,1),msg=messageFormat.replace(/%(\d)/g,function(whole,idx){return assert(idx<args.length,"Message reference must be in range"),args[idx]}),createError(lastLineNumber,lastIndex,msg)}function tolerateError(messageFormat){var args,msg,error;if(args=Array.prototype.slice.call(arguments,1),msg=messageFormat.replace(/%(\d)/g,function(whole,idx){return assert(idx<args.length,"Message reference must be in range"),args[idx]}),error=createError(lineNumber,lastIndex,msg),!extra.errors)throw error;recordError(error)}function unexpectedTokenError(token,message){var value,msg=message||Messages.UnexpectedToken;return token?(message||(msg=token.type===Token.EOF?Messages.UnexpectedEOS:token.type===Token.Identifier?Messages.UnexpectedIdentifier:token.type===Token.NumericLiteral?Messages.UnexpectedNumber:token.type===Token.StringLiteral?Messages.UnexpectedString:token.type===Token.Template?Messages.UnexpectedTemplate:Messages.UnexpectedToken,token.type===Token.Keyword&&(isFutureReservedWord(token.value)?msg=Messages.UnexpectedReserved:strict&&isStrictModeReservedWord(token.value)&&(msg=Messages.StrictReservedWord))),value=token.type===Token.Template?token.value.raw:token.value):value="ILLEGAL",msg=msg.replace("%0",value),token&&"number"==typeof token.lineNumber?createError(token.lineNumber,token.start,msg):createError(scanning?lineNumber:lastLineNumber,scanning?index:lastIndex,msg)}function throwUnexpectedToken(token,message){throw unexpectedTokenError(token,message)}function tolerateUnexpectedToken(token,message){var error=unexpectedTokenError(token,message);if(!extra.errors)throw error;recordError(error)}function expect(value){var token=lex();token.type===Token.Punctuator&&token.value===value||throwUnexpectedToken(token)}function expectCommaSeparator(){var token;extra.errors?(token=lookahead,token.type===Token.Punctuator&&","===token.value?lex():token.type===Token.Punctuator&&";"===token.value?(lex(),tolerateUnexpectedToken(token)):tolerateUnexpectedToken(token,Messages.UnexpectedToken)):expect(",")}function expectKeyword(keyword){var token=lex();token.type===Token.Keyword&&token.value===keyword||throwUnexpectedToken(token)}function match(value){return lookahead.type===Token.Punctuator&&lookahead.value===value}function matchKeyword(keyword){return lookahead.type===Token.Keyword&&lookahead.value===keyword}function matchContextualKeyword(keyword){return lookahead.type===Token.Identifier&&lookahead.value===keyword}function matchAssign(){var op;return lookahead.type===Token.Punctuator&&("="===(op=lookahead.value)||"*="===op||"/="===op||"%="===op||"+="===op||"-="===op||"<<="===op||">>="===op||">>>="===op||"&="===op||"^="===op||"|="===op)}function consumeSemicolon(){if(59===source.charCodeAt(startIndex)||match(";"))return void lex();hasLineTerminator||(lastIndex=startIndex,lastLineNumber=startLineNumber,lastLineStart=startLineStart,lookahead.type===Token.EOF||match("}")||throwUnexpectedToken(lookahead))}function isolateCoverGrammar(parser){var result,oldIsBindingElement=isBindingElement,oldIsAssignmentTarget=isAssignmentTarget,oldFirstCoverInitializedNameError=firstCoverInitializedNameError;return isBindingElement=!0,isAssignmentTarget=!0,firstCoverInitializedNameError=null,result=parser(),null!==firstCoverInitializedNameError&&throwUnexpectedToken(firstCoverInitializedNameError),isBindingElement=oldIsBindingElement,isAssignmentTarget=oldIsAssignmentTarget,firstCoverInitializedNameError=oldFirstCoverInitializedNameError,result}function inheritCoverGrammar(parser){var result,oldIsBindingElement=isBindingElement,oldIsAssignmentTarget=isAssignmentTarget,oldFirstCoverInitializedNameError=firstCoverInitializedNameError;return isBindingElement=!0,isAssignmentTarget=!0,firstCoverInitializedNameError=null,result=parser(),isBindingElement=isBindingElement&&oldIsBindingElement,isAssignmentTarget=isAssignmentTarget&&oldIsAssignmentTarget,firstCoverInitializedNameError=oldFirstCoverInitializedNameError||firstCoverInitializedNameError,result}function parseArrayPattern(params,kind){var rest,restNode,node=new Node,elements=[];for(expect("[");!match("]");)if(match(","))lex(),elements.push(null);else{if(match("...")){restNode=new Node,lex(),params.push(lookahead),rest=parseVariableIdentifier(kind),elements.push(restNode.finishRestElement(rest));break}elements.push(parsePatternWithDefault(params,kind)),match("]")||expect(",")}return expect("]"),node.finishArrayPattern(elements)}function parsePropertyPattern(params,kind){var key,keyToken,init,node=new Node,computed=match("[");if(lookahead.type===Token.Identifier){if(keyToken=lookahead,key=parseVariableIdentifier(),match("="))return params.push(keyToken),lex(),init=parseAssignmentExpression(),node.finishProperty("init",key,!1,new WrappingNode(keyToken).finishAssignmentPattern(key,init),!1,!0);if(!match(":"))return params.push(keyToken),node.finishProperty("init",key,!1,key,!1,!0)}else key=parseObjectPropertyKey();return expect(":"),init=parsePatternWithDefault(params,kind),node.finishProperty("init",key,computed,init,!1,!1)}function parseObjectPattern(params,kind){var node=new Node,properties=[];for(expect("{");!match("}");)properties.push(parsePropertyPattern(params,kind)),match("}")||expect(",");return lex(),node.finishObjectPattern(properties)}function parsePattern(params,kind){return match("[")?parseArrayPattern(params,kind):match("{")?parseObjectPattern(params,kind):(matchKeyword("let")&&("const"!==kind&&"let"!==kind||tolerateUnexpectedToken(lookahead,Messages.UnexpectedToken)),params.push(lookahead),parseVariableIdentifier(kind))}function parsePatternWithDefault(params,kind){var pattern,previousAllowYield,right,startToken=lookahead;return pattern=parsePattern(params,kind),match("=")&&(lex(),previousAllowYield=state.allowYield,state.allowYield=!0,right=isolateCoverGrammar(parseAssignmentExpression),state.allowYield=previousAllowYield,pattern=new WrappingNode(startToken).finishAssignmentPattern(pattern,right)),pattern}function parseArrayInitializer(){var restSpread,elements=[],node=new Node;for(expect("[");!match("]");)match(",")?(lex(),elements.push(null)):match("...")?(restSpread=new Node,lex(),restSpread.finishSpreadElement(inheritCoverGrammar(parseAssignmentExpression)),match("]")||(isAssignmentTarget=isBindingElement=!1,expect(",")),
elements.push(restSpread)):(elements.push(inheritCoverGrammar(parseAssignmentExpression)),match("]")||expect(","));return lex(),node.finishArrayExpression(elements)}function parsePropertyFunction(node,paramInfo,isGenerator){var previousStrict,body;return isAssignmentTarget=isBindingElement=!1,previousStrict=strict,body=isolateCoverGrammar(parseFunctionSourceElements),strict&&paramInfo.firstRestricted&&tolerateUnexpectedToken(paramInfo.firstRestricted,paramInfo.message),strict&&paramInfo.stricted&&tolerateUnexpectedToken(paramInfo.stricted,paramInfo.message),strict=previousStrict,node.finishFunctionExpression(null,paramInfo.params,paramInfo.defaults,body,isGenerator)}function parsePropertyMethodFunction(){var params,method,node=new Node,previousAllowYield=state.allowYield;return state.allowYield=!1,params=parseParams(),state.allowYield=previousAllowYield,state.allowYield=!1,method=parsePropertyFunction(node,params,!1),state.allowYield=previousAllowYield,method}function parseObjectPropertyKey(){var token,expr,node=new Node;switch(token=lex(),token.type){case Token.StringLiteral:case Token.NumericLiteral:return strict&&token.octal&&tolerateUnexpectedToken(token,Messages.StrictOctalLiteral),node.finishLiteral(token);case Token.Identifier:case Token.BooleanLiteral:case Token.NullLiteral:case Token.Keyword:return node.finishIdentifier(token.value);case Token.Punctuator:if("["===token.value)return expr=isolateCoverGrammar(parseAssignmentExpression),expect("]"),expr}throwUnexpectedToken(token)}function lookaheadPropertyName(){switch(lookahead.type){case Token.Identifier:case Token.StringLiteral:case Token.BooleanLiteral:case Token.NullLiteral:case Token.NumericLiteral:case Token.Keyword:return!0;case Token.Punctuator:return"["===lookahead.value}return!1}function tryParseMethodDefinition(token,key,computed,node){var value,options,methodNode,params,previousAllowYield=state.allowYield;if(token.type===Token.Identifier){if("get"===token.value&&lookaheadPropertyName())return computed=match("["),key=parseObjectPropertyKey(),methodNode=new Node,expect("("),expect(")"),state.allowYield=!1,value=parsePropertyFunction(methodNode,{params:[],defaults:[],stricted:null,firstRestricted:null,message:null},!1),state.allowYield=previousAllowYield,node.finishProperty("get",key,computed,value,!1,!1);if("set"===token.value&&lookaheadPropertyName())return computed=match("["),key=parseObjectPropertyKey(),methodNode=new Node,expect("("),options={params:[],defaultCount:0,defaults:[],firstRestricted:null,paramSet:{}},match(")")?tolerateUnexpectedToken(lookahead):(state.allowYield=!1,parseParam(options),state.allowYield=previousAllowYield,0===options.defaultCount&&(options.defaults=[])),expect(")"),state.allowYield=!1,value=parsePropertyFunction(methodNode,options,!1),state.allowYield=previousAllowYield,node.finishProperty("set",key,computed,value,!1,!1)}else if(token.type===Token.Punctuator&&"*"===token.value&&lookaheadPropertyName())return computed=match("["),key=parseObjectPropertyKey(),methodNode=new Node,state.allowYield=!0,params=parseParams(),state.allowYield=previousAllowYield,state.allowYield=!1,value=parsePropertyFunction(methodNode,params,!0),state.allowYield=previousAllowYield,node.finishProperty("init",key,computed,value,!0,!1);return key&&match("(")?(value=parsePropertyMethodFunction(),node.finishProperty("init",key,computed,value,!0,!1)):null}function parseObjectProperty(hasProto){var computed,key,maybeMethod,proto,value,token=lookahead,node=new Node;return computed=match("["),match("*")?lex():key=parseObjectPropertyKey(),(maybeMethod=tryParseMethodDefinition(token,key,computed,node))?maybeMethod:(key||throwUnexpectedToken(lookahead),computed||(proto=key.type===Syntax.Identifier&&"__proto__"===key.name||key.type===Syntax.Literal&&"__proto__"===key.value,hasProto.value&&proto&&tolerateError(Messages.DuplicateProtoProperty),hasProto.value|=proto),match(":")?(lex(),value=inheritCoverGrammar(parseAssignmentExpression),node.finishProperty("init",key,computed,value,!1,!1)):token.type===Token.Identifier?match("=")?(firstCoverInitializedNameError=lookahead,lex(),value=isolateCoverGrammar(parseAssignmentExpression),node.finishProperty("init",key,computed,new WrappingNode(token).finishAssignmentPattern(key,value),!1,!0)):node.finishProperty("init",key,computed,key,!1,!0):void throwUnexpectedToken(lookahead))}function parseObjectInitializer(){var properties=[],hasProto={value:!1},node=new Node;for(expect("{");!match("}");)properties.push(parseObjectProperty(hasProto)),match("}")||expectCommaSeparator();return expect("}"),node.finishObjectExpression(properties)}function reinterpretExpressionAsPattern(expr){var i;switch(expr.type){case Syntax.Identifier:case Syntax.MemberExpression:case Syntax.RestElement:case Syntax.AssignmentPattern:break;case Syntax.SpreadElement:expr.type=Syntax.RestElement,reinterpretExpressionAsPattern(expr.argument);break;case Syntax.ArrayExpression:for(expr.type=Syntax.ArrayPattern,i=0;i<expr.elements.length;i++)null!==expr.elements[i]&&reinterpretExpressionAsPattern(expr.elements[i]);break;case Syntax.ObjectExpression:for(expr.type=Syntax.ObjectPattern,i=0;i<expr.properties.length;i++)reinterpretExpressionAsPattern(expr.properties[i].value);break;case Syntax.AssignmentExpression:expr.type=Syntax.AssignmentPattern,reinterpretExpressionAsPattern(expr.left)}}function parseTemplateElement(option){var node,token;return(lookahead.type!==Token.Template||option.head&&!lookahead.head)&&throwUnexpectedToken(),node=new Node,token=lex(),node.finishTemplateElement({raw:token.value.raw,cooked:token.value.cooked},token.tail)}function parseTemplateLiteral(){var quasi,quasis,expressions,node=new Node;for(quasi=parseTemplateElement({head:!0}),quasis=[quasi],expressions=[];!quasi.tail;)expressions.push(parseExpression()),quasi=parseTemplateElement({head:!1}),quasis.push(quasi);return node.finishTemplateLiteral(quasis,expressions)}function parseGroupExpression(){var expr,expressions,startToken,i,params=[];if(expect("("),match(")"))return lex(),match("=>")||expect("=>"),{type:PlaceHolders.ArrowParameterPlaceHolder,params:[],rawParams:[]};if(startToken=lookahead,match("..."))return expr=parseRestElement(params),expect(")"),match("=>")||expect("=>"),{type:PlaceHolders.ArrowParameterPlaceHolder,params:[expr]};if(isBindingElement=!0,expr=inheritCoverGrammar(parseAssignmentExpression),match(",")){for(isAssignmentTarget=!1,expressions=[expr];startIndex<length&&match(",");){if(lex(),match("...")){for(isBindingElement||throwUnexpectedToken(lookahead),expressions.push(parseRestElement(params)),expect(")"),match("=>")||expect("=>"),isBindingElement=!1,i=0;i<expressions.length;i++)reinterpretExpressionAsPattern(expressions[i]);return{type:PlaceHolders.ArrowParameterPlaceHolder,params:expressions}}expressions.push(inheritCoverGrammar(parseAssignmentExpression))}expr=new WrappingNode(startToken).finishSequenceExpression(expressions)}if(expect(")"),match("=>")){if(expr.type===Syntax.Identifier&&"yield"===expr.name)return{type:PlaceHolders.ArrowParameterPlaceHolder,params:[expr]};if(isBindingElement||throwUnexpectedToken(lookahead),expr.type===Syntax.SequenceExpression)for(i=0;i<expr.expressions.length;i++)reinterpretExpressionAsPattern(expr.expressions[i]);else reinterpretExpressionAsPattern(expr);expr={type:PlaceHolders.ArrowParameterPlaceHolder,params:expr.type===Syntax.SequenceExpression?expr.expressions:[expr]}}return isBindingElement=!1,expr}function parsePrimaryExpression(){var type,token,expr,node;if(match("("))return isBindingElement=!1,inheritCoverGrammar(parseGroupExpression);if(match("["))return inheritCoverGrammar(parseArrayInitializer);if(match("{"))return inheritCoverGrammar(parseObjectInitializer);if(type=lookahead.type,node=new Node,type===Token.Identifier)"module"===state.sourceType&&"await"===lookahead.value&&tolerateUnexpectedToken(lookahead),expr=node.finishIdentifier(lex().value);else if(type===Token.StringLiteral||type===Token.NumericLiteral)isAssignmentTarget=isBindingElement=!1,strict&&lookahead.octal&&tolerateUnexpectedToken(lookahead,Messages.StrictOctalLiteral),expr=node.finishLiteral(lex());else if(type===Token.Keyword){if(!strict&&state.allowYield&&matchKeyword("yield"))return parseNonComputedProperty();if(!strict&&matchKeyword("let"))return node.finishIdentifier(lex().value);if(isAssignmentTarget=isBindingElement=!1,matchKeyword("function"))return parseFunctionExpression();if(matchKeyword("this"))return lex(),node.finishThisExpression();if(matchKeyword("class"))return parseClassExpression();throwUnexpectedToken(lex())}else type===Token.BooleanLiteral?(isAssignmentTarget=isBindingElement=!1,token=lex(),token.value="true"===token.value,expr=node.finishLiteral(token)):type===Token.NullLiteral?(isAssignmentTarget=isBindingElement=!1,token=lex(),token.value=null,expr=node.finishLiteral(token)):match("/")||match("/=")?(isAssignmentTarget=isBindingElement=!1,index=startIndex,token=void 0!==extra.tokens?collectRegex():scanRegExp(),lex(),expr=node.finishLiteral(token)):type===Token.Template?expr=parseTemplateLiteral():throwUnexpectedToken(lex());return expr}function parseArguments(){var expr,args=[];if(expect("("),!match(")"))for(;startIndex<length&&(match("...")?(expr=new Node,lex(),expr.finishSpreadElement(isolateCoverGrammar(parseAssignmentExpression))):expr=isolateCoverGrammar(parseAssignmentExpression),args.push(expr),!match(")"));)expectCommaSeparator();return expect(")"),args}function parseNonComputedProperty(){var token,node=new Node;return token=lex(),isIdentifierName(token)||throwUnexpectedToken(token),node.finishIdentifier(token.value)}function parseNonComputedMember(){return expect("."),parseNonComputedProperty()}function parseComputedMember(){var expr;return expect("["),expr=isolateCoverGrammar(parseExpression),expect("]"),expr}function parseNewExpression(){var callee,args,node=new Node;if(expectKeyword("new"),match(".")){if(lex(),lookahead.type===Token.Identifier&&"target"===lookahead.value&&state.inFunctionBody)return lex(),node.finishMetaProperty("new","target");throwUnexpectedToken(lookahead)}return callee=isolateCoverGrammar(parseLeftHandSideExpression),args=match("(")?parseArguments():[],isAssignmentTarget=isBindingElement=!1,node.finishNewExpression(callee,args)}function parseLeftHandSideExpressionAllowCall(){var quasi,expr,args,property,startToken,previousAllowIn=state.allowIn;for(startToken=lookahead,state.allowIn=!0,matchKeyword("super")&&state.inFunctionBody?(expr=new Node,lex(),expr=expr.finishSuper(),match("(")||match(".")||match("[")||throwUnexpectedToken(lookahead)):expr=inheritCoverGrammar(matchKeyword("new")?parseNewExpression:parsePrimaryExpression);;)if(match("."))isBindingElement=!1,isAssignmentTarget=!0,property=parseNonComputedMember(),expr=new WrappingNode(startToken).finishMemberExpression(".",expr,property);else if(match("("))isBindingElement=!1,isAssignmentTarget=!1,args=parseArguments(),expr=new WrappingNode(startToken).finishCallExpression(expr,args);else if(match("["))isBindingElement=!1,isAssignmentTarget=!0,property=parseComputedMember(),expr=new WrappingNode(startToken).finishMemberExpression("[",expr,property);else{if(lookahead.type!==Token.Template||!lookahead.head)break;quasi=parseTemplateLiteral(),expr=new WrappingNode(startToken).finishTaggedTemplateExpression(expr,quasi)}return state.allowIn=previousAllowIn,expr}function parseLeftHandSideExpression(){var quasi,expr,property,startToken;for(assert(state.allowIn,"callee of new expression always allow in keyword."),startToken=lookahead,matchKeyword("super")&&state.inFunctionBody?(expr=new Node,lex(),expr=expr.finishSuper(),match("[")||match(".")||throwUnexpectedToken(lookahead)):expr=inheritCoverGrammar(matchKeyword("new")?parseNewExpression:parsePrimaryExpression);;)if(match("["))isBindingElement=!1,isAssignmentTarget=!0,property=parseComputedMember(),expr=new WrappingNode(startToken).finishMemberExpression("[",expr,property);else if(match("."))isBindingElement=!1,isAssignmentTarget=!0,property=parseNonComputedMember(),expr=new WrappingNode(startToken).finishMemberExpression(".",expr,property);else{if(lookahead.type!==Token.Template||!lookahead.head)break;quasi=parseTemplateLiteral(),expr=new WrappingNode(startToken).finishTaggedTemplateExpression(expr,quasi)}return expr}function parsePostfixExpression(){var expr,token,startToken=lookahead;return expr=inheritCoverGrammar(parseLeftHandSideExpressionAllowCall),hasLineTerminator||lookahead.type!==Token.Punctuator||(match("++")||match("--"))&&(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)&&tolerateError(Messages.StrictLHSPostfix),isAssignmentTarget||tolerateError(Messages.InvalidLHSInAssignment),isAssignmentTarget=isBindingElement=!1,token=lex(),expr=new WrappingNode(startToken).finishPostfixExpression(token.value,expr)),expr}function parseUnaryExpression(){var token,expr,startToken;return lookahead.type!==Token.Punctuator&&lookahead.type!==Token.Keyword?expr=parsePostfixExpression():match("++")||match("--")?(startToken=lookahead,token=lex(),expr=inheritCoverGrammar(parseUnaryExpression),strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)&&tolerateError(Messages.StrictLHSPrefix),isAssignmentTarget||tolerateError(Messages.InvalidLHSInAssignment),expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr),isAssignmentTarget=isBindingElement=!1):match("+")||match("-")||match("~")||match("!")?(startToken=lookahead,token=lex(),expr=inheritCoverGrammar(parseUnaryExpression),expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr),isAssignmentTarget=isBindingElement=!1):matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")?(startToken=lookahead,token=lex(),expr=inheritCoverGrammar(parseUnaryExpression),expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr),strict&&"delete"===expr.operator&&expr.argument.type===Syntax.Identifier&&tolerateError(Messages.StrictDelete),isAssignmentTarget=isBindingElement=!1):expr=parsePostfixExpression(),expr}function binaryPrecedence(token,allowIn){var prec=0;if(token.type!==Token.Punctuator&&token.type!==Token.Keyword)return 0;switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":prec=7;break;case"in":prec=allowIn?7:0;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11}return prec}function parseBinaryExpression(){var marker,markers,expr,token,prec,stack,right,operator,left,i;if(marker=lookahead,left=inheritCoverGrammar(parseUnaryExpression),token=lookahead,0===(prec=binaryPrecedence(token,state.allowIn)))return left;for(isAssignmentTarget=isBindingElement=!1,token.prec=prec,lex(),markers=[marker,lookahead],right=isolateCoverGrammar(parseUnaryExpression),stack=[left,token,right];(prec=binaryPrecedence(lookahead,state.allowIn))>0;){for(;stack.length>2&&prec<=stack[stack.length-2].prec;)right=stack.pop(),operator=stack.pop().value,left=stack.pop(),markers.pop(),expr=new WrappingNode(markers[markers.length-1]).finishBinaryExpression(operator,left,right),stack.push(expr);token=lex(),token.prec=prec,stack.push(token),markers.push(lookahead),expr=isolateCoverGrammar(parseUnaryExpression),stack.push(expr)}for(i=stack.length-1,expr=stack[i],markers.pop();i>1;)expr=new WrappingNode(markers.pop()).finishBinaryExpression(stack[i-1].value,stack[i-2],expr),i-=2;return expr}function parseConditionalExpression(){var expr,previousAllowIn,consequent,alternate,startToken;return startToken=lookahead,expr=inheritCoverGrammar(parseBinaryExpression),match("?")&&(lex(),previousAllowIn=state.allowIn,state.allowIn=!0,consequent=isolateCoverGrammar(parseAssignmentExpression),state.allowIn=previousAllowIn,expect(":"),alternate=isolateCoverGrammar(parseAssignmentExpression),expr=new WrappingNode(startToken).finishConditionalExpression(expr,consequent,alternate),isAssignmentTarget=isBindingElement=!1),expr}function parseConciseBody(){return match("{")?parseFunctionSourceElements():isolateCoverGrammar(parseAssignmentExpression)}function checkPatternParam(options,param){var i;switch(param.type){case Syntax.Identifier:validateParam(options,param,param.name);break;case Syntax.RestElement:checkPatternParam(options,param.argument);break;case Syntax.AssignmentPattern:checkPatternParam(options,param.left);break;case Syntax.ArrayPattern:for(i=0;i<param.elements.length;i++)null!==param.elements[i]&&checkPatternParam(options,param.elements[i]);break;case Syntax.YieldExpression:break;default:for(assert(param.type===Syntax.ObjectPattern,"Invalid type"),i=0;i<param.properties.length;i++)checkPatternParam(options,param.properties[i].value)}}function reinterpretAsCoverFormalsList(expr){var i,len,param,params,defaults,defaultCount,options,token;switch(defaults=[],defaultCount=0,params=[expr],expr.type){case Syntax.Identifier:break;case PlaceHolders.ArrowParameterPlaceHolder:params=expr.params;break;default:return null}for(options={paramSet:{}},i=0,len=params.length;i<len;i+=1)switch(param=params[i],param.type){case Syntax.AssignmentPattern:params[i]=param.left,param.right.type===Syntax.YieldExpression&&(param.right.argument&&throwUnexpectedToken(lookahead),param.right.type=Syntax.Identifier,param.right.name="yield",delete param.right.argument,delete param.right.delegate),defaults.push(param.right),++defaultCount,checkPatternParam(options,param.left);break;default:checkPatternParam(options,param),params[i]=param,defaults.push(null)}if(strict||!state.allowYield)for(i=0,len=params.length;i<len;i+=1)param=params[i],param.type===Syntax.YieldExpression&&throwUnexpectedToken(lookahead);return options.message===Messages.StrictParamDupe&&(token=strict?options.stricted:options.firstRestricted,throwUnexpectedToken(token,options.message)),0===defaultCount&&(defaults=[]),{params:params,defaults:defaults,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}}function parseArrowFunctionExpression(options,node){var previousStrict,previousAllowYield,body;return hasLineTerminator&&tolerateUnexpectedToken(lookahead),expect("=>"),previousStrict=strict,previousAllowYield=state.allowYield,state.allowYield=!0,body=parseConciseBody(),strict&&options.firstRestricted&&throwUnexpectedToken(options.firstRestricted,options.message),strict&&options.stricted&&tolerateUnexpectedToken(options.stricted,options.message),strict=previousStrict,state.allowYield=previousAllowYield,node.finishArrowFunctionExpression(options.params,options.defaults,body,body.type!==Syntax.BlockStatement)}function parseYieldExpression(){var argument,expr,delegate,previousAllowYield;return argument=null,expr=new Node,delegate=!1,expectKeyword("yield"),hasLineTerminator||(previousAllowYield=state.allowYield,state.allowYield=!1,delegate=match("*"),delegate?(lex(),argument=parseAssignmentExpression()):match(";")||match("}")||match(")")||lookahead.type===Token.EOF||(argument=parseAssignmentExpression()),state.allowYield=previousAllowYield),expr.finishYieldExpression(argument,delegate)}function parseAssignmentExpression(){var token,expr,right,list,startToken;return startToken=lookahead,token=lookahead,!state.allowYield&&matchKeyword("yield")?parseYieldExpression():(expr=parseConditionalExpression(),expr.type===PlaceHolders.ArrowParameterPlaceHolder||match("=>")?(isAssignmentTarget=isBindingElement=!1,list=reinterpretAsCoverFormalsList(expr),list?(firstCoverInitializedNameError=null,parseArrowFunctionExpression(list,new WrappingNode(startToken))):expr):(matchAssign()&&(isAssignmentTarget||tolerateError(Messages.InvalidLHSInAssignment),strict&&expr.type===Syntax.Identifier&&(isRestrictedWord(expr.name)&&tolerateUnexpectedToken(token,Messages.StrictLHSAssignment),isStrictModeReservedWord(expr.name)&&tolerateUnexpectedToken(token,Messages.StrictReservedWord)),match("=")?reinterpretExpressionAsPattern(expr):isAssignmentTarget=isBindingElement=!1,token=lex(),right=isolateCoverGrammar(parseAssignmentExpression),expr=new WrappingNode(startToken).finishAssignmentExpression(token.value,expr,right),firstCoverInitializedNameError=null),expr))}function parseExpression(){var expr,expressions,startToken=lookahead;if(expr=isolateCoverGrammar(parseAssignmentExpression),match(",")){for(expressions=[expr];startIndex<length&&match(",");)lex(),expressions.push(isolateCoverGrammar(parseAssignmentExpression));expr=new WrappingNode(startToken).finishSequenceExpression(expressions)}return expr}function parseStatementListItem(){if(lookahead.type===Token.Keyword)switch(lookahead.value){case"export":return"module"!==state.sourceType&&tolerateUnexpectedToken(lookahead,Messages.IllegalExportDeclaration),parseExportDeclaration();case"import":return"module"!==state.sourceType&&tolerateUnexpectedToken(lookahead,Messages.IllegalImportDeclaration),parseImportDeclaration();case"const":return parseLexicalDeclaration({inFor:!1});case"function":return parseFunctionDeclaration(new Node);case"class":return parseClassDeclaration()}return matchKeyword("let")&&isLexicalDeclaration()?parseLexicalDeclaration({inFor:!1}):parseStatement()}function parseStatementList(){for(var list=[];startIndex<length&&!match("}");)list.push(parseStatementListItem());return list}function parseBlock(){var block,node=new Node;return expect("{"),block=parseStatementList(),expect("}"),node.finishBlockStatement(block)}function parseVariableIdentifier(kind){var token,node=new Node;return token=lex(),token.type===Token.Keyword&&"yield"===token.value?(strict&&tolerateUnexpectedToken(token,Messages.StrictReservedWord),state.allowYield||throwUnexpectedToken(token)):token.type!==Token.Identifier?strict&&token.type===Token.Keyword&&isStrictModeReservedWord(token.value)?tolerateUnexpectedToken(token,Messages.StrictReservedWord):(strict||"let"!==token.value||"var"!==kind)&&throwUnexpectedToken(token):"module"===state.sourceType&&token.type===Token.Identifier&&"await"===token.value&&tolerateUnexpectedToken(token),node.finishIdentifier(token.value)}function parseVariableDeclaration(options){var id,init=null,node=new Node;return id=parsePattern([],"var"),strict&&isRestrictedWord(id.name)&&tolerateError(Messages.StrictVarName),match("=")?(lex(),init=isolateCoverGrammar(parseAssignmentExpression)):id.type===Syntax.Identifier||options.inFor||expect("="),node.finishVariableDeclarator(id,init)}function parseVariableDeclarationList(options){var opt,list;for(opt={inFor:options.inFor},list=[parseVariableDeclaration(opt)];match(",");)lex(),list.push(parseVariableDeclaration(opt));return list}function parseVariableStatement(node){var declarations;return expectKeyword("var"),declarations=parseVariableDeclarationList({inFor:!1}),consumeSemicolon(),node.finishVariableDeclaration(declarations)}function parseLexicalBinding(kind,options){var id,init=null,node=new Node;return id=parsePattern([],kind),strict&&id.type===Syntax.Identifier&&isRestrictedWord(id.name)&&tolerateError(Messages.StrictVarName),"const"===kind?matchKeyword("in")||matchContextualKeyword("of")||(expect("="),init=isolateCoverGrammar(parseAssignmentExpression)):(!options.inFor&&id.type!==Syntax.Identifier||match("="))&&(expect("="),init=isolateCoverGrammar(parseAssignmentExpression)),node.finishVariableDeclarator(id,init)}function parseBindingList(kind,options){for(var list=[parseLexicalBinding(kind,options)];match(",");)lex(),list.push(parseLexicalBinding(kind,options));return list}function tokenizerState(){return{index:index,lineNumber:lineNumber,lineStart:lineStart,hasLineTerminator:hasLineTerminator,lastIndex:lastIndex,lastLineNumber:lastLineNumber,lastLineStart:lastLineStart,startIndex:startIndex,startLineNumber:startLineNumber,startLineStart:startLineStart,lookahead:lookahead,tokenCount:extra.tokens?extra.tokens.length:0}}function resetTokenizerState(ts){index=ts.index,lineNumber=ts.lineNumber,lineStart=ts.lineStart,hasLineTerminator=ts.hasLineTerminator,lastIndex=ts.lastIndex,lastLineNumber=ts.lastLineNumber,lastLineStart=ts.lastLineStart,startIndex=ts.startIndex,startLineNumber=ts.startLineNumber,startLineStart=ts.startLineStart,lookahead=ts.lookahead,extra.tokens&&extra.tokens.splice(ts.tokenCount,extra.tokens.length)}function isLexicalDeclaration(){var lexical,ts;return ts=tokenizerState(),lex(),lexical=lookahead.type===Token.Identifier||match("[")||match("{")||matchKeyword("let")||matchKeyword("yield"),resetTokenizerState(ts),lexical}function parseLexicalDeclaration(options){var kind,declarations,node=new Node;return kind=lex().value,assert("let"===kind||"const"===kind,"Lexical declaration must be either let or const"),declarations=parseBindingList(kind,options),consumeSemicolon(),node.finishLexicalDeclaration(declarations,kind)}function parseRestElement(params){var param,node=new Node;return lex(),match("{")&&throwError(Messages.ObjectPatternAsRestParameter),params.push(lookahead),param=parseVariableIdentifier(),match("=")&&throwError(Messages.DefaultRestParameter),match(")")||throwError(Messages.ParameterAfterRestParameter),node.finishRestElement(param)}function parseEmptyStatement(node){return expect(";"),node.finishEmptyStatement()}function parseExpressionStatement(node){var expr=parseExpression();return consumeSemicolon(),node.finishExpressionStatement(expr)}function parseIfStatement(node){var test,consequent,alternate;return expectKeyword("if"),expect("("),test=parseExpression(),expect(")"),consequent=parseStatement(),matchKeyword("else")?(lex(),alternate=parseStatement()):alternate=null,node.finishIfStatement(test,consequent,alternate)}function parseDoWhileStatement(node){var body,test,oldInIteration;return expectKeyword("do"),oldInIteration=state.inIteration,state.inIteration=!0,body=parseStatement(),state.inIteration=oldInIteration,expectKeyword("while"),expect("("),test=parseExpression(),expect(")"),match(";")&&lex(),node.finishDoWhileStatement(body,test)}function parseWhileStatement(node){var test,body,oldInIteration;return expectKeyword("while"),expect("("),test=parseExpression(),expect(")"),oldInIteration=state.inIteration,state.inIteration=!0,body=parseStatement(),state.inIteration=oldInIteration,node.finishWhileStatement(test,body)}function parseForStatement(node){var init,forIn,initSeq,initStartToken,test,update,left,right,kind,declarations,body,oldInIteration,previousAllowIn=state.allowIn;if(init=test=update=null,forIn=!0,expectKeyword("for"),expect("("),match(";"))lex();else if(matchKeyword("var"))init=new Node,lex(),state.allowIn=!1,declarations=parseVariableDeclarationList({inFor:!0}),state.allowIn=previousAllowIn,1===declarations.length&&matchKeyword("in")?(init=init.finishVariableDeclaration(declarations),lex(),left=init,right=parseExpression(),init=null):1===declarations.length&&null===declarations[0].init&&matchContextualKeyword("of")?(init=init.finishVariableDeclaration(declarations),lex(),left=init,right=parseAssignmentExpression(),init=null,forIn=!1):(init=init.finishVariableDeclaration(declarations),expect(";"));else if(matchKeyword("const")||matchKeyword("let"))init=new Node,kind=lex().value,strict||"in"!==lookahead.value?(state.allowIn=!1,declarations=parseBindingList(kind,{inFor:!0}),state.allowIn=previousAllowIn,1===declarations.length&&null===declarations[0].init&&matchKeyword("in")?(init=init.finishLexicalDeclaration(declarations,kind),lex(),left=init,right=parseExpression(),init=null):1===declarations.length&&null===declarations[0].init&&matchContextualKeyword("of")?(init=init.finishLexicalDeclaration(declarations,kind),lex(),left=init,right=parseAssignmentExpression(),init=null,forIn=!1):(consumeSemicolon(),init=init.finishLexicalDeclaration(declarations,kind))):(init=init.finishIdentifier(kind),lex(),left=init,right=parseExpression(),init=null);else if(initStartToken=lookahead,state.allowIn=!1,init=inheritCoverGrammar(parseAssignmentExpression),state.allowIn=previousAllowIn,matchKeyword("in"))isAssignmentTarget||tolerateError(Messages.InvalidLHSInForIn),lex(),reinterpretExpressionAsPattern(init),left=init,right=parseExpression(),init=null;else if(matchContextualKeyword("of"))isAssignmentTarget||tolerateError(Messages.InvalidLHSInForLoop),lex(),reinterpretExpressionAsPattern(init),left=init,right=parseAssignmentExpression(),init=null,forIn=!1;else{if(match(",")){for(initSeq=[init];match(",");)lex(),initSeq.push(isolateCoverGrammar(parseAssignmentExpression));init=new WrappingNode(initStartToken).finishSequenceExpression(initSeq)}expect(";")}return void 0===left&&(match(";")||(test=parseExpression()),expect(";"),match(")")||(update=parseExpression())),expect(")"),oldInIteration=state.inIteration,state.inIteration=!0,body=isolateCoverGrammar(parseStatement),state.inIteration=oldInIteration,void 0===left?node.finishForStatement(init,test,update,body):forIn?node.finishForInStatement(left,right,body):node.finishForOfStatement(left,right,body)}function parseContinueStatement(node){var key,label=null;return expectKeyword("continue"),59===source.charCodeAt(startIndex)?(lex(),state.inIteration||throwError(Messages.IllegalContinue),node.finishContinueStatement(null)):hasLineTerminator?(state.inIteration||throwError(Messages.IllegalContinue),node.finishContinueStatement(null)):(lookahead.type===Token.Identifier&&(label=parseVariableIdentifier(),key="$"+label.name,Object.prototype.hasOwnProperty.call(state.labelSet,key)||throwError(Messages.UnknownLabel,label.name)),consumeSemicolon(),null!==label||state.inIteration||throwError(Messages.IllegalContinue),node.finishContinueStatement(label))}function parseBreakStatement(node){var key,label=null;return expectKeyword("break"),59===source.charCodeAt(lastIndex)?(lex(),state.inIteration||state.inSwitch||throwError(Messages.IllegalBreak),node.finishBreakStatement(null)):(hasLineTerminator?state.inIteration||state.inSwitch||throwError(Messages.IllegalBreak):lookahead.type===Token.Identifier&&(label=parseVariableIdentifier(),key="$"+label.name,Object.prototype.hasOwnProperty.call(state.labelSet,key)||throwError(Messages.UnknownLabel,label.name)),consumeSemicolon(),null!==label||state.inIteration||state.inSwitch||throwError(Messages.IllegalBreak),node.finishBreakStatement(label))}function parseReturnStatement(node){var argument=null;return expectKeyword("return"),state.inFunctionBody||tolerateError(Messages.IllegalReturn),32===source.charCodeAt(lastIndex)&&isIdentifierStart(source.charCodeAt(lastIndex+1))?(argument=parseExpression(),consumeSemicolon(),node.finishReturnStatement(argument)):hasLineTerminator?node.finishReturnStatement(null):(match(";")||match("}")||lookahead.type===Token.EOF||(argument=parseExpression()),consumeSemicolon(),node.finishReturnStatement(argument))}function parseWithStatement(node){var object,body;return strict&&tolerateError(Messages.StrictModeWith),expectKeyword("with"),expect("("),object=parseExpression(),expect(")"),body=parseStatement(),node.finishWithStatement(object,body)}function parseSwitchCase(){var test,statement,consequent=[],node=new Node;for(matchKeyword("default")?(lex(),test=null):(expectKeyword("case"),test=parseExpression()),expect(":");startIndex<length&&!(match("}")||matchKeyword("default")||matchKeyword("case"));)statement=parseStatementListItem(),consequent.push(statement);return node.finishSwitchCase(test,consequent)}function parseSwitchStatement(node){var discriminant,cases,clause,oldInSwitch,defaultFound;if(expectKeyword("switch"),expect("("),discriminant=parseExpression(),expect(")"),expect("{"),cases=[],match("}"))return lex(),node.finishSwitchStatement(discriminant,cases);for(oldInSwitch=state.inSwitch,state.inSwitch=!0,defaultFound=!1;startIndex<length&&!match("}");)clause=parseSwitchCase(),null===clause.test&&(defaultFound&&throwError(Messages.MultipleDefaultsInSwitch),defaultFound=!0),cases.push(clause);return state.inSwitch=oldInSwitch,expect("}"),node.finishSwitchStatement(discriminant,cases)}function parseThrowStatement(node){var argument;return expectKeyword("throw"),
hasLineTerminator&&throwError(Messages.NewlineAfterThrow),argument=parseExpression(),consumeSemicolon(),node.finishThrowStatement(argument)}function parseCatchClause(){var param,key,i,body,params=[],paramMap={},node=new Node;for(expectKeyword("catch"),expect("("),match(")")&&throwUnexpectedToken(lookahead),param=parsePattern(params),i=0;i<params.length;i++)key="$"+params[i].value,Object.prototype.hasOwnProperty.call(paramMap,key)&&tolerateError(Messages.DuplicateBinding,params[i].value),paramMap[key]=!0;return strict&&isRestrictedWord(param.name)&&tolerateError(Messages.StrictCatchVariable),expect(")"),body=parseBlock(),node.finishCatchClause(param,body)}function parseTryStatement(node){var block,handler=null,finalizer=null;return expectKeyword("try"),block=parseBlock(),matchKeyword("catch")&&(handler=parseCatchClause()),matchKeyword("finally")&&(lex(),finalizer=parseBlock()),handler||finalizer||throwError(Messages.NoCatchOrFinally),node.finishTryStatement(block,handler,finalizer)}function parseDebuggerStatement(node){return expectKeyword("debugger"),consumeSemicolon(),node.finishDebuggerStatement()}function parseStatement(){var expr,labeledBody,key,node,type=lookahead.type;if(type===Token.EOF&&throwUnexpectedToken(lookahead),type===Token.Punctuator&&"{"===lookahead.value)return parseBlock();if(isAssignmentTarget=isBindingElement=!0,node=new Node,type===Token.Punctuator)switch(lookahead.value){case";":return parseEmptyStatement(node);case"(":return parseExpressionStatement(node)}else if(type===Token.Keyword)switch(lookahead.value){case"break":return parseBreakStatement(node);case"continue":return parseContinueStatement(node);case"debugger":return parseDebuggerStatement(node);case"do":return parseDoWhileStatement(node);case"for":return parseForStatement(node);case"function":return parseFunctionDeclaration(node);case"if":return parseIfStatement(node);case"return":return parseReturnStatement(node);case"switch":return parseSwitchStatement(node);case"throw":return parseThrowStatement(node);case"try":return parseTryStatement(node);case"var":return parseVariableStatement(node);case"while":return parseWhileStatement(node);case"with":return parseWithStatement(node)}return expr=parseExpression(),expr.type===Syntax.Identifier&&match(":")?(lex(),key="$"+expr.name,Object.prototype.hasOwnProperty.call(state.labelSet,key)&&throwError(Messages.Redeclaration,"Label",expr.name),state.labelSet[key]=!0,labeledBody=parseStatement(),delete state.labelSet[key],node.finishLabeledStatement(expr,labeledBody)):(consumeSemicolon(),node.finishExpressionStatement(expr))}function parseFunctionSourceElements(){var statement,token,directive,firstRestricted,oldLabelSet,oldInIteration,oldInSwitch,oldInFunctionBody,body=[],node=new Node;for(expect("{");startIndex<length&&lookahead.type===Token.StringLiteral&&(token=lookahead,statement=parseStatementListItem(),body.push(statement),statement.expression.type===Syntax.Literal);)directive=source.slice(token.start+1,token.end-1),"use strict"===directive?(strict=!0,firstRestricted&&tolerateUnexpectedToken(firstRestricted,Messages.StrictOctalLiteral)):!firstRestricted&&token.octal&&(firstRestricted=token);for(oldLabelSet=state.labelSet,oldInIteration=state.inIteration,oldInSwitch=state.inSwitch,oldInFunctionBody=state.inFunctionBody,state.labelSet={},state.inIteration=!1,state.inSwitch=!1,state.inFunctionBody=!0;startIndex<length&&!match("}");)body.push(parseStatementListItem());return expect("}"),state.labelSet=oldLabelSet,state.inIteration=oldInIteration,state.inSwitch=oldInSwitch,state.inFunctionBody=oldInFunctionBody,node.finishBlockStatement(body)}function validateParam(options,param,name){var key="$"+name;strict?(isRestrictedWord(name)&&(options.stricted=param,options.message=Messages.StrictParamName),Object.prototype.hasOwnProperty.call(options.paramSet,key)&&(options.stricted=param,options.message=Messages.StrictParamDupe)):options.firstRestricted||(isRestrictedWord(name)?(options.firstRestricted=param,options.message=Messages.StrictParamName):isStrictModeReservedWord(name)?(options.firstRestricted=param,options.message=Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(options.paramSet,key)&&(options.stricted=param,options.message=Messages.StrictParamDupe)),options.paramSet[key]=!0}function parseParam(options){var token,param,i,def,params=[];if(token=lookahead,"..."===token.value)return param=parseRestElement(params),validateParam(options,param.argument,param.argument.name),options.params.push(param),options.defaults.push(null),!1;for(param=parsePatternWithDefault(params),i=0;i<params.length;i++)validateParam(options,params[i],params[i].value);return param.type===Syntax.AssignmentPattern&&(def=param.right,param=param.left,++options.defaultCount),options.params.push(param),options.defaults.push(def),!match(")")}function parseParams(firstRestricted){var options;if(options={params:[],defaultCount:0,defaults:[],firstRestricted:firstRestricted},expect("("),!match(")"))for(options.paramSet={};startIndex<length&&parseParam(options);)expect(",");return expect(")"),0===options.defaultCount&&(options.defaults=[]),{params:options.params,defaults:options.defaults,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}}function parseFunctionDeclaration(node,identifierIsOptional){var body,token,stricted,tmp,firstRestricted,message,previousStrict,isGenerator,previousAllowYield,id=null,params=[],defaults=[];return previousAllowYield=state.allowYield,expectKeyword("function"),isGenerator=match("*"),isGenerator&&lex(),identifierIsOptional&&match("(")||(token=lookahead,id=parseVariableIdentifier(),strict?isRestrictedWord(token.value)&&tolerateUnexpectedToken(token,Messages.StrictFunctionName):isRestrictedWord(token.value)?(firstRestricted=token,message=Messages.StrictFunctionName):isStrictModeReservedWord(token.value)&&(firstRestricted=token,message=Messages.StrictReservedWord)),state.allowYield=!isGenerator,tmp=parseParams(firstRestricted),params=tmp.params,defaults=tmp.defaults,stricted=tmp.stricted,firstRestricted=tmp.firstRestricted,tmp.message&&(message=tmp.message),previousStrict=strict,body=parseFunctionSourceElements(),strict&&firstRestricted&&throwUnexpectedToken(firstRestricted,message),strict&&stricted&&tolerateUnexpectedToken(stricted,message),strict=previousStrict,state.allowYield=previousAllowYield,node.finishFunctionDeclaration(id,params,defaults,body,isGenerator)}function parseFunctionExpression(){var token,stricted,firstRestricted,message,tmp,body,previousStrict,isGenerator,previousAllowYield,id=null,params=[],defaults=[],node=new Node;return previousAllowYield=state.allowYield,expectKeyword("function"),isGenerator=match("*"),isGenerator&&lex(),state.allowYield=!isGenerator,match("(")||(token=lookahead,id=strict||isGenerator||!matchKeyword("yield")?parseVariableIdentifier():parseNonComputedProperty(),strict?isRestrictedWord(token.value)&&tolerateUnexpectedToken(token,Messages.StrictFunctionName):isRestrictedWord(token.value)?(firstRestricted=token,message=Messages.StrictFunctionName):isStrictModeReservedWord(token.value)&&(firstRestricted=token,message=Messages.StrictReservedWord)),tmp=parseParams(firstRestricted),params=tmp.params,defaults=tmp.defaults,stricted=tmp.stricted,firstRestricted=tmp.firstRestricted,tmp.message&&(message=tmp.message),previousStrict=strict,body=parseFunctionSourceElements(),strict&&firstRestricted&&throwUnexpectedToken(firstRestricted,message),strict&&stricted&&tolerateUnexpectedToken(stricted,message),strict=previousStrict,state.allowYield=previousAllowYield,node.finishFunctionExpression(id,params,defaults,body,isGenerator)}function parseClassBody(){var classBody,token,isStatic,body,method,computed,key,hasConstructor=!1;for(classBody=new Node,expect("{"),body=[];!match("}");)match(";")?lex():(method=new Node,token=lookahead,isStatic=!1,computed=match("["),match("*")?lex():(key=parseObjectPropertyKey(),"static"===key.name&&(lookaheadPropertyName()||match("*"))&&(token=lookahead,isStatic=!0,computed=match("["),match("*")?lex():key=parseObjectPropertyKey())),method=tryParseMethodDefinition(token,key,computed,method),method?(method.static=isStatic,"init"===method.kind&&(method.kind="method"),isStatic?method.computed||"prototype"!==(method.key.name||method.key.value.toString())||throwUnexpectedToken(token,Messages.StaticPrototype):method.computed||"constructor"!==(method.key.name||method.key.value.toString())||("method"===method.kind&&method.method&&!method.value.generator||throwUnexpectedToken(token,Messages.ConstructorSpecialMethod),hasConstructor?throwUnexpectedToken(token,Messages.DuplicateConstructor):hasConstructor=!0,method.kind="constructor"),method.type=Syntax.MethodDefinition,delete method.method,delete method.shorthand,body.push(method)):throwUnexpectedToken(lookahead));return lex(),classBody.finishClassBody(body)}function parseClassDeclaration(identifierIsOptional){var classBody,id=null,superClass=null,classNode=new Node,previousStrict=strict;return strict=!0,expectKeyword("class"),identifierIsOptional&&lookahead.type!==Token.Identifier||(id=parseVariableIdentifier()),matchKeyword("extends")&&(lex(),superClass=isolateCoverGrammar(parseLeftHandSideExpressionAllowCall)),classBody=parseClassBody(),strict=previousStrict,classNode.finishClassDeclaration(id,superClass,classBody)}function parseClassExpression(){var classBody,id=null,superClass=null,classNode=new Node,previousStrict=strict;return strict=!0,expectKeyword("class"),lookahead.type===Token.Identifier&&(id=parseVariableIdentifier()),matchKeyword("extends")&&(lex(),superClass=isolateCoverGrammar(parseLeftHandSideExpressionAllowCall)),classBody=parseClassBody(),strict=previousStrict,classNode.finishClassExpression(id,superClass,classBody)}function parseModuleSpecifier(){var node=new Node;return lookahead.type!==Token.StringLiteral&&throwError(Messages.InvalidModuleSpecifier),node.finishLiteral(lex())}function parseExportSpecifier(){var exported,local,def,node=new Node;return matchKeyword("default")?(def=new Node,lex(),local=def.finishIdentifier("default")):local=parseVariableIdentifier(),matchContextualKeyword("as")&&(lex(),exported=parseNonComputedProperty()),node.finishExportSpecifier(local,exported)}function parseExportNamedDeclaration(node){var isExportFromIdentifier,declaration=null,src=null,specifiers=[];if(lookahead.type===Token.Keyword)switch(lookahead.value){case"let":case"const":return declaration=parseLexicalDeclaration({inFor:!1}),node.finishExportNamedDeclaration(declaration,specifiers,null);case"var":case"class":case"function":return declaration=parseStatementListItem(),node.finishExportNamedDeclaration(declaration,specifiers,null)}for(expect("{");!match("}")&&(isExportFromIdentifier=isExportFromIdentifier||matchKeyword("default"),specifiers.push(parseExportSpecifier()),match("}")||(expect(","),!match("}"))););return expect("}"),matchContextualKeyword("from")?(lex(),src=parseModuleSpecifier(),consumeSemicolon()):isExportFromIdentifier?throwError(lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value):consumeSemicolon(),node.finishExportNamedDeclaration(declaration,specifiers,src)}function parseExportDefaultDeclaration(node){var declaration=null,expression=null;return expectKeyword("default"),matchKeyword("function")?(declaration=parseFunctionDeclaration(new Node,!0),node.finishExportDefaultDeclaration(declaration)):matchKeyword("class")?(declaration=parseClassDeclaration(!0),node.finishExportDefaultDeclaration(declaration)):(matchContextualKeyword("from")&&throwError(Messages.UnexpectedToken,lookahead.value),expression=match("{")?parseObjectInitializer():match("[")?parseArrayInitializer():parseAssignmentExpression(),consumeSemicolon(),node.finishExportDefaultDeclaration(expression))}function parseExportAllDeclaration(node){var src;return expect("*"),matchContextualKeyword("from")||throwError(lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value),lex(),src=parseModuleSpecifier(),consumeSemicolon(),node.finishExportAllDeclaration(src)}function parseExportDeclaration(){var node=new Node;return state.inFunctionBody&&throwError(Messages.IllegalExportDeclaration),expectKeyword("export"),matchKeyword("default")?parseExportDefaultDeclaration(node):match("*")?parseExportAllDeclaration(node):parseExportNamedDeclaration(node)}function parseImportSpecifier(){var local,imported,node=new Node;return imported=parseNonComputedProperty(),matchContextualKeyword("as")&&(lex(),local=parseVariableIdentifier()),node.finishImportSpecifier(local,imported)}function parseNamedImports(){var specifiers=[];for(expect("{");!match("}")&&(specifiers.push(parseImportSpecifier()),match("}")||(expect(","),!match("}"))););return expect("}"),specifiers}function parseImportDefaultSpecifier(){var local,node=new Node;return local=parseNonComputedProperty(),node.finishImportDefaultSpecifier(local)}function parseImportNamespaceSpecifier(){var local,node=new Node;return expect("*"),matchContextualKeyword("as")||throwError(Messages.NoAsAfterImportNamespace),lex(),local=parseNonComputedProperty(),node.finishImportNamespaceSpecifier(local)}function parseImportDeclaration(){var src,specifiers=[],node=new Node;return state.inFunctionBody&&throwError(Messages.IllegalImportDeclaration),expectKeyword("import"),lookahead.type===Token.StringLiteral?src=parseModuleSpecifier():(match("{")?specifiers=specifiers.concat(parseNamedImports()):match("*")?specifiers.push(parseImportNamespaceSpecifier()):isIdentifierName(lookahead)&&!matchKeyword("default")?(specifiers.push(parseImportDefaultSpecifier()),match(",")&&(lex(),match("*")?specifiers.push(parseImportNamespaceSpecifier()):match("{")?specifiers=specifiers.concat(parseNamedImports()):throwUnexpectedToken(lookahead))):throwUnexpectedToken(lex()),matchContextualKeyword("from")||throwError(lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value),lex(),src=parseModuleSpecifier()),consumeSemicolon(),node.finishImportDeclaration(specifiers,src)}function parseScriptBody(){for(var statement,token,directive,firstRestricted,body=[];startIndex<length&&(token=lookahead,token.type===Token.StringLiteral)&&(statement=parseStatementListItem(),body.push(statement),statement.expression.type===Syntax.Literal);)directive=source.slice(token.start+1,token.end-1),"use strict"===directive?(strict=!0,firstRestricted&&tolerateUnexpectedToken(firstRestricted,Messages.StrictOctalLiteral)):!firstRestricted&&token.octal&&(firstRestricted=token);for(;startIndex<length&&void 0!==(statement=parseStatementListItem());)body.push(statement);return body}function parseProgram(){var body,node;return peek(),node=new Node,body=parseScriptBody(),node.finishProgram(body,state.sourceType)}function filterTokenLocation(){var i,entry,token,tokens=[];for(i=0;i<extra.tokens.length;++i)entry=extra.tokens[i],token={type:entry.type,value:entry.value},entry.regex&&(token.regex={pattern:entry.regex.pattern,flags:entry.regex.flags}),extra.range&&(token.range=entry.range),extra.loc&&(token.loc=entry.loc),tokens.push(token);extra.tokens=tokens}function tokenize(code,options,delegate){var toString,tokens;toString=String,"string"==typeof code||code instanceof String||(code=toString(code)),source=code,index=0,lineNumber=source.length>0?1:0,lineStart=0,startIndex=index,startLineNumber=lineNumber,startLineStart=lineStart,length=source.length,lookahead=null,state={allowIn:!0,allowYield:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1,curlyStack:[]},extra={},options=options||{},options.tokens=!0,extra.tokens=[],extra.tokenValues=[],extra.tokenize=!0,extra.delegate=delegate,extra.openParenToken=-1,extra.openCurlyToken=-1,extra.range="boolean"==typeof options.range&&options.range,extra.loc="boolean"==typeof options.loc&&options.loc,"boolean"==typeof options.comment&&options.comment&&(extra.comments=[]),"boolean"==typeof options.tolerant&&options.tolerant&&(extra.errors=[]);try{if(peek(),lookahead.type===Token.EOF)return extra.tokens;for(lex();lookahead.type!==Token.EOF;)try{lex()}catch(lexError){if(extra.errors){recordError(lexError);break}throw lexError}tokens=extra.tokens,void 0!==extra.errors&&(tokens.errors=extra.errors)}catch(e){throw e}finally{extra={}}return tokens}function parse(code,options){var program,toString;toString=String,"string"==typeof code||code instanceof String||(code=toString(code)),source=code,index=0,lineNumber=source.length>0?1:0,lineStart=0,startIndex=index,startLineNumber=lineNumber,startLineStart=lineStart,length=source.length,lookahead=null,state={allowIn:!0,allowYield:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1,curlyStack:[],sourceType:"script"},strict=!1,extra={},void 0!==options&&(extra.range="boolean"==typeof options.range&&options.range,extra.loc="boolean"==typeof options.loc&&options.loc,extra.attachComment="boolean"==typeof options.attachComment&&options.attachComment,extra.loc&&null!==options.source&&void 0!==options.source&&(extra.source=toString(options.source)),"boolean"==typeof options.tokens&&options.tokens&&(extra.tokens=[]),"boolean"==typeof options.comment&&options.comment&&(extra.comments=[]),"boolean"==typeof options.tolerant&&options.tolerant&&(extra.errors=[]),extra.attachComment&&(extra.range=!0,extra.comments=[],extra.bottomRightStack=[],extra.trailingComments=[],extra.leadingComments=[]),"module"===options.sourceType&&(state.sourceType=options.sourceType,strict=!0));try{program=parseProgram(),void 0!==extra.comments&&(program.comments=extra.comments),void 0!==extra.tokens&&(filterTokenLocation(),program.tokens=extra.tokens),void 0!==extra.errors&&(program.errors=extra.errors)}catch(e){throw e}finally{extra={}}return program}var Token,TokenName,FnExprTokens,Syntax,PlaceHolders,Messages,Regex,source,strict,index,lineNumber,lineStart,hasLineTerminator,lastIndex,lastLineNumber,lastLineStart,startIndex,startLineNumber,startLineStart,scanning,length,lookahead,state,extra,isBindingElement,isAssignmentTarget,firstCoverInitializedNameError;Token={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9,Template:10},TokenName={},TokenName[Token.BooleanLiteral]="Boolean",TokenName[Token.EOF]="<end>",TokenName[Token.Identifier]="Identifier",TokenName[Token.Keyword]="Keyword",TokenName[Token.NullLiteral]="Null",TokenName[Token.NumericLiteral]="Numeric",TokenName[Token.Punctuator]="Punctuator",TokenName[Token.StringLiteral]="String",TokenName[Token.RegularExpression]="RegularExpression",TokenName[Token.Template]="Template",FnExprTokens=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},PlaceHolders={ArrowParameterPlaceHolder:"ArrowParameterPlaceHolder"},Messages={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",DefaultRestParameter:"Unexpected token =",ObjectPatternAsRestParameter:"Unexpected token {",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ConstructorSpecialMethod:"Class constructor may not be an accessor",DuplicateConstructor:"A class may only have one constructor",StaticPrototype:"Classes may not have static property named prototype",MissingFromClause:"Unexpected token",NoAsAfterImportNamespace:"Unexpected token",InvalidModuleSpecifier:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalExportDeclaration:"Unexpected token",DuplicateBinding:"Duplicate binding %0"},Regex={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,
NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},WrappingNode.prototype=Node.prototype={processComment:function(){var lastChild,innerComments,leadingComments,trailingComments,i,comment,bottomRight=extra.bottomRightStack,last=bottomRight[bottomRight.length-1];if(!(this.type===Syntax.Program&&this.body.length>0)){if(this.type===Syntax.BlockStatement&&0===this.body.length){for(innerComments=[],i=extra.leadingComments.length-1;i>=0;--i)comment=extra.leadingComments[i],this.range[1]>=comment.range[1]&&(innerComments.unshift(comment),extra.leadingComments.splice(i,1),extra.trailingComments.splice(i,1));if(innerComments.length)return void(this.innerComments=innerComments)}if(extra.trailingComments.length>0){for(trailingComments=[],i=extra.trailingComments.length-1;i>=0;--i)comment=extra.trailingComments[i],comment.range[0]>=this.range[1]&&(trailingComments.unshift(comment),extra.trailingComments.splice(i,1));extra.trailingComments=[]}else last&&last.trailingComments&&last.trailingComments[0].range[0]>=this.range[1]&&(trailingComments=last.trailingComments,delete last.trailingComments);for(;last&&last.range[0]>=this.range[0];)lastChild=bottomRight.pop(),last=bottomRight[bottomRight.length-1];if(lastChild){if(lastChild.leadingComments){for(leadingComments=[],i=lastChild.leadingComments.length-1;i>=0;--i)comment=lastChild.leadingComments[i],comment.range[1]<=this.range[0]&&(leadingComments.unshift(comment),lastChild.leadingComments.splice(i,1));lastChild.leadingComments.length||(lastChild.leadingComments=void 0)}}else if(extra.leadingComments.length>0)for(leadingComments=[],i=extra.leadingComments.length-1;i>=0;--i)comment=extra.leadingComments[i],comment.range[1]<=this.range[0]&&(leadingComments.unshift(comment),extra.leadingComments.splice(i,1));leadingComments&&leadingComments.length>0&&(this.leadingComments=leadingComments),trailingComments&&trailingComments.length>0&&(this.trailingComments=trailingComments),bottomRight.push(this)}},finish:function(){extra.range&&(this.range[1]=lastIndex),extra.loc&&(this.loc.end={line:lastLineNumber,column:lastIndex-lastLineStart},extra.source&&(this.loc.source=extra.source)),extra.attachComment&&this.processComment()},finishArrayExpression:function(elements){return this.type=Syntax.ArrayExpression,this.elements=elements,this.finish(),this},finishArrayPattern:function(elements){return this.type=Syntax.ArrayPattern,this.elements=elements,this.finish(),this},finishArrowFunctionExpression:function(params,defaults,body,expression){return this.type=Syntax.ArrowFunctionExpression,this.id=null,this.params=params,this.defaults=defaults,this.body=body,this.generator=!1,this.expression=expression,this.finish(),this},finishAssignmentExpression:function(operator,left,right){return this.type=Syntax.AssignmentExpression,this.operator=operator,this.left=left,this.right=right,this.finish(),this},finishAssignmentPattern:function(left,right){return this.type=Syntax.AssignmentPattern,this.left=left,this.right=right,this.finish(),this},finishBinaryExpression:function(operator,left,right){return this.type="||"===operator||"&&"===operator?Syntax.LogicalExpression:Syntax.BinaryExpression,this.operator=operator,this.left=left,this.right=right,this.finish(),this},finishBlockStatement:function(body){return this.type=Syntax.BlockStatement,this.body=body,this.finish(),this},finishBreakStatement:function(label){return this.type=Syntax.BreakStatement,this.label=label,this.finish(),this},finishCallExpression:function(callee,args){return this.type=Syntax.CallExpression,this.callee=callee,this.arguments=args,this.finish(),this},finishCatchClause:function(param,body){return this.type=Syntax.CatchClause,this.param=param,this.body=body,this.finish(),this},finishClassBody:function(body){return this.type=Syntax.ClassBody,this.body=body,this.finish(),this},finishClassDeclaration:function(id,superClass,body){return this.type=Syntax.ClassDeclaration,this.id=id,this.superClass=superClass,this.body=body,this.finish(),this},finishClassExpression:function(id,superClass,body){return this.type=Syntax.ClassExpression,this.id=id,this.superClass=superClass,this.body=body,this.finish(),this},finishConditionalExpression:function(test,consequent,alternate){return this.type=Syntax.ConditionalExpression,this.test=test,this.consequent=consequent,this.alternate=alternate,this.finish(),this},finishContinueStatement:function(label){return this.type=Syntax.ContinueStatement,this.label=label,this.finish(),this},finishDebuggerStatement:function(){return this.type=Syntax.DebuggerStatement,this.finish(),this},finishDoWhileStatement:function(body,test){return this.type=Syntax.DoWhileStatement,this.body=body,this.test=test,this.finish(),this},finishEmptyStatement:function(){return this.type=Syntax.EmptyStatement,this.finish(),this},finishExpressionStatement:function(expression){return this.type=Syntax.ExpressionStatement,this.expression=expression,this.finish(),this},finishForStatement:function(init,test,update,body){return this.type=Syntax.ForStatement,this.init=init,this.test=test,this.update=update,this.body=body,this.finish(),this},finishForOfStatement:function(left,right,body){return this.type=Syntax.ForOfStatement,this.left=left,this.right=right,this.body=body,this.finish(),this},finishForInStatement:function(left,right,body){return this.type=Syntax.ForInStatement,this.left=left,this.right=right,this.body=body,this.each=!1,this.finish(),this},finishFunctionDeclaration:function(id,params,defaults,body,generator){return this.type=Syntax.FunctionDeclaration,this.id=id,this.params=params,this.defaults=defaults,this.body=body,this.generator=generator,this.expression=!1,this.finish(),this},finishFunctionExpression:function(id,params,defaults,body,generator){return this.type=Syntax.FunctionExpression,this.id=id,this.params=params,this.defaults=defaults,this.body=body,this.generator=generator,this.expression=!1,this.finish(),this},finishIdentifier:function(name){return this.type=Syntax.Identifier,this.name=name,this.finish(),this},finishIfStatement:function(test,consequent,alternate){return this.type=Syntax.IfStatement,this.test=test,this.consequent=consequent,this.alternate=alternate,this.finish(),this},finishLabeledStatement:function(label,body){return this.type=Syntax.LabeledStatement,this.label=label,this.body=body,this.finish(),this},finishLiteral:function(token){return this.type=Syntax.Literal,this.value=token.value,this.raw=source.slice(token.start,token.end),token.regex&&(this.regex=token.regex),this.finish(),this},finishMemberExpression:function(accessor,object,property){return this.type=Syntax.MemberExpression,this.computed="["===accessor,this.object=object,this.property=property,this.finish(),this},finishMetaProperty:function(meta,property){return this.type=Syntax.MetaProperty,this.meta=meta,this.property=property,this.finish(),this},finishNewExpression:function(callee,args){return this.type=Syntax.NewExpression,this.callee=callee,this.arguments=args,this.finish(),this},finishObjectExpression:function(properties){return this.type=Syntax.ObjectExpression,this.properties=properties,this.finish(),this},finishObjectPattern:function(properties){return this.type=Syntax.ObjectPattern,this.properties=properties,this.finish(),this},finishPostfixExpression:function(operator,argument){return this.type=Syntax.UpdateExpression,this.operator=operator,this.argument=argument,this.prefix=!1,this.finish(),this},finishProgram:function(body,sourceType){return this.type=Syntax.Program,this.body=body,this.sourceType=sourceType,this.finish(),this},finishProperty:function(kind,key,computed,value,method,shorthand){return this.type=Syntax.Property,this.key=key,this.computed=computed,this.value=value,this.kind=kind,this.method=method,this.shorthand=shorthand,this.finish(),this},finishRestElement:function(argument){return this.type=Syntax.RestElement,this.argument=argument,this.finish(),this},finishReturnStatement:function(argument){return this.type=Syntax.ReturnStatement,this.argument=argument,this.finish(),this},finishSequenceExpression:function(expressions){return this.type=Syntax.SequenceExpression,this.expressions=expressions,this.finish(),this},finishSpreadElement:function(argument){return this.type=Syntax.SpreadElement,this.argument=argument,this.finish(),this},finishSwitchCase:function(test,consequent){return this.type=Syntax.SwitchCase,this.test=test,this.consequent=consequent,this.finish(),this},finishSuper:function(){return this.type=Syntax.Super,this.finish(),this},finishSwitchStatement:function(discriminant,cases){return this.type=Syntax.SwitchStatement,this.discriminant=discriminant,this.cases=cases,this.finish(),this},finishTaggedTemplateExpression:function(tag,quasi){return this.type=Syntax.TaggedTemplateExpression,this.tag=tag,this.quasi=quasi,this.finish(),this},finishTemplateElement:function(value,tail){return this.type=Syntax.TemplateElement,this.value=value,this.tail=tail,this.finish(),this},finishTemplateLiteral:function(quasis,expressions){return this.type=Syntax.TemplateLiteral,this.quasis=quasis,this.expressions=expressions,this.finish(),this},finishThisExpression:function(){return this.type=Syntax.ThisExpression,this.finish(),this},finishThrowStatement:function(argument){return this.type=Syntax.ThrowStatement,this.argument=argument,this.finish(),this},finishTryStatement:function(block,handler,finalizer){return this.type=Syntax.TryStatement,this.block=block,this.guardedHandlers=[],this.handlers=handler?[handler]:[],this.handler=handler,this.finalizer=finalizer,this.finish(),this},finishUnaryExpression:function(operator,argument){return this.type="++"===operator||"--"===operator?Syntax.UpdateExpression:Syntax.UnaryExpression,this.operator=operator,this.argument=argument,this.prefix=!0,this.finish(),this},finishVariableDeclaration:function(declarations){return this.type=Syntax.VariableDeclaration,this.declarations=declarations,this.kind="var",this.finish(),this},finishLexicalDeclaration:function(declarations,kind){return this.type=Syntax.VariableDeclaration,this.declarations=declarations,this.kind=kind,this.finish(),this},finishVariableDeclarator:function(id,init){return this.type=Syntax.VariableDeclarator,this.id=id,this.init=init,this.finish(),this},finishWhileStatement:function(test,body){return this.type=Syntax.WhileStatement,this.test=test,this.body=body,this.finish(),this},finishWithStatement:function(object,body){return this.type=Syntax.WithStatement,this.object=object,this.body=body,this.finish(),this},finishExportSpecifier:function(local,exported){return this.type=Syntax.ExportSpecifier,this.exported=exported||local,this.local=local,this.finish(),this},finishImportDefaultSpecifier:function(local){return this.type=Syntax.ImportDefaultSpecifier,this.local=local,this.finish(),this},finishImportNamespaceSpecifier:function(local){return this.type=Syntax.ImportNamespaceSpecifier,this.local=local,this.finish(),this},finishExportNamedDeclaration:function(declaration,specifiers,src){return this.type=Syntax.ExportNamedDeclaration,this.declaration=declaration,this.specifiers=specifiers,this.source=src,this.finish(),this},finishExportDefaultDeclaration:function(declaration){return this.type=Syntax.ExportDefaultDeclaration,this.declaration=declaration,this.finish(),this},finishExportAllDeclaration:function(src){return this.type=Syntax.ExportAllDeclaration,this.source=src,this.finish(),this},finishImportSpecifier:function(local,imported){return this.type=Syntax.ImportSpecifier,this.local=local||imported,this.imported=imported,this.finish(),this},finishImportDeclaration:function(specifiers,src){return this.type=Syntax.ImportDeclaration,this.specifiers=specifiers,this.source=src,this.finish(),this},finishYieldExpression:function(argument,delegate){return this.type=Syntax.YieldExpression,this.argument=argument,this.delegate=delegate,this.finish(),this}},exports.version="2.7.3",exports.tokenize=tokenize,exports.parse=parse,exports.Syntax=function(){var name,types={};"function"==typeof Object.create&&(types=Object.create(null));for(name in Syntax)Syntax.hasOwnProperty(name)&&(types[name]=Syntax[name]);return"function"==typeof Object.freeze&&Object.freeze(types),types}()})},{}],28:[function(_dereq_,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((er=arguments[1])instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){return this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){return emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],29:[function(_dereq_,module,exports){(function(process){function jsSprintf(fmt){var flags,width,precision,conversion,left,pad,sign,arg,match,regex=["([^%]*)","%","(['\\-+ #0]*?)","([1-9]\\d*)?","(\\.([1-9]\\d*))?","[lhjztL]*?","([diouxXfFeEgGaAcCsSp%jr])"].join(""),re=new RegExp(regex),args=Array.prototype.slice.call(arguments,1),ret="",argn=1;for(mod_assert.equal("string",typeof fmt);null!==(match=re.exec(fmt));)if(ret+=match[1],fmt=fmt.substring(match[0].length),flags=match[2]||"",width=match[3]||0,precision=match[4]||"",conversion=match[6],left=!1,sign=!1,pad=" ","%"!=conversion){if(0===args.length)throw new Error("too few args to sprintf");if(arg=args.shift(),argn++,flags.match(/[\' #]/))throw new Error("unsupported flags: "+flags);if(precision.length>0)throw new Error("non-zero precision not supported");switch(flags.match(/-/)&&(left=!0),flags.match(/0/)&&(pad="0"),flags.match(/\+/)&&(sign=!0),conversion){case"s":if(void 0===arg||null===arg)throw new Error("argument "+argn+": attempted to print undefined or null as a string");ret+=doPad(pad,width,left,arg.toString());break;case"d":arg=Math.floor(arg);case"f":sign=sign&&arg>0?"+":"",ret+=sign+doPad(pad,width,left,arg.toString());break;case"x":ret+=doPad(pad,width,left,arg.toString(16));break;case"j":0===width&&(width=10),ret+=mod_util.inspect(arg,!1,width);break;case"r":ret+=dumpException(arg);break;default:throw new Error("unsupported conversion: "+conversion)}}else ret+="%";return ret+=fmt}function jsPrintf(){var args=Array.prototype.slice.call(arguments);args.unshift(process.stdout),jsFprintf.apply(null,args)}function jsFprintf(stream){var args=Array.prototype.slice.call(arguments,1);return stream.write(jsSprintf.apply(this,args))}function doPad(chr,width,left,str){for(var ret=str;ret.length<width;)left?ret+=chr:ret=chr+ret;return ret}function dumpException(ex){var ret;if(!(ex instanceof Error))throw new Error(jsSprintf("invalid type for %%r: %j",ex));if(ret="EXCEPTION: "+ex.constructor.name+": "+ex.stack,ex.cause&&"function"==typeof ex.cause){var cex=ex.cause();cex&&(ret+="\nCaused by: "+dumpException(cex))}return ret}var mod_assert=_dereq_("assert"),mod_util=_dereq_("util");exports.sprintf=jsSprintf,exports.printf=jsPrintf,exports.fprintf=jsFprintf}).call(this,_dereq_("_process"))},{_process:34,assert:2,util:54}],30:[function(_dereq_,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],31:[function(_dereq_,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],32:[function(_dereq_,module,exports){function isBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isBuffer(obj.slice(0,0))}module.exports=function(obj){return null!=obj&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)}},{}],33:[function(_dereq_,module,exports){(function(process){"use strict";function nextTick(fn,arg1,arg2,arg3){if("function"!=typeof fn)throw new TypeError('"callback" argument must be a function');var args,i,len=arguments.length;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function(){fn.call(null,arg1)});case 3:return process.nextTick(function(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function(){fn.call(null,arg1,arg2,arg3)});default:for(args=new Array(len-1),i=0;i<args.length;)args[i++]=arguments[i];return process.nextTick(function(){fn.apply(null,args)})}}!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports=nextTick:module.exports=process.nextTick}).call(this,_dereq_("_process"))},{_process:34}],34:[function(_dereq_,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,
process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],35:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":36}],36:[function(_dereq_,module,exports){"use strict";function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),options&&!1===options.readable&&(this.readable=!1),options&&!1===options.writable&&(this.writable=!1),this.allowHalfOpen=!0,options&&!1===options.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||processNextTick(onEndNT,this)}function onEndNT(self){self.end()}var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var processNextTick=_dereq_("process-nextick-args"),util=_dereq_("core-util-is");util.inherits=_dereq_("inherits");var Readable=_dereq_("./_stream_readable"),Writable=_dereq_("./_stream_writable");util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}},{"./_stream_readable":38,"./_stream_writable":40,"core-util-is":26,inherits:31,"process-nextick-args":33}],37:[function(_dereq_,module,exports){"use strict";function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}module.exports=PassThrough;var Transform=_dereq_("./_stream_transform"),util=_dereq_("core-util-is");util.inherits=_dereq_("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":39,"core-util-is":26,inherits:31}],38:[function(_dereq_,module,exports){(function(process){"use strict";function prependListener(emitter,event,fn){if("function"==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}function ReadableState(options,stream){Duplex=Duplex||_dereq_("./_stream_duplex"),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=_dereq_("string_decoder/").StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(Duplex=Duplex||_dereq_("./_stream_duplex"),!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this),this.readable=!0,options&&"function"==typeof options.read&&(this._read=options.read),Stream.call(this)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er)stream.emit("error",er);else if(null===chunk)state.reading=!1,onEofChunk(stream,state);else if(state.objectMode||chunk&&chunk.length>0)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk),skipAdd=!state.objectMode&&0===chunk.length),addToFront||(state.reading=!1),skipAdd||(state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream))),maybeReadMore(stream,state)}else addToFront||(state.reading=!1);return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}function computeNewHighWaterMark(n){return n>=MAX_HWM?n=MAX_HWM:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!==n?state.flowing&&state.length?state.buffer.head.data.length:state.length:(n>state.highWaterMark&&(state.highWaterMark=computeNewHighWaterMark(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}function chunkInvalid(state,chunk){var er=null;return Buffer.isBuffer(chunk)||"string"==typeof chunk||null===chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er}function onEofChunk(stream,state){if(!state.ended){if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?processNextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,processNextTick(maybeReadMore_,stream,state))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EElistenerCount(src,"data")&&(state.flowing=!0,flow(src))}}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,processNextTick(resume_,stream,state))}function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,state.awaitDrain=0,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;for(debug("flow",state.flowing);state.flowing&&null!==stream.read(););}function fromList(n,state){if(0===state.length)return null;var ret;return state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(""):1===state.buffer.length?state.buffer.head.data:state.buffer.concat(state.length),state.buffer.clear()):ret=fromListPartial(n,state.buffer,state.decoder),ret}function fromListPartial(n,list,hasStrings){var ret;return n<list.head.data.length?(ret=list.head.data.slice(0,n),list.head.data=list.head.data.slice(n)):ret=n===list.head.data.length?list.shift():hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list),ret}function copyFromBufferString(n,list){var p=list.head,c=1,ret=p.data;for(n-=ret.length;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=str.slice(nb));break}++c}return list.length-=c,ret}function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n),p=list.head,c=1;for(p.data.copy(ret),n-=p.data.length;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=buf.slice(nb));break}++c}return list.length-=c,ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');state.endEmitted||(state.ended=!0,processNextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}module.exports=Readable;var Duplex,processNextTick=_dereq_("process-nextick-args"),isArray=_dereq_("isarray");Readable.ReadableState=ReadableState;var EElistenerCount=(_dereq_("events").EventEmitter,function(emitter,type){return emitter.listeners(type).length}),Stream=_dereq_("./internal/streams/stream"),Buffer=_dereq_("safe-buffer").Buffer,util=_dereq_("core-util-is");util.inherits=_dereq_("inherits");var debugUtil=_dereq_("util"),debug=void 0;debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){};var StringDecoder,BufferList=_dereq_("./internal/streams/BufferList");util.inherits(Readable,Stream);var kProxyEvents=["error","close","destroy","pause","resume"];Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return state.objectMode||"string"!=typeof chunk||(encoding=encoding||state.defaultEncoding)!==state.encoding&&(chunk=Buffer.from(chunk,encoding),encoding=""),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,this._readableState,chunk,"",!0)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=_dereq_("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;Readable.prototype.read=function(n){debug("read",n),n=parseInt(n,10);var state=this._readableState,nOrig=n;if(0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(0===(n=howMuchToRead(n,state))&&state.ended)return 0===state.length&&endReadable(this),null;var doRead=state.needReadable;debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&(doRead=!0,debug("length less than watermark",doRead)),state.ended||state.reading?(doRead=!1,debug("reading or ended",doRead)):doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state)));var ret;return ret=n>0?fromList(n,state):null,null===ret?(state.needReadable=!0,n=0):state.length-=n,0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&endReadable(this)),null!==ret&&this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable){debug("onunpipe"),readable===src&&cleanup()}function onend(){debug("onend"),dest.end()}function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",unpipe),src.removeListener("data",ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}function ondata(chunk){debug("ondata"),increasedAwaitDrain=!1,!1!==dest.write(chunk)||increasedAwaitDrain||((1===state.pipesCount&&state.pipes===dest||state.pipesCount>1&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,increasedAwaitDrain=!0),src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EElistenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||!1!==pipeOpts.end)&&dest!==process.stdout&&dest!==process.stderr,endFn=doEnd?onend:unpipe;state.endEmitted?processNextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=!1,increasedAwaitDrain=!1;return src.on("data",ondata),prependListener(dest,"error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var index=indexOf(state.pipes,dest);return-1===index?this:(state.pipes.splice(index,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev)!1!==this._readableState.flowing&&this.resume();else if("readable"===ev){var state=this._readableState;state.endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.emittedReadable=!1,state.reading?state.length&&emitReadable(this,state):processNextTick(nReadingNextTick,this))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,resume(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),(!state.objectMode||null!==chunk&&void 0!==chunk)&&(state.objectMode||chunk&&chunk.length)){self.push(chunk)||(paused=!0,stream.pause())}});for(var i in stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));for(var n=0;n<kProxyEvents.length;n++)stream.on(kProxyEvents[n],self.emit.bind(self,kProxyEvents[n]));return self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(this,_dereq_("_process"))},{"./_stream_duplex":36,"./internal/streams/BufferList":41,"./internal/streams/stream":42,_process:34,"core-util-is":26,events:28,inherits:31,isarray:43,"process-nextick-args":33,"safe-buffer":44,"string_decoder/":45,util:23}],39:[function(_dereq_,module,exports){"use strict";function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,ts.writecb=null,null!==data&&void 0!==data&&stream.push(data),cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(er,data){done(stream,er,data)}):done(stream)})}function done(stream,er,data){if(er)return stream.emit("error",er);null!==data&&void 0!==data&&stream.push(data);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=_dereq_("./_stream_duplex"),util=_dereq_("core-util-is");util.inherits=_dereq_("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0}},{"./_stream_duplex":36,"core-util-is":26,inherits:31}],40:[function(_dereq_,module,exports){(function(process){"use strict";function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb,this.next=null}function WritableState(options,stream){Duplex=Duplex||_dereq_("./_stream_duplex"),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var noDecode=!1===options.decodeStrings;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){onwrite(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(options){if(Duplex=Duplex||_dereq_("./_stream_duplex"),!(realHasInstance.call(Writable,this)||this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev)),Stream.call(this)}function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er),processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=!0,er=!1;return null===chunk?er=new TypeError("May not write null values to stream"):"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er&&(stream.emit("error",er),processNextTick(cb,er),valid=!1),valid}function decodeChunk(state,chunk,encoding){return state.objectMode||!1===state.decodeStrings||"string"!=typeof chunk||(chunk=Buffer.from(chunk,encoding)),chunk}function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){isBuf||(chunk=decodeChunk(state,chunk,encoding),Buffer.isBuffer(chunk)&&(encoding="buffer"));var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(ret||(state.needDrain=!0),state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb),last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function onwriteError(stream,state,sync,er,cb){--state.pendingcb,sync?processNextTick(cb,er):cb(er),stream._writableState.errorEmitted=!0,stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(onwriteStateUpdate(state),er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?asyncWrite(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}function afterWrite(stream,state,finished,cb){finished||onwriteDrain(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount,buffer=new Array(l),holder=state.corkedRequestsFree;holder.entry=entry;for(var count=0;entry;)buffer[count]=entry,entry=entry.next,count+=1;doWrite(stream,state,!0,state.length,buffer,"",holder.finish),state.pendingcb++,state.lastBufferedRequest=null,holder.next?(state.corkedRequestsFree=holder.next,holder.next=null):state.corkedRequestsFree=new CorkedRequest(state)}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequestCount=0,state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function prefinish(stream,state){state.prefinished||(state.prefinished=!0,stream.emit("prefinish"))}function finishMaybe(stream,state){var need=needFinish(state);return need&&(0===state.pendingcb?(prefinish(stream,state),state.finished=!0,stream.emit("finish")):prefinish(stream,state)),need}function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?processNextTick(cb):stream.once("finish",cb)),state.ended=!0,stream.writable=!1}function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(err){var entry=_this.entry;for(_this.entry=null;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree?state.corkedRequestsFree.next=_this:state.corkedRequestsFree=_this}}module.exports=Writable;var Duplex,processNextTick=_dereq_("process-nextick-args"),asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;Writable.WritableState=WritableState;var util=_dereq_("core-util-is");util.inherits=_dereq_("inherits");var internalUtil={deprecate:_dereq_("util-deprecate")},Stream=_dereq_("./internal/streams/stream"),Buffer=_dereq_("safe-buffer").Buffer;util.inherits(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(_){}}();var realHasInstance;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(realHasInstance=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){return!!realHasInstance.call(this,object)||object&&object._writableState instanceof WritableState}})):realHasInstance=function(object){return object instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1,isBuf=Buffer.isBuffer(chunk);return"function"==typeof encoding&&(cb=encoding,encoding=null),isBuf?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=nop),state.ended?writeAfterEnd(this,cb):(isBuf||validChunk(this,state,chunk,cb))&&(state.pendingcb++,ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);return this._writableState.defaultEncoding=encoding,this},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!==chunk&&void 0!==chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||endWritable(this,state,cb)}}).call(this,_dereq_("_process"))},{"./_stream_duplex":36,"./internal/streams/stream":42,_process:34,"core-util-is":26,inherits:31,"process-nextick-args":33,"safe-buffer":44,"util-deprecate":51}],41:[function(_dereq_,module,exports){"use strict";function BufferList(){this.head=null,this.tail=null,this.length=0}var Buffer=_dereq_("safe-buffer").Buffer;module.exports=BufferList,BufferList.prototype.push=function(v){var entry={data:v,next:null};this.length>0?this.tail.next=entry:this.head=entry,this.tail=entry,++this.length},BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};0===this.length&&(this.tail=entry),this.head=entry,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var ret=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(s){if(0===this.length)return"";for(var p=this.head,ret=""+p.data;p=p.next;)ret+=s+p.data;return ret},BufferList.prototype.concat=function(n){if(0===this.length)return Buffer.alloc(0);if(1===this.length)return this.head.data;for(var ret=Buffer.allocUnsafe(n>>>0),p=this.head,i=0;p;)p.data.copy(ret,i),i+=p.data.length,p=p.next;return ret}},{"safe-buffer":44}],42:[function(_dereq_,module,exports){module.exports=_dereq_("events").EventEmitter},{events:28}],43:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],44:[function(_dereq_,module,exports){module.exports=_dereq_("buffer")},{buffer:24}],45:[function(_dereq_,module,exports){"use strict";function _normalizeEncoding(enc){if(!enc)return"utf8";for(var retried;;)switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase(),retried=!0}}function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if("string"!=typeof nenc&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,nb=4;break;case"utf8":this.fillLast=utf8FillLast,nb=4;break;case"base64":this.text=base64Text,this.end=base64End,nb=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(nb)}function utf8CheckByte(byte){return byte<=127?0:byte>>5==6?2:byte>>4==14?3:byte>>3==30?4:-1}function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);return nb>=0?(nb>0&&(self.lastNeed=nb-1),nb):--j<i?0:(nb=utf8CheckByte(buf[j]))>=0?(nb>0&&(self.lastNeed=nb-2),nb):--j<i?0:(nb=utf8CheckByte(buf[j]),nb>=0?(nb>0&&(2===nb?nb=0:self.lastNeed=nb-3),nb):0)}function utf8CheckExtraBytes(self,buf,p){if(128!=(192&buf[0]))return self.lastNeed=0,"�".repeat(p);if(self.lastNeed>1&&buf.length>1){if(128!=(192&buf[1]))return self.lastNeed=1,"�".repeat(p+1);if(self.lastNeed>2&&buf.length>2&&128!=(192&buf[2]))return self.lastNeed=2,"�".repeat(p+2)}}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed,r=utf8CheckExtraBytes(this,buf,p);return void 0!==r?r:this.lastNeed<=buf.length?(buf.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(buf.copy(this.lastChar,p,0,buf.length),void(this.lastNeed-=buf.length))}function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);return buf.copy(this.lastChar,0,end),buf.toString("utf8",i,end)}function utf8End(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+"�".repeat(this.lastTotal-this.lastNeed):r}function utf16Text(buf,i){if((buf.length-i)%2==0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=buf[buf.length-1],buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;return 0===n?buf.toString("base64",i):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=buf[buf.length-1]:(this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1]),
buf.toString("base64",i,buf.length-n))}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+this.lastChar.toString("base64",0,3-this.lastNeed):r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}var Buffer=_dereq_("safe-buffer").Buffer,isEncoding=Buffer.isEncoding||function(encoding){switch((encoding=""+encoding)&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};exports.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(buf){if(0===buf.length)return"";var r,i;if(this.lastNeed){if(void 0===(r=this.fillLast(buf)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<buf.length?r?r+this.text(buf,i):this.text(buf,i):r||""},StringDecoder.prototype.end=utf8End,StringDecoder.prototype.text=utf8Text,StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length)return buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length),this.lastNeed-=buf.length}},{"safe-buffer":44}],46:[function(_dereq_,module,exports){module.exports=_dereq_("./readable").PassThrough},{"./readable":47}],47:[function(_dereq_,module,exports){exports=module.exports=_dereq_("./lib/_stream_readable.js"),exports.Stream=exports,exports.Readable=exports,exports.Writable=_dereq_("./lib/_stream_writable.js"),exports.Duplex=_dereq_("./lib/_stream_duplex.js"),exports.Transform=_dereq_("./lib/_stream_transform.js"),exports.PassThrough=_dereq_("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":36,"./lib/_stream_passthrough.js":37,"./lib/_stream_readable.js":38,"./lib/_stream_transform.js":39,"./lib/_stream_writable.js":40}],48:[function(_dereq_,module,exports){module.exports=_dereq_("./readable").Transform},{"./readable":47}],49:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":40}],50:[function(_dereq_,module,exports){function Stream(){EE.call(this)}module.exports=Stream;var EE=_dereq_("events").EventEmitter;_dereq_("inherits")(Stream,EE),Stream.Readable=_dereq_("readable-stream/readable.js"),Stream.Writable=_dereq_("readable-stream/writable.js"),Stream.Duplex=_dereq_("readable-stream/duplex.js"),Stream.Transform=_dereq_("readable-stream/transform.js"),Stream.PassThrough=_dereq_("readable-stream/passthrough.js"),Stream.Stream=Stream,Stream.prototype.pipe=function(dest,options){function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}var source=this;source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&!1===options.end||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},{events:28,inherits:31,"readable-stream/duplex.js":35,"readable-stream/passthrough.js":46,"readable-stream/readable.js":47,"readable-stream/transform.js":48,"readable-stream/writable.js":49}],51:[function(_dereq_,module,exports){(function(global){function deprecate(fn,msg){function deprecated(){if(!warned){if(config("throwDeprecation"))throw new Error(msg);config("traceDeprecation")?console.trace(msg):console.warn(msg),warned=!0}return fn.apply(this,arguments)}if(config("noDeprecation"))return fn;var warned=!1;return deprecated}function config(name){try{if(!global.localStorage)return!1}catch(_){return!1}var val=global.localStorage[name];return null!=val&&"true"===String(val).toLowerCase()}module.exports=deprecate}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],52:[function(_dereq_,module,exports){arguments[4][31][0].apply(exports,arguments)},{dup:31}],53:[function(_dereq_,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],54:[function(_dereq_,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){base=" [Function"+(value.name?": "+value.name:"")+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(recurseTimes<0)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;i<l;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;return output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];i<len;x=args[++i])isNull(x)||!isObject(x)?str+=" "+x:str+=" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(!0===process.noDeprecation)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=_dereq_("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=_dereq_("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,_dereq_("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":53,_process:34,inherits:52}],55:[function(_dereq_,module,exports){var v1=_dereq_("./v1"),v4=_dereq_("./v4"),uuid=v4;uuid.v1=v1,uuid.v4=v4,module.exports=uuid},{"./v1":58,"./v4":59}],56:[function(_dereq_,module,exports){function bytesToUuid(buf,offset){var i=offset||0,bth=byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}for(var byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);module.exports=bytesToUuid},{}],57:[function(_dereq_,module,exports){(function(global){var rng,crypto=global.crypto||global.msCrypto;if(crypto&&crypto.getRandomValues){var rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(rnds8),rnds8}}if(!rng){var rnds=new Array(16);rng=function(){for(var r,i=0;i<16;i++)0==(3&i)&&(r=4294967296*Math.random()),rnds[i]=r>>>((3&i)<<3)&255;return rnds}}module.exports=rng}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(_dereq_,module,exports){function v1(options,buf,offset){var i=buf&&offset||0,b=buf||[];options=options||{};var clockseq=void 0!==options.clockseq?options.clockseq:_clockseq,msecs=void 0!==options.msecs?options.msecs:(new Date).getTime(),nsecs=void 0!==options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&void 0===options.clockseq&&(clockseq=clockseq+1&16383),(dt<0||msecs>_lastMSecs)&&void 0===options.nsecs&&(nsecs=0),nsecs>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq,msecs+=122192928e5;var tl=(1e4*(268435455&msecs)+nsecs)%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var node=options.node||_nodeId,n=0;n<6;++n)b[i+n]=node[n];return buf||bytesToUuid(b)}var rng=_dereq_("./lib/rng"),bytesToUuid=_dereq_("./lib/bytesToUuid"),_seedBytes=rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0;module.exports=v1},{"./lib/bytesToUuid":56,"./lib/rng":57}],59:[function(_dereq_,module,exports){function v4(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"==options?new Array(16):null,options=null),options=options||{};var rnds=options.random||(options.rng||rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;ii<16;++ii)buf[i+ii]=rnds[ii];return buf||bytesToUuid(rnds)}var rng=_dereq_("./lib/rng"),bytesToUuid=_dereq_("./lib/bytesToUuid");module.exports=v4},{"./lib/bytesToUuid":56,"./lib/rng":57}],60:[function(_dereq_,module,exports){function parseConstructorArguments(args){var argv,options,sprintf_args,shortmessage,k;if(mod_assertplus.object(args,"args"),mod_assertplus.bool(args.strict,"args.strict"),mod_assertplus.array(args.argv,"args.argv"),argv=args.argv,0===argv.length)options={},sprintf_args=[];else if(mod_isError(argv[0]))options={cause:argv[0]},sprintf_args=argv.slice(1);else if("object"==typeof argv[0]){options={};for(k in argv[0])options[k]=argv[0][k];sprintf_args=argv.slice(1)}else mod_assertplus.string(argv[0],"first argument to VError, SError, or WError constructor must be a string, object, or Error"),options={},sprintf_args=argv;return mod_assertplus.object(options),options.strict||args.strict||(sprintf_args=sprintf_args.map(function(a){return null===a?"null":void 0===a?"undefined":a})),shortmessage=0===sprintf_args.length?"":sprintf.apply(null,sprintf_args),{options:options,shortmessage:shortmessage}}function VError(){var args,obj,parsed,cause,ctor,message,k;if(args=Array.prototype.slice.call(arguments,0),!(this instanceof VError))return obj=Object.create(VError.prototype),VError.apply(obj,arguments),obj;if(parsed=parseConstructorArguments({argv:args,strict:!1}),parsed.options.name&&(mod_assertplus.string(parsed.options.name,'error\'s "name" must be a string'),this.name=parsed.options.name),this.jse_shortmsg=parsed.shortmessage,message=parsed.shortmessage,cause=parsed.options.cause,cause&&(mod_assertplus.ok(mod_isError(cause),"cause is not an Error"),this.jse_cause=cause,parsed.options.skipCauseMessage||(message+=": "+cause.message)),this.jse_info={},parsed.options.info)for(k in parsed.options.info)this.jse_info[k]=parsed.options.info[k];return this.message=message,Error.call(this,message),Error.captureStackTrace&&(ctor=parsed.options.constructorOpt||this.constructor,Error.captureStackTrace(this,ctor)),this}function SError(){var args,obj,parsed,options;return args=Array.prototype.slice.call(arguments,0),this instanceof SError?(parsed=parseConstructorArguments({argv:args,strict:!0}),options=parsed.options,VError.call(this,options,"%s",parsed.shortmessage),this):(obj=Object.create(SError.prototype),SError.apply(obj,arguments),obj)}function MultiError(errors){mod_assertplus.array(errors,"list of errors"),mod_assertplus.ok(errors.length>0,"must be at least one error"),this.ase_errors=errors,VError.call(this,{cause:errors[0]},"first of %d error%s",errors.length,1==errors.length?"":"s")}function WError(){var args,obj,parsed,options;return args=Array.prototype.slice.call(arguments,0),this instanceof WError?(parsed=parseConstructorArguments({argv:args,strict:!1}),options=parsed.options,options.skipCauseMessage=!0,VError.call(this,options,"%s",parsed.shortmessage),this):(obj=Object.create(WError.prototype),WError.apply(obj,args),obj)}var mod_assertplus=_dereq_("assert-plus"),mod_util=_dereq_("util"),mod_extsprintf=_dereq_("extsprintf"),mod_isError=_dereq_("core-util-is").isError,sprintf=mod_extsprintf.sprintf;module.exports=VError,VError.VError=VError,VError.SError=SError,VError.WError=WError,VError.MultiError=MultiError,mod_util.inherits(VError,Error),VError.prototype.name="VError",VError.prototype.toString=function(){var str=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(str+=": "+this.message),str},VError.prototype.cause=function(){var cause=VError.cause(this);return null===cause?void 0:cause},VError.cause=function(err){return mod_assertplus.ok(mod_isError(err),"err must be an Error"),mod_isError(err.jse_cause)?err.jse_cause:null},VError.info=function(err){var rv,cause,k;if(mod_assertplus.ok(mod_isError(err),"err must be an Error"),cause=VError.cause(err),rv=null!==cause?VError.info(cause):{},"object"==typeof err.jse_info&&null!==err.jse_info)for(k in err.jse_info)rv[k]=err.jse_info[k];return rv},VError.findCauseByName=function(err,name){var cause;for(mod_assertplus.ok(mod_isError(err),"err must be an Error"),mod_assertplus.string(name,"name"),mod_assertplus.ok(name.length>0,"name cannot be empty"),cause=err;null!==cause;cause=VError.cause(cause))if(mod_assertplus.ok(mod_isError(cause)),cause.name==name)return cause;return null},VError.hasCauseWithName=function(err,name){return null!==VError.findCauseByName(err,name)},VError.fullStack=function(err){mod_assertplus.ok(mod_isError(err),"err must be an Error");var cause=VError.cause(err);return cause?err.stack+"\ncaused by: "+VError.fullStack(cause):err.stack},VError.errorFromList=function(errors){return mod_assertplus.arrayOfObject(errors,"errors"),0===errors.length?null:(errors.forEach(function(e){mod_assertplus.ok(mod_isError(e))}),1==errors.length?errors[0]:new MultiError(errors))},VError.errorForEach=function(err,func){mod_assertplus.ok(mod_isError(err),"err must be an Error"),mod_assertplus.func(func,"func"),err instanceof MultiError?err.errors().forEach(function(e){func(e)}):func(err)},mod_util.inherits(SError,VError),mod_util.inherits(MultiError,VError),MultiError.prototype.name="MultiError",MultiError.prototype.errors=function(){return this.ase_errors.slice(0)},mod_util.inherits(WError,VError),WError.prototype.name="WError",WError.prototype.toString=function(){var str=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(str+=": "+this.message),this.jse_cause&&this.jse_cause.message&&(str+="; caused by "+this.jse_cause.toString()),str},WError.prototype.cause=function(c){return mod_isError(c)&&(this.jse_cause=c),this.jse_cause}},{"assert-plus":1,"core-util-is":26,extsprintf:29,util:54}],61:[function(_dereq_,module,exports){module.exports={version:"2.0.1"}},{}],62:[function(_dereq_,module,exports){function createIntermediateIframeForLogin(runtimeOrigin,completionOrigin){var frame=document.createElement("iframe");return frame.name="zumo-login-receiver",frame.src=runtimeOrigin+"/.auth/login/iframereceiver?completion_origin="+encodeURIComponent(completionOrigin),frame.setAttribute("width",0),frame.setAttribute("height",0),frame.style.display="none",document.body.appendChild(frame),frame}var PostMessageExchange=_dereq_("../Utilities/PostMessageExchange");exports.supportsCurrentRuntime=function(){return!0},exports.login=function(startUri,endUri,callback){var completionOrigin=PostMessageExchange.getOriginRoot(window.location.href),runtimeOrigin=PostMessageExchange.getOriginRoot(startUri),useIntermediateIframe=window.navigator.userAgent.indexOf("MSIE")>=0||window.navigator.userAgent.indexOf("Trident")>=0,intermediateIframe=useIntermediateIframe&&createIntermediateIframeForLogin(runtimeOrigin,completionOrigin),completionType=useIntermediateIframe?"iframe":"postMessage";if(startUri+=-1==startUri.indexOf("?")?"?":"&",startUri+="completion_type="+completionType+"&completion_origin="+encodeURIComponent(completionOrigin),!completionOrigin||0!==completionOrigin.indexOf("http:")&&0!==completionOrigin.indexOf("https:")){return void callback("Login is only supported from http:// or https:// URLs. Please host your page in a web server.",null)}var loginWindow=window.open(startUri,"_blank","location=no,resizable=yes"),complete=function(errorValue,oauthValue){window.clearInterval(checkForWindowClosedInterval),loginWindow.close(),window.removeEventListener?window.removeEventListener("message",handlePostMessage):window.detachEvent("onmessage",handlePostMessage),intermediateIframe&&intermediateIframe.parentNode.removeChild(intermediateIframe),callback(errorValue,oauthValue)},handlePostMessage=function(evt){var expectedSource=useIntermediateIframe?intermediateIframe.contentWindow:loginWindow;if(evt.source===expectedSource){var envelope;try{envelope="string"==typeof evt.data?JSON.parse(evt.data):evt.data}catch(ex){return}envelope&&"LoginCompleted"===envelope.type&&(envelope.oauth||envelope.error)&&complete(envelope.error,envelope.oauth)}},checkForWindowClosedInterval=window.setInterval(function(){loginWindow&&!0===loginWindow.closed&&complete(new Error("canceled"),null)},250);return window.addEventListener?window.addEventListener("message",handlePostMessage,!1):window.attachEvent("onmessage",handlePostMessage),{cancelCallback:function(){return complete(new Error("canceled"),null),!0}}}},{"../Utilities/PostMessageExchange":83}],63:[function(_dereq_,module,exports){function isRunUnderRippleEmulator(){return window.parent&&!!window.parent.ripple}function currentCordovaVersion(){return window.cordova&&window.cordova.version}function isSupportedCordovaVersion(version){var versionParts=currentCordovaVersion().match(/^(\d+).(\d+)./);if(versionParts){var major=Number(versionParts[1]),minor=Number(versionParts[2]),required=requiredCordovaVersion;return major>required.major||major===required.major&&minor>=required.minor}return!1}function hasInAppBrowser(){return!window.open}function parseOAuthResultFromDoneUrl(url){var successMessage=extractMessageFromUrl(url,"#token="),errorMessage=extractMessageFromUrl(url,"#error=");return{oAuthToken:successMessage?JSON.parse(successMessage):null,error:errorMessage?new Error(errorMessage):null}}function extractMessageFromUrl(url,separator){var pos=url.indexOf(separator);return pos<0?null:decodeURIComponent(url.substring(pos+separator.length))}function getSpinnerMarkup(){for(var vendorPrefix=("webkitTransform"in document.documentElement.style?"-webkit-":""),numSpokes=12,spokesMarkup="",i=0;i<numSpokes;i++)spokesMarkup+="<div style='-prefix-transform: rotateZ("+(180+360*i/numSpokes)+"deg);-prefix-animation-delay: "+.75*i/numSpokes+"s;'></div>";return["<!DOCTYPE html><html>","<head><meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1'></head>","<body><div id='spinner'>"+spokesMarkup+"</div>","<style type='text/css'>","    #spinner { position: absolute; top: 50%; left: 50%; -prefix-animation: spinner 10s linear infinite; }","    #spinner > div {","        background: #333; opacity: 0; position: absolute; top: 11px; left: -2px; width: 4px; height: 21px; border-radius: 2px;","        -prefix-transform-origin: 50% -11px; -prefix-animation: spinner-spoke 0.75s linear infinite;","    }","    @-prefix-keyframes spinner { 0% { -prefix-transform: rotateZ(0deg); } 100% { -prefix-transform: rotateZ(-360deg); } }","    @-prefix-keyframes spinner-spoke { 0% { opacity: 0; } 5% { opacity: 1; } 70% { opacity: 0; } 100% { opacity: 0; } }","</style>","</body></html>"].join("").replace(/-prefix-/g,vendorPrefix)}var requiredCordovaVersion={major:3,minor:0};exports.supportsCurrentRuntime=function(){return!!currentCordovaVersion()&&!isRunUnderRippleEmulator()},exports.login=function(startUri,endUri,callback){var message,foundCordovaVersion=currentCordovaVersion();if(!isSupportedCordovaVersion(foundCordovaVersion))throw message="Not a supported version of Cordova. Detected: "+foundCordovaVersion+". Required: "+requiredCordovaVersion.major+"."+requiredCordovaVersion.minor,new Error(message);if(!hasInAppBrowser)throw message='A required plugin: "org.apache.cordova.inappbrowser" was not detected.',new Error(message);var redirectionScript="<script>location.href = unescape('"+window.escape(startUri)+"')<\/script>",startPage="data:text/html,"+encodeURIComponent(getSpinnerMarkup()+redirectionScript);setTimeout(function(){var loginWindow=window.open(startPage,"_blank","location=no,hardwareback=no"),flowHasFinished=!1,loadEventHandler=function(evt){if(!flowHasFinished&&0===evt.url.indexOf(endUri)){flowHasFinished=!0,setTimeout(function(){loginWindow.close()},500);var result=parseOAuthResultFromDoneUrl(evt.url);callback(result.error,result.oAuthToken)}};loginWindow.addEventListener("loadstart",loadEventHandler),loginWindow.addEventListener("loadstop",loadEventHandler),loginWindow.addEventListener("exit",function(evt){flowHasFinished||(flowHasFinished=!0,callback(new Error("UserCancelled"),null))})},500)}},{}],64:[function(_dereq_,module,exports){function isWebAuthBrokerAvailable(){return!!(window.Windows&&window.Windows.Security&&window.Windows.Security.Authentication&&window.Windows.Security.Authentication.Web&&window.Windows.Security.Authentication.Web.WebAuthenticationBroker)}var _=_dereq_("../Utilities/Extensions");exports.supportsCurrentRuntime=function(){return isWebAuthBrokerAvailable()},exports.login=function(startUri,endUri,callback){var windowsWebAuthBroker=Windows.Security.Authentication.Web.WebAuthenticationBroker,noneWebAuthOptions=Windows.Security.Authentication.Web.WebAuthenticationOptions.none,successWebAuthStatus=Windows.Security.Authentication.Web.WebAuthenticationStatus.success,activationKindWebAuthContinuation=Windows.ApplicationModel.Activation.ActivationKind.webAuthenticationBrokerContinuation,webAuthBrokerSuccessCallback=null,webAuthBrokerErrorCallback=null,webAuthBrokerContinuationCallback=null;if(webAuthBrokerSuccessCallback=function(result){var error=null,token=null;if(result.responseStatus!==successWebAuthStatus)error=result;else{var callbackEndUri=result.responseData,tokenAsJson=null,i=callbackEndUri.indexOf("#token=");if(i>0?tokenAsJson=decodeURIComponent(callbackEndUri.substring(i+7)):(i=callbackEndUri.indexOf("#error="))>0&&(error=new Error(decodeURIComponent(callbackEndUri.substring(i+7)))),null!==tokenAsJson)try{token=JSON.parse(tokenAsJson)}catch(e){error=e}}callback(error,token)},webAuthBrokerErrorCallback=function(error){callback(error,null)},webAuthBrokerContinuationCallback=function(activationArgs){if(activationArgs.detail.kind===activationKindWebAuthContinuation){var result=activationArgs.detail.webAuthenticationResult;result.responseStatus==successWebAuthStatus?webAuthBrokerSuccessCallback(result):webAuthBrokerErrorCallback(result),WinJS.Application.removeEventListener("activated",webAuthBrokerContinuationCallback)}},endUri)endUri=new Windows.Foundation.Uri(endUri);else{var ssoQueryParameter={},redirectUri=windowsWebAuthBroker.getCurrentApplicationCallbackUri().absoluteUri;ssoQueryParameter.post_login_redirect_url=redirectUri,startUri=_.url.combinePathAndQuery(startUri,_.url.getQueryString(ssoQueryParameter))}startUri=new Windows.Foundation.Uri(startUri);var isLoginWindowLaunched;try{WinJS.Application.addEventListener("activated",webAuthBrokerContinuationCallback,!0),windowsWebAuthBroker.authenticateAndContinue(startUri,endUri),isLoginWindowLaunched=!0}catch(ex){WinJS.Application.removeEventListener("activated",webAuthBrokerContinuationCallback)}isLoginWindowLaunched||windowsWebAuthBroker.authenticateAsync(noneWebAuthOptions,startUri,endUri).done(webAuthBrokerSuccessCallback,webAuthBrokerErrorCallback)}},{"../Utilities/Extensions":82}],65:[function(_dereq_,module,exports){function MobileServiceClient(applicationUrl){Validate.isString(applicationUrl,"applicationUrl"),Validate.notNullOrEmpty(applicationUrl,"applicationUrl"),this.applicationUrl=applicationUrl;var sdkInfo=Platform.getSdkInfo(),osInfo=Platform.getOperatingSystemInfo(),sdkVersion=sdkInfo.fileVersion.split(".").slice(0,2).join(".");this.version="ZUMO/"+sdkVersion+" (lang="+sdkInfo.language+"; os="+osInfo.name+"; os_version="+osInfo.version+"; arch="+osInfo.architecture+"; version="+sdkInfo.fileVersion+")",this.currentUser=null,this._serviceFilter=null,this._login=new MobileServiceLogin(this);var _syncContext=new MobileServiceSyncContext(this);this.getSyncContext=function(){return _syncContext},this.getTable=function(tableName){
return Validate.isString(tableName,"tableName"),Validate.notNullOrEmpty(tableName,"tableName"),new MobileServiceTable(tableName,this)},this.getSyncTable=function(tableName){return Validate.isString(tableName,"tableName"),Validate.notNullOrEmpty(tableName,"tableName"),new MobileServiceSyncTable(tableName,this)},Push&&(this.push=new Push(this,MobileServiceClient._applicationInstallationId))}function getApplicationInstallationId(){var applicationInstallationId=null,path="MobileServices.Installation.config",contents=Platform.readSetting(path);if(!_.isNull(contents))try{applicationInstallationId=_.fromJson(contents).applicationInstallationId}catch(ex){}if(_.isNullOrEmpty(applicationInstallationId)){applicationInstallationId=_.createUniqueInstallationId();var configText=_.toJson({applicationInstallationId:applicationInstallationId});Platform.writeSetting(path,configText)}return applicationInstallationId}var Push,_=_dereq_("./Utilities/Extensions"),constants=_dereq_("./constants"),Validate=_dereq_("./Utilities/Validate"),Platform=_dereq_("./Platform"),MobileServiceSyncContext=_dereq_("./sync/MobileServiceSyncContext"),MobileServiceSyncTable=_dereq_("./sync/MobileServiceSyncTable").MobileServiceSyncTable,MobileServiceTable=_dereq_("./MobileServiceTable"),MobileServiceLogin=_dereq_("./MobileServiceLogin");try{Push=_dereq_("./Push/Push").Push}catch(e){}Object.defineProperties(MobileServiceClient.prototype,{alternateLoginHost:{get:function(){return this._alternateLoginHost},set:function(value){if(_.isNullOrEmpty(value))this._alternateLoginHost=this.applicationUrl;else{if(!_.url.isAbsoluteUrl(value)||!_.url.isHttps(value))throw new Error(value+" is not valid. Expected Absolute Url with https scheme");this._alternateLoginHost=value}}}});Object.defineProperties(MobileServiceClient.prototype,{loginUriPrefix:{get:function(){return this._loginUriPrefix},set:function(value){_.isNullOrEmpty(value)?this._loginUriPrefix=".auth/login":(_.isString(value),this._loginUriPrefix=value)}}}),MobileServiceClient.prototype.withFilter=function(serviceFilter){Validate.notNull(serviceFilter,"serviceFilter");var client=new MobileServiceClient(this.applicationUrl);client.currentUser=this.currentUser;var existingFilter=this._serviceFilter;return client._serviceFilter=_.isNull(existingFilter)?serviceFilter:function(req,next,callback){serviceFilter(req,function(req,callback){existingFilter(req,next,callback)},callback)},client},MobileServiceClient.prototype._request=function(method,uriFragment,content,ignoreFilters,headers,features,callback){_.isNull(callback)&&"function"==typeof features&&(callback=features,features=null),_.isNull(callback)&&"function"==typeof headers&&(callback=headers,headers=null),_.isNull(callback)&&"function"==typeof ignoreFilters&&(callback=ignoreFilters,ignoreFilters=!1),_.isNull(callback)&&"function"==typeof content&&(callback=content,content=null),Validate.isString(method,"method"),Validate.notNullOrEmpty(method,"method"),Validate.isString(uriFragment,"uriFragment"),Validate.notNull(uriFragment,"uriFragment"),Validate.notNull(callback,"callback");var options={type:method.toUpperCase()};_.url.isAbsoluteUrl(uriFragment)?options.url=uriFragment:options.url=_.url.combinePathSegments(this.applicationUrl,uriFragment),options.headers={},_.isNull(headers)||_.extend(options.headers,headers),options.headers["X-ZUMO-INSTALLATION-ID"]=MobileServiceClient._applicationInstallationId,this.currentUser&&!_.isNullOrEmpty(this.currentUser.mobileServiceAuthenticationToken)&&(options.headers["X-ZUMO-AUTH"]=this.currentUser.mobileServiceAuthenticationToken),_.isNull(MobileServiceClient._userAgent)||(options.headers["User-Agent"]=MobileServiceClient._userAgent),_.isNullOrEmpty["X-ZUMO-VERSION"]||(options.headers["X-ZUMO-VERSION"]=this.version),_.isNull(options.headers[constants.featuresHeaderName])&&features&&features.length&&(options.headers[constants.featuresHeaderName]=features.join(",")),_.isNull(content)?options.data=null:(_.isString(content)?options.data=content:options.data=_.toJson(content),_.hasProperty(options.headers,["Content-Type","content-type","CONTENT-TYPE","Content-type"])||(options.headers["Content-Type"]="application/json"));var handler=function(error,response){_.isNull(error)?!_.isNull(response)&&(response.status>=400||0===response.status)&&(error=_.createError(null,response),response=null):error=_.createError(error),callback(error,response)};_.isNull(this._serviceFilter)||ignoreFilters?Platform.webRequest(options,handler):this._serviceFilter(options,Platform.webRequest,handler)},MobileServiceClient.prototype.loginWithOptions=Platform.async(function(provider,options,callback){this._login.loginWithOptions(provider,options,callback)}),MobileServiceClient.prototype.login=Platform.async(function(provider,token,useSingleSignOn,callback){this._login.login(provider,token,useSingleSignOn,callback)}),MobileServiceClient.prototype.logout=Platform.async(function(callback){this.currentUser=null,callback()}),MobileServiceClient.prototype.invokeApi=Platform.async(function(apiName,options,callback){Validate.isString(apiName,"apiName"),_.isNull(callback)&&"function"==typeof options&&(callback=options,options=null),Validate.notNull(callback,"callback");var parameters,method,body,headers;_.isNull(options)||(parameters=options.parameters,_.isNull(parameters)||Validate.isValidParametersObject(options.parameters),method=options.method,body=options.body,headers=options.headers),headers=headers||{},_.isNull(method)&&(method="POST"),_.isNull(headers.accept)&&(headers.accept="application/json"),_.isNull(headers[constants.apiVersionHeaderName])&&(headers[constants.apiVersionHeaderName]=constants.apiVersion);var url;if(url=_.url.isAbsoluteUrl(apiName)?apiName:_.url.combinePathSegments("api",apiName),!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);url=_.url.combinePathAndQuery(url,queryString)}var features=[];_.isNullOrEmpty(body)||features.push(_.isString(body)?constants.features.GenericApiCall:constants.features.JsonApiCall),_.isNull(parameters)||features.push(constants.features.AdditionalQueryParameters),this._request(method,url,body,null,headers,features,function(error,response){if(_.isNull(error)){var contentType;if(void 0!==response.getResponseHeader&&(contentType=response.getResponseHeader("Content-Type")),contentType)-1!==contentType.toLowerCase().indexOf("json")&&(response.result=_.fromJson(response.responseText));else try{response.result=_.fromJson(response.responseText)}catch(e){}callback(null,response)}else callback(error,null)})}),MobileServiceClient._applicationInstallationId=getApplicationInstallationId(),MobileServiceClient._userAgent=Platform.getUserAgent(),module.exports=MobileServiceClient},{"./MobileServiceLogin":66,"./MobileServiceTable":67,"./Platform":75,"./Push/Push":79,"./Utilities/Extensions":82,"./Utilities/Validate":85,"./constants":87,"./sync/MobileServiceSyncContext":91,"./sync/MobileServiceSyncTable":92}],66:[function(_dereq_,module,exports){function MobileServiceLogin(client,ignoreFilters){_.isNull(ignoreFilters)&&(ignoreFilters=!0),Validate.notNull(client),Validate.isObject(client,"client"),this._loginState={inProcess:!1,cancelCallback:null},this.ignoreFilters=ignoreFilters,this.getMobileServiceClient=function(){return client},this.getLoginInProcess=function(){return this._loginState.inProcess}}function onLoginComplete(error,token,client,callback){var user=null;_.isNull(error)&&(!_.isNull(token)&&_.isObject(token)&&_.isObject(token.user)&&_.isString(token.authenticationToken)?(client.currentUser=token.user,client.currentUser.mobileServiceAuthenticationToken=token.authenticationToken,user=client.currentUser):error=Platform.getResourceString("MobileServiceLogin_InvalidResponseFormat")),_.isNull(callback)||callback(error,user)}function onLoginResponse(error,response,client,callback){var mobileServiceToken=null;if(_.isNull(error))try{mobileServiceToken=_.fromJson(response.responseText)}catch(e){error=e}onLoginComplete(error,mobileServiceToken,client,callback)}function loginWithProviderAndToken(login,provider,token,parameters,callback){var client=login.getMobileServiceClient();login._loginState={inProcess:!0,cancelCallback:null};var url=_.url.combinePathSegments(client.alternateLoginHost||client.applicationUrl,client.loginUriPrefix||loginUrl,provider);if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);url=_.url.combinePathAndQuery(url,queryString)}client._request("POST",url,token,login.ignoreFilters,function(error,response){login._loginState={inProcess:!1,cancelCallback:null},onLoginResponse(error,response,client,callback)})}function loginWithLoginControl(login,provider,useSingleSignOn,parameters,callback){var key,client=login.getMobileServiceClient(),startUri=_.url.combinePathSegments(client.alternateLoginHost||client.applicationUrl,client.loginUriPrefix||loginUrl,provider),endUri=null,queryParams={};for(key in parameters)queryParams[key]=parameters[key];queryParams[sessionModeKey]=sessionModeValueToken;var queryString=_.url.getQueryString(queryParams);startUri=_.url.combinePathAndQuery(startUri,queryString),useSingleSignOn||(endUri=_.url.combinePathSegments(client.alternateLoginHost||client.applicationUrl,client.loginUriPrefix||loginUrl,loginDone)),login._loginState={inProcess:!0,cancelCallback:null};var platformResult=Platform.login(startUri,endUri,function(error,mobileServiceToken){login._loginState={inProcess:!1,cancelCallback:null},onLoginComplete(error,mobileServiceToken,client,callback)});login._loginState.inProcess&&platformResult&&platformResult.cancelCallback&&(login._loginState.cancelCallback=platformResult.cancelCallback)}var _=_dereq_("./Utilities/Extensions"),Validate=_dereq_("./Utilities/Validate"),Platform=_dereq_("./Platform"),loginUrl=".auth/login",loginDone="done",sessionModeKey="session_mode",sessionModeValueToken="token";MobileServiceLogin.prototype.loginWithOptions=function(provider,options,callback){Validate.isString(provider,"provider"),Validate.notNull(provider,"provider"),_.isNull(callback)&&(_.isNull(options)||"function"!=typeof options?Validate.notNull(null,"callback"):(callback=options,options=null)),!options&&this._isAuthToken(provider)?this.loginWithMobileServiceToken(provider,callback):(options=options||{},this.loginWithProvider(provider,options.token,options.useSingleSignOn,options.parameters,callback))},MobileServiceLogin.prototype.login=function(provider,token,useSingleSignOn,callback){_.isNull(callback)&&(_.isNull(useSingleSignOn)||"function"!=typeof useSingleSignOn?_.isNull(token)||"function"!=typeof token||(callback=token,useSingleSignOn=null,token=null):(callback=useSingleSignOn,useSingleSignOn=null)),_.isNull(useSingleSignOn)&&(_.isBool(token)?(useSingleSignOn=token,token=null):useSingleSignOn=!1),_.isNull(token)&&this._isAuthToken(provider)&&(token=provider,provider=null),_.isNull(provider)&&(Validate.notNull(token),Validate.isString(token)),_.isNull(token)&&(Validate.notNull(provider),Validate.isString(provider),provider=provider.toLowerCase()),_.isNull(provider)?this.loginWithMobileServiceToken(token,callback):("windowsazureactivedirectory"===provider.toLowerCase()&&(provider="aad"),this.loginWithProvider(provider,token,useSingleSignOn,{},callback))},MobileServiceLogin.prototype._isAuthToken=function(value){return value&&_.isString(value)&&3===value.split(".").length},MobileServiceLogin.prototype.loginWithMobileServiceToken=function(authenticationToken,callback){var self=this,client=self.getMobileServiceClient();Validate.isString(authenticationToken,"authenticationToken"),Validate.notNullOrEmpty(authenticationToken,"authenticationToken"),client._request("POST",loginUrl,{authenticationToken:authenticationToken},self.ignoreFilters,function(error,response){onLoginResponse(error,response,client,callback)})},MobileServiceLogin.prototype.loginWithProvider=function(provider,token,useSingleSignOn,parameters,callback){if(Validate.isString(provider,"provider"),_.isNull(token)||Validate.isObject(token,"token"),this._loginState.inProcess){if(!(this._loginState.cancelCallback&&this._loginState.cancelCallback()))throw new Error("Cannot start a login operation because login is already in progress.")}provider=provider.toLowerCase(),_.isNull(token)?loginWithLoginControl(this,provider,useSingleSignOn,parameters,callback):loginWithProviderAndToken(this,provider,token,parameters,callback)},module.exports=MobileServiceLogin},{"./Platform":75,"./Utilities/Extensions":82,"./Utilities/Validate":85}],67:[function(_dereq_,module,exports){function MobileServiceTable(tableName,client){this.getTableName=function(){return tableName},this.getMobileServiceClient=function(){return client},this._features=void 0}function removeSystemProperties(instance){var copy={};for(var property in instance)property!=MobileServiceSystemColumns.Version&&property!=MobileServiceSystemColumns.UpdatedAt&&property!=MobileServiceSystemColumns.CreatedAt&&property!=MobileServiceSystemColumns.Deleted&&(copy[property]=instance[property]);return copy}function getItemFromResponse(response){var result=_.fromJson(response.responseText);if(response.getResponseHeader){var eTag=response.getResponseHeader("ETag");_.isNullOrEmpty(eTag)||(result[MobileServiceSystemColumns.Version]=getVersionFromEtag(eTag))}return result}function setServerItemIfPreconditionFailed(error){error.request&&412===error.request.status&&(error.serverInstance=_.fromJson(error.request.responseText))}function getEtagFromVersion(version){return'"'+version.replace(/\"/g,'\\"')+'"'}function getVersionFromEtag(etag){var len=etag.length,result=etag;return len>1&&'"'===etag[0]&&'"'===etag[len-1]&&(result=etag.substr(1,len-2)),result.replace(/\\\"/g,'"')}function addQueryParametersFeaturesIfApplicable(features,userQueryParameters){var hasQueryParameters=!1;if(userQueryParameters)if(Array.isArray(userQueryParameters))hasQueryParameters=userQueryParameters.length>0;else if(_.isObject(userQueryParameters))for(var k in userQueryParameters){hasQueryParameters=!0;break}return hasQueryParameters&&features.push(constants.features.AdditionalQueryParameters),features}var _=_dereq_("./Utilities/Extensions"),Validate=_dereq_("./Utilities/Validate"),Platform=_dereq_("./Platform"),constants=(_dereq_("azure-query-js").Query,_dereq_("./constants")),tableHelper=_dereq_("./tableHelper"),idPropertyName="id",tableRouteSeperatorName="tables",idNames=["ID","Id","id","iD"],nextLinkRegex=/^(.*?);\s*rel\s*=\s*(\w+)\s*$/,SystemProperties={None:0,CreatedAt:1,UpdatedAt:2,Version:4,All:65535},MobileServiceSystemColumns={CreatedAt:"createdAt",UpdatedAt:"updatedAt",Version:"version",Deleted:"deleted"};MobileServiceTable.SystemProperties=SystemProperties,MobileServiceTable.prototype._read=function(query,parameters,callback){_.isNull(callback)&&(_.isNull(parameters)&&"function"==typeof query?(callback=query,query=null,parameters=null):"function"==typeof parameters&&(callback=parameters,parameters=null,!_.isNull(query)&&_.isObject(query)&&!_.isString(query)&&_.isNull(query.toOData)&&(parameters=query,query=null))),query&&_.isString(query)&&Validate.notNullOrEmpty(query,"query"),_.isNull(parameters)||Validate.isValidParametersObject(parameters,"parameters"),Validate.notNull(callback,"callback");var tableName=this.getTableName(),queryString=null,projection=null,features=this._features||[];if(_.isString(query))queryString=query,_.isNullOrEmpty(query)||features.push(constants.features.TableReadRaw);else if(_.isObject(query)&&!_.isNull(query.toOData)&&query.getComponents){features.push(constants.features.TableReadQuery);var components=query.getComponents();if(projection=components.projection,components.table){if(tableName!==components.table){var message=_.format(Platform.getResourceString("MobileServiceTable_ReadMismatchedQueryTables"),tableName,components.table);return void callback(new Error(message),null)}var oDataQuery=query.toOData();queryString=oDataQuery.replace(new RegExp("^/"+components.table),"")}}if(addQueryParametersFeaturesIfApplicable(features,parameters),!_.isNull(parameters)){var userDefinedQueryString=_.url.getQueryString(parameters);_.isNullOrEmpty(queryString)?queryString=userDefinedQueryString:queryString+="&"+userDefinedQueryString}var urlFragment=queryString;_.url.isAbsoluteUrl(urlFragment)||(urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,tableName),_.isNull(queryString)||(urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)));var headers={};headers[constants.apiVersionHeaderName]=constants.apiVersion,this.getMobileServiceClient()._request("GET",urlFragment,null,!1,headers,features,function(error,response){var values=null;if(_.isNull(error)){if(values=_.fromJson(response.responseText),values&&!Array.isArray(values)&&void 0!==values.count&&void 0!==values.results&&(values.results.totalCount=values.count,values=values.results),null!==projection){var i=0;for(i=0;i<values.length;i++)values[i]=projection.call(values[i])}if(Array.isArray(values)&&response.getResponseHeader&&_.isNull(values.nextLink))try{var link=response.getResponseHeader("Link");if(!_.isNullOrEmpty(link)){var result=nextLinkRegex.exec(link);result&&3===result.length&&"next"==result[2]&&(values.nextLink=result[1])}}catch(ex){}}callback(error,values)})},MobileServiceTable.prototype.read=Platform.async(MobileServiceTable.prototype._read),MobileServiceTable.prototype.insert=Platform.async(function(instance,parameters,callback){_.isNull(callback)&&"function"==typeof parameters&&(callback=parameters,parameters=null),Validate.notNull(instance,"instance"),_.isNull(parameters)||Validate.isValidParametersObject(parameters),Validate.notNull(callback,"callback");for(var i in idNames){var id=instance[idNames[i]];if(!_.isNullOrZero(id)){if(!_.isString(id))throw new Error("Cannot insert if the "+idPropertyName+" member is already set.");if(idNames[i]!==idPropertyName)throw new Error("Cannot insert if the "+idPropertyName+" member is already set.");Validate.isValidId(id,idPropertyName)}}var features=this._features||[];features=addQueryParametersFeaturesIfApplicable(features,parameters);var urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,this.getTableName());if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}var headers={};headers[constants.apiVersionHeaderName]=constants.apiVersion,this.getMobileServiceClient()._request("POST",urlFragment,instance,!1,headers,features,function(error,response){if(_.isNull(error)){var result=getItemFromResponse(response);result=Platform.allowPlatformToMutateOriginal(instance,result),callback(null,result)}else callback(error,null)})}),MobileServiceTable.prototype.update=Platform.async(function(instance,parameters,callback){var version,serverInstance,headers={},features=this._features||[];_.isNull(callback)&&"function"==typeof parameters&&(callback=parameters,parameters=null),Validate.notNull(instance,"instance"),Validate.isValidId(instance[idPropertyName],"instance."+idPropertyName),_.isNull(parameters)||Validate.isValidParametersObject(parameters,"parameters"),Validate.notNull(callback,"callback"),version=instance[MobileServiceSystemColumns.Version],serverInstance=removeSystemProperties(instance),_.isNullOrEmpty(version)||(headers["If-Match"]=getEtagFromVersion(version),features.push(constants.features.OptimisticConcurrency)),headers[constants.apiVersionHeaderName]=constants.apiVersion,features=addQueryParametersFeaturesIfApplicable(features,parameters);var urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,this.getTableName(),encodeURIComponent(instance[idPropertyName].toString()));if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}this.getMobileServiceClient()._request("PATCH",urlFragment,serverInstance,!1,headers,features,function(error,response){if(_.isNull(error)){var result=getItemFromResponse(response);result=Platform.allowPlatformToMutateOriginal(instance,result),callback(null,result)}else setServerItemIfPreconditionFailed(error),callback(error)})}),MobileServiceTable.prototype.refresh=Platform.async(function(instance,parameters,callback){if(_.isNull(callback)&&"function"==typeof parameters&&(callback=parameters,parameters=null),Validate.notNull(instance,"instance"),!_.isValidId(instance[idPropertyName],idPropertyName)){if("string"==typeof instance[idPropertyName]&&""!==instance[idPropertyName])throw new Error(idPropertyName+' "'+instance[idPropertyName]+'" is not valid.');return void callback(null,instance)}_.isNull(parameters)||Validate.isValidParametersObject(parameters,"parameters"),Validate.notNull(callback,"callback");var urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,this.getTableName());if("string"==typeof instance[idPropertyName]){var id=encodeURIComponent(instance[idPropertyName]).replace(/\'/g,"%27%27");urlFragment=_.url.combinePathAndQuery(urlFragment,"?$filter=id eq '"+id+"'")}else urlFragment=_.url.combinePathAndQuery(urlFragment,"?$filter=id eq "+encodeURIComponent(instance[idPropertyName].toString()));if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}var features=this._features||[];features.push(constants.features.TableRefreshCall),features=addQueryParametersFeaturesIfApplicable(features,parameters);var headers={};headers[constants.apiVersionHeaderName]=constants.apiVersion,this.getMobileServiceClient()._request("GET",urlFragment,instance,!1,headers,features,function(error,response){if(_.isNull(error)){var result=_.fromJson(response.responseText);if(Array.isArray(result)&&(result=result[0]),!result){var message=_.format(Platform.getResourceString("MobileServiceTable_NotSingleObject"),idPropertyName);callback(new Error(message),null)}result=Platform.allowPlatformToMutateOriginal(instance,result),callback(null,result)}else callback(error,null)})}),MobileServiceTable.prototype.lookup=Platform.async(function(id,parameters,callback){_.isNull(callback)&&"function"==typeof parameters&&(callback=parameters,parameters=null),Validate.isValidId(id,idPropertyName),_.isNull(parameters)||Validate.isValidParametersObject(parameters),Validate.notNull(callback,"callback");var urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,this.getTableName(),encodeURIComponent(id.toString())),features=this._features||[];if(features=addQueryParametersFeaturesIfApplicable(features,parameters),!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}var headers={};headers[constants.apiVersionHeaderName]=constants.apiVersion,this.getMobileServiceClient()._request("GET",urlFragment,null,!1,headers,features,function(error,response){if(_.isNull(error)){var result=getItemFromResponse(response);callback(null,result)}else callback(error,null)})}),MobileServiceTable.prototype.del=Platform.async(function(instance,parameters,callback){_.isNull(callback)&&"function"==typeof parameters&&(callback=parameters,parameters=null),Validate.notNull(instance,"instance"),Validate.isValidId(instance[idPropertyName],"instance."+idPropertyName),Validate.notNull(callback,"callback");var headers={},features=this._features||[];_.isString(instance[idPropertyName])&&(_.isNullOrEmpty(instance[MobileServiceSystemColumns.Version])||(headers["If-Match"]=getEtagFromVersion(instance[MobileServiceSystemColumns.Version]),features.push(constants.features.OptimisticConcurrency))),headers[constants.apiVersionHeaderName]=constants.apiVersion,features=addQueryParametersFeaturesIfApplicable(features,parameters),_.isNull(parameters)||Validate.isValidParametersObject(parameters);var urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,this.getTableName(),encodeURIComponent(instance[idPropertyName].toString()));if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}this.getMobileServiceClient()._request("DELETE",urlFragment,null,!1,headers,features,function(error,response){_.isNull(error)||setServerItemIfPreconditionFailed(error),callback(error)})}),tableHelper.defineQueryOperators(MobileServiceTable),module.exports=MobileServiceTable},{"./Platform":75,"./Utilities/Extensions":82,"./Utilities/Validate":85,"./constants":87,"./tableHelper":98,"azure-query-js":19}],68:[function(_dereq_,module,exports){function getSqlStatementsFromQuery(query){var odataQuery=Query.Providers.OData.toOData(query);return formatSql(odataQuery,{flavor:"sqlite"})}function getStatementParameters(statement){var params=[];return statement.parameters&&statement.parameters.forEach(function(param){params.push(sqliteSerializer.serializeValue(param.value))}),params}function createTable(transaction,tableDefinition){var columnDefinitions=tableDefinition.columnDefinitions,columnDefinitionClauses=[];for(var columnName in columnDefinitions){var columnType=storeHelper.getColumnType(columnDefinitions,columnName),columnDefinitionClause=_.format("[{0}] {1}",columnName,sqliteSerializer.getSqliteType(columnType));storeHelper.isId(columnName)&&(columnDefinitionClause+=" PRIMARY KEY"),columnDefinitionClauses.push(columnDefinitionClause)}var createTableStatement=_.format("CREATE TABLE [{0}] ({1})",tableDefinition.name,columnDefinitionClauses.join());transaction.executeSql(createTableStatement)}function addMissingColumns(transaction,tableDefinition,existingColumns){var columnDefinitions=tableDefinition.columnDefinitions;for(var columnName in columnDefinitions)if(!existingColumns[columnName.toLowerCase()]){var alterStatement=_.format("ALTER TABLE {0} ADD COLUMN {1} {2}",tableDefinition.name,columnName,storeHelper.getColumnType(columnDefinitions,columnName));transaction.executeSql(alterStatement)}}var Platform=_dereq_("."),Validate=_dereq_("../../Utilities/Validate"),_=_dereq_("../../Utilities/Extensions"),ColumnType=_dereq_("../../sync/ColumnType"),sqliteSerializer=_dereq_("./sqliteSerializer"),storeHelper=_dereq_("./storeHelper"),Query=_dereq_("azure-query-js").Query,formatSql=_dereq_("azure-odata-sql").format,taskRunner=_dereq_("../../Utilities/taskRunner"),idPropertyName="id",defaultDbName="mobileapps.db",MobileServiceSqliteStore=function(dbName){"use strict";if(!(this instanceof MobileServiceSqliteStore))return new MobileServiceSqliteStore(dbName);_.isNull(dbName)&&(dbName=defaultDbName);var tableDefinitions={},runner=taskRunner();this.init=function(){return runner.run(function(){return this._init()}.bind(this))},this._init=function(){var self=this;return Platform.async(function(callback){if(self._db)return callback();var db=window.sqlitePlugin.openDatabase({name:dbName,location:"default"},function(){self._db=db,callback()},callback)})()},this.close=function(){var self=this;return runner.run(function(){if(self._db)return Platform.async(function(callback){self._db.close(function(){self._db=void 0,callback()},callback)})()})},this.defineTable=function(tableDefinition){var self=this;return runner.run(function(){return storeHelper.validateTableDefinition(tableDefinition),tableDefinition=JSON.parse(JSON.stringify(tableDefinition)),self._init().then(function(){return Platform.async(function(callback){self._db.transaction(function(transaction){var pragmaStatement=_.format("PRAGMA table_info({0});",tableDefinition.name);transaction.executeSql(pragmaStatement,[],function(transaction,result){if(result.rows.length>0){for(var existingColumns={},i=0;i<result.rows.length;i++){existingColumns[result.rows.item(i).name.toLowerCase()]=!0}addMissingColumns(transaction,tableDefinition,existingColumns)}else createTable(transaction,tableDefinition)})},callback,function(result){var error;try{storeHelper.addTableDefinition(tableDefinitions,tableDefinition)}catch(err){error=err}callback(error)})})()})})},this.upsert=function(tableName,data){var self=this;return runner.run(function(){return Platform.async(function(callback){self._db.transaction(function(transaction){self._upsert(transaction,tableName,data)},callback,callback)})()})},this._upsert=function(transaction,tableName,data){Validate.isObject(transaction),Validate.notNull(transaction),Validate.isString(tableName,"tableName"),Validate.notNullOrEmpty(tableName,"tableName");var tableDefinition=storeHelper.getTableDefinition(tableDefinitions,tableName);if(_.isNull(tableDefinition))throw new Error('Definition not found for table "'+tableName+'"');if(!_.isNull(data)){Validate.isObject(data);var records;records=_.isArray(data)?data:[data];for(var i=0;i<records.length;i++)_.isNull(records[i])||(Validate.isValidId(storeHelper.getId(records[i]),"records["+i+"]."+idPropertyName),records[i]=sqliteSerializer.serialize(records[i],tableDefinition.columnDefinitions));if(tableDefinition.columnDefinitions.length>999)throw new Error("Number of table columns cannot be more than 999");var record,statements=[],parameters=[],insertColumnNames=[],insertParams=[],insertValues=[],updateColumnNames=[],updateExpressions=[],updateValues=[];for(i=0;i<records.length;i++)if(!_.isNull(records[i])){record=records[i],insertColumnNames=[],insertParams=[],insertValues=[],updateColumnNames=[],updateExpressions=[],updateValues=[];for(var property in record)insertColumnNames.push(property),insertParams.push("?"),insertValues.push(record[property]),storeHelper.isId(property)||(updateColumnNames.push(property),updateExpressions.push(property+" = ?"),updateValues.push(record[property]));statements.push(_.format("INSERT OR IGNORE INTO {0} ({1}) VALUES ({2})",tableName,insertColumnNames.join(),insertParams.join())),parameters.push(insertValues),updateValues.length>0&&(statements.push(_.format("UPDATE {0} SET {1} WHERE {2} = ?",tableName,updateExpressions.join(),idPropertyName)),updateValues.push(storeHelper.getId(record)),parameters.push(updateValues))}for(i=0;i<statements.length;i++)this._editStatement&&(statements[i]=this._editStatement(statements[i])),transaction.executeSql(statements[i],parameters[i])}},this.lookup=function(tableName,id,suppressRecordNotFoundError){var self=this;return runner.run(function(){Validate.isString(tableName,"tableName"),Validate.notNullOrEmpty(tableName,"tableName"),Validate.isValidId(id,"id");var tableDefinition=storeHelper.getTableDefinition(tableDefinitions,tableName);if(_.isNull(tableDefinition))throw new Error('Definition not found for table "'+tableName+'"');var lookupStatement=_.format("SELECT * FROM [{0}] WHERE {1} = ? COLLATE NOCASE",tableName,idPropertyName);return Platform.async(function(callback){self._db.executeSql(lookupStatement,[id],function(result){var error,record;try{if(0!==result.rows.length&&(record=result.rows.item(0)),record)record=sqliteSerializer.deserialize(record,tableDefinition.columnDefinitions);else if(!suppressRecordNotFoundError)throw new Error('Item with id "'+id+'" does not exist.')}catch(err){error=err}error?callback(error):callback(null,record)},callback)})()})},this.del=function(tableNameOrQuery,ids){var self=this;return runner.run(function(){return Platform.async(function(callback){if(Validate.notNull(tableNameOrQuery),_.isString(tableNameOrQuery))Validate.notNullOrEmpty(tableNameOrQuery,"tableNameOrQuery"),_.isArray(ids)||(ids=[ids]),self._db.transaction(function(transaction){for(var i=0;i<ids.length;i++)_.isNull(ids[i])||Validate.isValidId(ids[i]);self._deleteIds(transaction,tableNameOrQuery,ids)},callback,callback);else{if(!_.isObject(tableNameOrQuery))throw _.format(Platform.getResourceString("TypeCheckError"),"tableNameOrQuery","Object or String",typeof tableNameOrQuery);self._deleteUsingQuery(tableNameOrQuery,callback)}})()})},this._deleteUsingQuery=function(query,callback){var self=this,components=query.getComponents();components.selections=[idPropertyName],query.setComponents(components);var tableName=components.table;Validate.isString(tableName),Validate.notNullOrEmpty(tableName);var tableDefinition=storeHelper.getTableDefinition(tableDefinitions,tableName)
;if(_.isNull(tableDefinition))throw new Error('Definition not found for table "'+tableName+'"');var statements=getSqlStatementsFromQuery(query);if(statements.length<1||statements.length>2)throw new Error("Unexpected number of statements");self._db.transaction(function(transaction){var deleteStatement=_.format("DELETE FROM [{0}] WHERE [{1}] in ({2})",tableName,idPropertyName,statements[0].sql);transaction.executeSql(deleteStatement,getStatementParameters(statements[0]))},callback,callback)},this._deleteIds=function(transaction,tableName,ids){for(var deleteExpressions=[],deleteParams=[],i=0;i<ids.length;i++)_.isNull(ids[i])||(deleteExpressions.push("?"),deleteParams.push(ids[i]));var deleteStatement=_.format("DELETE FROM {0} WHERE {1} in ({2})",tableName,idPropertyName,deleteExpressions.join());this._editStatement&&(deleteStatement=this._editStatement(deleteStatement)),transaction.executeSql(deleteStatement,deleteParams)},this.read=function(query){return runner.run(function(){return Validate.notNull(query,"query"),Validate.isObject(query,"query"),this._read(query)}.bind(this))},this._read=function(query){return Platform.async(function(callback){var tableDefinition=storeHelper.getTableDefinition(tableDefinitions,query.getComponents().table);if(_.isNull(tableDefinition))throw new Error('Definition not found for table "'+query.getComponents().table+'"');var count,result=[],statements=getSqlStatementsFromQuery(query);this._db.transaction(function(transaction){if(statements.length<1||statements.length>2)throw new Error("Unexpected number of statements");transaction.executeSql(statements[0].sql,getStatementParameters(statements[0]),function(transaction,res){for(var record,j=0;j<res.rows.length;j++)record=sqliteSerializer.deserialize(res.rows.item(j),tableDefinition.columnDefinitions),result.push(record)}),2===statements.length&&transaction.executeSql(statements[1].sql,getStatementParameters(statements[1]),function(transaction,res){count=res.rows.item(0).count})},callback,function(){void 0!==count&&(result={result:result,count:count}),callback(null,result)})}.bind(this))()},this.executeBatch=function(operations){var self=this;return runner.run(function(){return Validate.isArray(operations),Platform.async(function(callback){self._db.transaction(function(transaction){for(var i=0;i<operations.length;i++){var operation=operations[i];if(!_.isNull(operation))if(Validate.isString(operation.action),Validate.notNullOrEmpty(operation.action),Validate.isString(operation.tableName),Validate.notNullOrEmpty(operation.tableName),"upsert"===operation.action.toLowerCase())self._upsert(transaction,operation.tableName,operation.data);else{if("delete"!==operation.action.toLowerCase())throw new Error(_.format("Operation '{0}' is not supported",operation.action));_.isNull(operation.id)||(Validate.isValidId(operation.id),self._deleteIds(transaction,operation.tableName,[operation.id]))}}},callback,callback)})()})}};MobileServiceSqliteStore.ColumnType=ColumnType,module.exports=MobileServiceSqliteStore},{".":69,"../../Utilities/Extensions":82,"../../Utilities/Validate":85,"../../Utilities/taskRunner":86,"../../sync/ColumnType":90,"./sqliteSerializer":71,"./storeHelper":72,"azure-odata-sql":9,"azure-query-js":19}],69:[function(_dereq_,module,exports){var browserExports=_dereq_("../web");for(var i in browserExports)exports[i]=browserExports[i]},{"../web":77}],70:[function(_dereq_,module,exports){module.exports={MobileServiceSqliteStore:_dereq_("./MobileServiceSqliteStore")}},{"./MobileServiceSqliteStore":68}],71:[function(_dereq_,module,exports){function getSqliteType(columnType){var sqliteType;switch(columnType){case ColumnType.Object:case ColumnType.Array:case ColumnType.String:case ColumnType.Text:sqliteType="TEXT";break;case ColumnType.Integer:case ColumnType.Int:case ColumnType.Boolean:case ColumnType.Bool:case ColumnType.Date:sqliteType="INTEGER";break;case ColumnType.Real:case ColumnType.Float:sqliteType="REAL";break;default:throw new Error("Column type "+columnType+" is not supported")}return sqliteType}function isJSValueCompatibleWithColumnType(value,columnType){if(_.isNull(value))return!0;switch(columnType){case ColumnType.Object:return _.isObject(value);case ColumnType.Array:return _.isArray(value);case ColumnType.String:case ColumnType.Text:return!0;case ColumnType.Boolean:case ColumnType.Bool:case ColumnType.Integer:case ColumnType.Int:return _.isBool(value)||_.isInteger(value);case ColumnType.Date:return _.isDate(value);case ColumnType.Real:case ColumnType.Float:return _.isNumber(value);default:return!1}}function isSqliteValueCompatibleWithColumnType(value,columnType){if(_.isNull(value))return!0;switch(columnType){case ColumnType.Object:case ColumnType.Array:return _.isString(value);case ColumnType.String:case ColumnType.Text:return _.isString(value);case ColumnType.Boolean:case ColumnType.Bool:return _.isInteger(value);case ColumnType.Integer:case ColumnType.Int:case ColumnType.Date:return _.isInteger(value);case ColumnType.Real:case ColumnType.Float:return _.isNumber(value);default:return!1}}function isColumnTypeValid(type){for(var key in ColumnType)if(ColumnType[key]===type)return!0;return!1}function serialize(value,columnDefinitions){var serializedValue={};try{Validate.notNull(columnDefinitions,"columnDefinitions"),Validate.isObject(columnDefinitions),Validate.notNull(value),Validate.isObject(value);for(var property in value){var columnType=storeHelper.getColumnType(columnDefinitions,property);_.isNull(columnType)||(serializedValue[property]=serializeMember(value[property],columnType))}}catch(error){throw new verror.VError(error,"Failed to serialize value "+JSON.stringify(value)+". Column definitions: "+JSON.stringify(columnDefinitions))}return serializedValue}function deserialize(value,columnDefinitions){var deserializedValue={};try{Validate.notNull(columnDefinitions,"columnDefinitions"),Validate.isObject(columnDefinitions),Validate.notNull(value),Validate.isObject(value);for(var property in value){deserializedValue[storeHelper.getColumnName(columnDefinitions,property)]=deserializeMember(value[property],storeHelper.getColumnType(columnDefinitions,property))}}catch(error){throw new verror.VError(error,"Failed to deserialize value "+JSON.stringify(value)+". Column definitions: "+JSON.stringify(columnDefinitions))}return deserializedValue}function serializeMember(value,columnType){if(!isColumnTypeValid(columnType))throw new Error("Column type "+columnType+" is not supported");if(!isJSValueCompatibleWithColumnType(value,columnType))throw new Error("Converting value "+JSON.stringify(value)+" of type "+typeof value+" to type "+columnType+" is not supported.");var serializedValue,sqliteType=getSqliteType(columnType);switch(sqliteType){case"TEXT":serializedValue=typeConverter.convertToText(value);break;case"INTEGER":serializedValue=typeConverter.convertToInteger(value);break;case"REAL":serializedValue=typeConverter.convertToReal(value);break;default:throw new Error("Column type "+columnType+" is not supported")}return serializedValue}function deserializeMember(value,columnType){if(!columnType)return value;if(!isColumnTypeValid(columnType))throw new Error("Column type "+columnType+" is not supported");if(!isSqliteValueCompatibleWithColumnType(value,columnType))throw new Error("Converting value "+JSON.stringify(value)+" of type "+typeof value+" to type "+columnType+" is not supported.");var deserializedValue;switch(columnType){case ColumnType.Object:deserializedValue=typeConverter.convertToObject(value);break;case ColumnType.Array:deserializedValue=typeConverter.convertToArray(value);break;case ColumnType.String:case ColumnType.Text:deserializedValue=typeConverter.convertToText(value);break;case ColumnType.Integer:case ColumnType.Int:deserializedValue=typeConverter.convertToInteger(value);break;case ColumnType.Boolean:case ColumnType.Bool:deserializedValue=typeConverter.convertToBoolean(value);break;case ColumnType.Date:deserializedValue=typeConverter.convertToDate(value);break;case ColumnType.Real:case ColumnType.Float:deserializedValue=typeConverter.convertToReal(value);break;default:throw new Error(_.format(Platform.getResourceString("sqliteSerializer_UnsupportedColumnType"),columnType))}return deserializedValue}function serializeValue(value){var type;return type=_.isNull(value)?ColumnType.Object:_.isNumber(value)?ColumnType.Real:_.isDate(value)?ColumnType.Date:_.isBool(value)?ColumnType.Boolean:_.isString(value)?ColumnType.String:_.isArray(value)?ColumnType.Array:(_.isObject(value),ColumnType.Object),serializeMember(value,type)}var Platform=_dereq_("."),Validate=_dereq_("../../Utilities/Validate"),_=_dereq_("../../Utilities/Extensions"),ColumnType=_dereq_("../../sync/ColumnType"),storeHelper=_dereq_("./storeHelper"),verror=_dereq_("verror"),typeConverter=_dereq_("./typeConverter");exports.serialize=serialize,exports.serializeValue=serializeValue,exports.deserialize=deserialize,exports.getSqliteType=getSqliteType},{".":69,"../../Utilities/Extensions":82,"../../Utilities/Validate":85,"../../sync/ColumnType":90,"./storeHelper":72,"./typeConverter":73,verror:60}],72:[function(_dereq_,module,exports){function validateTableDefinition(tableDefinition){Validate.notNull(tableDefinition,"tableDefinition"),Validate.isObject(tableDefinition,"tableDefinition"),Validate.isString(tableDefinition.name,"tableDefinition.name"),Validate.notNullOrEmpty(tableDefinition.name,"tableDefinition.name");var columnDefinitions=tableDefinition.columnDefinitions,definedColumns={};Validate.isObject(columnDefinitions),Validate.notNull(columnDefinitions);for(var columnName in columnDefinitions){if(Validate.isString(columnDefinitions[columnName],"columnType"),Validate.notNullOrEmpty(columnDefinitions[columnName],"columnType"),definedColumns[columnName.toLowerCase()])throw new Error("Duplicate definition for column "+columnName+'" in table "'+tableDefinition.name+'"');definedColumns[columnName.toLowerCase()]=!0}}function addTableDefinition(tableDefinitions,tableDefinition){Validate.isObject(tableDefinitions),Validate.notNull(tableDefinitions),validateTableDefinition(tableDefinition),tableDefinitions[tableDefinition.name.toLowerCase()]=tableDefinition}function getTableDefinition(tableDefinitions,tableName){return Validate.isObject(tableDefinitions),Validate.notNull(tableDefinitions),Validate.isString(tableName),Validate.notNullOrEmpty(tableName),tableDefinitions[tableName.toLowerCase()]}function getColumnType(columnDefinitions,columnName){Validate.isObject(columnDefinitions),Validate.notNull(columnDefinitions),Validate.isString(columnName),Validate.notNullOrEmpty(columnName);for(var column in columnDefinitions)if(column.toLowerCase()===columnName.toLowerCase())return columnDefinitions[column]}function getColumnName(columnDefinitions,property){Validate.isObject(columnDefinitions),Validate.notNull(columnDefinitions),Validate.isString(property),Validate.notNullOrEmpty(property);for(var column in columnDefinitions)if(column.toLowerCase()===property.toLowerCase())return column;return property}function getId(record){Validate.isObject(record),Validate.notNull(record);for(var property in record)if(property.toLowerCase()===idPropertyName.toLowerCase())return record[property]}function isId(property){return Validate.isString(property),Validate.notNullOrEmpty(property),property.toLowerCase()===idPropertyName.toLowerCase()}var idPropertyName=_dereq_("../../constants").table.idPropertyName,Validate=_dereq_("../../Utilities/Validate");module.exports={addTableDefinition:addTableDefinition,getColumnName:getColumnName,getColumnType:getColumnType,getId:getId,getTableDefinition:getTableDefinition,isId:isId,validateTableDefinition:validateTableDefinition}},{"../../Utilities/Validate":85,"../../constants":87}],73:[function(_dereq_,module,exports){var _=(_dereq_("../../Utilities/Validate"),_dereq_("../../Utilities/Extensions")),verror=_dereq_("verror");exports.convertToText=function(value){return _.isNull(value)?null:_.isString(value)?value:JSON.stringify(value)},exports.convertToInteger=function(value){if(_.isNull(value))return null;if(_.isInteger(value))return value;if(_.isBool(value))return value?1:0;if(_.isDate(value))return value.getTime();throw new Error(_.format(Platform.getResourceString("sqliteSerializer_UnsupportedTypeConversion"),JSON.stringify(value),typeof value,"integer"))},exports.convertToBoolean=function(value){if(_.isNull(value))return null;if(_.isBool(value))return value;if(_.isInteger(value))return 0!==value;throw new Error(_.format(Platform.getResourceString("sqliteSerializer_UnsupportedTypeConversion"),JSON.stringify(value),typeof value,"Boolean"))},exports.convertToDate=function(value){if(_.isNull(value))return null;if(_.isDate(value))return value;if(_.isInteger(value))return new Date(value);throw new Error(_.format(Platform.getResourceString("sqliteSerializer_UnsupportedTypeConversion"),JSON.stringify(value),typeof value,"Date"))},exports.convertToReal=function(value){if(_.isNull(value))return null;if(_.isNumber(value))return value;throw new Error(_.format(Platform.getResourceString("sqliteSerializer_UnsupportedTypeConversion"),JSON.stringify(value),typeof value,"Real"))},exports.convertToObject=function(value){if(_.isNull(value))return null;if(_.isObject(value))return value;var error;try{if(_.isString(value)){var result=JSON.parse(value);if(_.isObject(result))return result}}catch(err){error=err}throw new verror.VError(error,Platform.getResourceString("sqliteSerializer_UnsupportedTypeConversion"),JSON.stringify(value),typeof value,"Object")},exports.convertToArray=function(value){if(_.isNull(value))return null;if(_.isArray(value))return value;var error;try{if(_.isString(value)){var result=JSON.parse(value);if(_.isArray(result))return result}}catch(err){error=err}throw new verror.VError(error,Platform.getResourceString("sqliteSerializer_UnsupportedTypeConversion"),JSON.stringify(value),typeof value,"Array")}},{"../../Utilities/Extensions":82,"../../Utilities/Validate":85,verror:60}],74:[function(_dereq_,module,exports){(function(global){exports.getTarget=function(){return void 0!==global&&global.cordova&&global.cordova.version?"Cordova":void 0!==global?"Web":"Unknown"}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],75:[function(_dereq_,module,exports){var target=_dereq_("./environment").getTarget();if("Cordova"===target)module.exports=_dereq_("./cordova");else{if("Web"!==target)throw new Error("Unsupported target");module.exports=_dereq_("./web")}},{"./cordova":69,"./environment":74,"./web":77}],76:[function(_dereq_,module,exports){var target=_dereq_("./environment").getTarget();if("Cordova"===target)module.exports=_dereq_("./cordova/sdkExports");else{if("Web"!==target)throw new Error("Unsupported target");module.exports=_dereq_("./web/sdkExports")}},{"./cordova/sdkExports":70,"./environment":74,"./web/sdkExports":78}],77:[function(_dereq_,module,exports){function getBestTransport(){return bestAvailableTransport||(bestAvailableTransport=getBestProvider(knownTransports)),bestAvailableTransport}function getBestProvider(providers){for(var i=0;i<providers.length;i++)if(providers[i].supportsCurrentRuntime())return providers[i];throw new Error("Unsupported browser - no suitable providers are available.")}var _=_dereq_("../../Utilities/Extensions"),Validate=_dereq_("../../Utilities/Validate"),Promises=_dereq_("../../Utilities/Promises"),version=_dereq_("../../../../package.json").version,resources=_dereq_("../../resources.json"),environment=_dereq_("../environment"),inMemorySettingStore={};try{var key="___z";localStorage.setItem(key,key),localStorage.removeItem(key),inMemorySettingStore=localStorage}catch(e){}var bestAvailableTransport=null,knownTransports=[_dereq_("../../Transports/DirectAjaxTransport"),_dereq_("../../Transports/IframeTransport")],knownLoginUis=[_dereq_("../../LoginUis/WebAuthBroker"),_dereq_("../../LoginUis/CordovaPopup"),_dereq_("../../LoginUis/BrowserPopup")],isoDateRegex=/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})(?:\.(\d*))?Z$/,dateSerializerOmitsDecimals=!JSON.stringify(new Date(100)).match(/\.100Z"$/);exports.async=function(func){return function(){var that=this,args=arguments;return new Promises.Promise(function(complete,error){var callback=function(err){_.isNull(err)?complete.apply(null,Array.prototype.slice.call(arguments,1)):error(err)};Array.prototype.push.call(args,callback);try{func.apply(that,args)}catch(ex){callback(_.createError(ex))}})}},exports.readSetting=function(name){return inMemorySettingStore[name]},exports.writeSetting=function(name,value){inMemorySettingStore[name]=value},exports.webRequest=function(request,callback){return getBestTransport().performRequest(request,callback)},exports.getUserAgent=function(){return null},exports.getOperatingSystemInfo=function(){return{name:"--",version:"--",architecture:"--"}},exports.getSdkInfo=function(){return{language:environment.getTarget(),fileVersion:version}},exports.login=function(startUri,endUri,callback){var findProtocol=/^[a-z]+:/,requiredProtocol="https:";return startUri=startUri.replace(findProtocol,requiredProtocol),endUri&&(endUri=endUri.replace(findProtocol,requiredProtocol)),getBestProvider(knownLoginUis).login(startUri,endUri,callback)},exports.toJson=function(value){return JSON.stringify(value,function(key,stringifiedValue){if(dateSerializerOmitsDecimals&&this&&_.isDate(this[key])){var msec=this[key].getMilliseconds(),msecString=String(msec+1e3).substring(1);return stringifiedValue.replace(isoDateRegex,function(all,datetime){return datetime+"."+msecString+"Z"})}return stringifiedValue})},exports.tryParseIsoDateString=function(text){Validate.isString(text);var matchedDate=isoDateRegex.exec(text);if(matchedDate){var dateWithoutFraction=matchedDate[1],fraction=matchedDate[2]||"0",milliseconds=Math.round(1e3*Number("0."+fraction));dateWithoutFraction=dateWithoutFraction.replace(/\-/g,"/").replace("T"," ");var ticks=Date.parse(dateWithoutFraction+" UTC");if(!isNaN(ticks))return new Date(ticks+milliseconds)}return null},exports.getResourceString=function(resourceName){return resources[resourceName]},exports.allowPlatformToMutateOriginal=function(original,updated){return updated}},{"../../../../package.json":61,"../../LoginUis/BrowserPopup":62,"../../LoginUis/CordovaPopup":63,"../../LoginUis/WebAuthBroker":64,"../../Transports/DirectAjaxTransport":80,"../../Transports/IframeTransport":81,"../../Utilities/Extensions":82,"../../Utilities/Promises":84,"../../Utilities/Validate":85,"../../resources.json":89,"../environment":74}],78:[function(_dereq_,module,exports){module.exports={}},{}],79:[function(_dereq_,module,exports){function Push(client,installationId){this.client=client,this.installationId=installationId}function executeRequest(client,method,pushChannel,content,installationId,callback){Validate.isString(pushChannel,"pushChannel"),Validate.notNullOrEmpty(pushChannel,"pushChannel");var headers={"If-Modified-Since":"Mon, 27 Mar 1972 00:00:00 GMT"};headers[constants.apiVersionHeaderName]=constants.apiVersion,client._request(method,"push/installations/"+encodeURIComponent(installationId),content,null,headers,callback)}function stringifyTemplateBodies(templates){var result={};for(var templateName in templates)if(templates.hasOwnProperty(templateName)){var template=_.extend({},templates[templateName]);"string"!=typeof template.body&&(template.body=JSON.stringify(template.body)),result[templateName]=template}return result}var Validate=_dereq_("../Utilities/Validate"),Platform=_dereq_("../Platform"),constants=_dereq_("../constants"),_=_dereq_("../Utilities/Extensions");exports.Push=Push,Push.prototype.register=Platform.async(function(platform,pushChannel,templates,secondaryTiles,callback){Validate.isString(platform,"platform"),Validate.notNullOrEmpty(platform,"platform"),_.isNull(callback)&&"function"==typeof templates&&(callback=templates,templates=null),_.isNull(callback)&&"function"==typeof secondaryTiles&&(callback=secondaryTiles,secondaryTiles=null);var requestContent={installationId:this.installationId,pushChannel:pushChannel,platform:platform,templates:stringifyTemplateBodies(templates),secondaryTiles:stringifyTemplateBodies(secondaryTiles)};executeRequest(this.client,"PUT",pushChannel,requestContent,this.installationId,callback)}),Push.prototype.unregister=Platform.async(function(pushChannel,callback){executeRequest(this.client,"DELETE",pushChannel,null,this.installationId,callback)})},{"../Platform":75,"../Utilities/Extensions":82,"../Utilities/Validate":85,"../constants":87}],80:[function(_dereq_,module,exports){(function(global){exports.name="DirectAjaxTransport",exports.supportsCurrentRuntime=function(){return void 0!==global.XMLHttpRequest&&"withCredentials"in new global.XMLHttpRequest},exports.performRequest=function(request,callback){var headers=request.headers||{},url=request.url.replace(/#.*$/,""),httpMethod=request.type?request.type.toUpperCase():"GET",xhr=new global.XMLHttpRequest;xhr.onreadystatechange=function(){4===xhr.readyState&&callback(null,xhr)},xhr.open(httpMethod,url);for(var key in headers)request.headers.hasOwnProperty(key)&&xhr.setRequestHeader(key,request.headers[key]);xhr.send(request.data)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],81:[function(_dereq_,module,exports){(function(global){function fixupAjax(xhr){xhr&&1223===xhr.status&&(xhr.status=204)}function whenBridgeLoaded(originRoot,callback){var cacheEntry=loadBridgeFramePromises[originRoot];cacheEntry||(cacheEntry=loadBridgeFramePromises[originRoot]=new Promises.Promise(function(complete,error){var bridgeFrame=document.createElement("iframe"),callerOrigin=PostMessageExchange.getOriginRoot(window.location.href),handleBridgeLoaded=function(){complete(bridgeFrame)};bridgeFrame.addEventListener?bridgeFrame.addEventListener("load",handleBridgeLoaded,!1):bridgeFrame.attachEvent("onload",handleBridgeLoaded),bridgeFrame.src=originRoot+"/crossdomain/bridge?origin="+encodeURIComponent(callerOrigin),bridgeFrame.setAttribute("width",0),bridgeFrame.setAttribute("height",0),bridgeFrame.style.display="none",global.document.body.appendChild(bridgeFrame)})),cacheEntry.then(callback)}var Promises=_dereq_("../Utilities/Promises"),PostMessageExchange=_dereq_("../Utilities/PostMessageExchange"),loadBridgeFramePromises=[],messageExchange=PostMessageExchange.instance;exports.name="../../Transports/IframeTransport",exports.supportsCurrentRuntime=function(){return void 0!==global.postMessage},exports.performRequest=function(request,callback){var originRoot=PostMessageExchange.getOriginRoot(request.url);whenBridgeLoaded(originRoot,function(bridgeFrame){var message={type:request.type,url:request.url,headers:request.headers,data:request.data};messageExchange.request(bridgeFrame.contentWindow,message,originRoot).then(function(reply){fixupAjax(reply),callback(null,reply)},function(error){callback(error,null)})})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../Utilities/PostMessageExchange":83,"../Utilities/Promises":84}],82:[function(_dereq_,module,exports){function classOf(value){return Object.prototype.toString.call(value).slice(8,-1).toLowerCase()}var Validate=_dereq_("./Validate"),Platform=_dereq_("../Platform"),_=exports;exports.isNull=function(value){return null===value||void 0===value},exports.isNullOrZero=function(value){return null===value||void 0===value||0===value||""===value},exports.isNullOrEmpty=function(value){return _.isNull(value)||0===value.length},exports.format=function(message){if(Validate.isString(message,"message"),!_.isNullOrEmpty(message)&&arguments.length>1)for(var i=1;i<arguments.length;i++)for(var pattern="{"+(i-1)+"}";-1!==message.indexOf(pattern);)message=message.replace(pattern,arguments[i]);return message},exports.has=function(value,key){return Validate.notNull(key,"key"),Validate.isString(key,"key"),!_.isNull(value)&&value.hasOwnProperty(key)},exports.hasProperty=function(object,properties){for(var i=0;i<properties.length;i++)if(_.has(object,properties[i]))return!0;return!1},exports.extend=function(target,members){for(var member in members)members.hasOwnProperty(member)&&(target[member]=members[member]);return target},exports.isObject=function(value){return _.isNull(value)||"object"==typeof value&&!_.isDate(value)},exports.isValidId=function(value){if(_.isNullOrZero(value))return!1;if(_.isString(value)){if(0===value.length||value.length>255||0===value.trim().length)return!1;var ex=/[+"\/?`\\]|[\u0000-\u001F]|[\u007F-\u009F]|^\.{1,2}$/;return null===value.match(ex)}return!!_.isNumber(value)&&value>0},exports.isString=function(value){return _.isNull(value)||"string"==typeof value},exports.isNumber=function(value){return!_.isNull(value)&&"number"==typeof value},exports.isInteger=function(value){return _.isNumber(value)&&parseInt(value,10)===parseFloat(value)},exports.isBool=function(value){return!_.isNull(value)&&"boolean"==typeof value},exports.isFunction=function(value){return"function"==typeof value},exports.isArray=function(value){return!_.isNull(value)&&value.constructor===Array},exports.isDate=function(value){return!_.isNull(value)&&"date"==classOf(value)},exports.toJson=function(value){return Platform.toJson(value)},exports.fromJson=function(value){var jsonValue=null;return _.isNullOrEmpty(value)||(jsonValue=JSON.parse(value,function(k,v){if(_.isString(v)&&!_.isNullOrEmpty(v)){var date=exports.tryParseIsoDateString(v);if(!_.isNull(date))return date}return v})),jsonValue},exports.createUniqueInstallationId=function(){var pad4=function(str){return"0000".substring(str.length)+str},hex4=function(){return pad4(Math.floor(65536*Math.random()).toString(16))};return hex4()+hex4()+"-"+hex4()+"-"+hex4()+"-"+hex4()+"-"+hex4()+hex4()+hex4()},exports.mapProperties=function(instance,action){var results=[];if(!_.isNull(instance)){var key=null;for(key in instance)results.push(action(key,instance[key]))}return results},exports.pad=function(value,length,ch){Validate.notNull(value,"value"),Validate.isInteger(length,"length"),Validate.isString(ch,"ch"),Validate.notNullOrEmpty(ch,"ch"),Validate.length(ch,1,"ch");for(var text=value.toString();text.length<length;)text=ch+text;return text},exports.trimEnd=function(text,ch){Validate.isString(text,"text"),Validate.notNull(text,"text"),Validate.isString(ch,"ch"),Validate.notNullOrEmpty("ch","ch"),Validate.length(ch,1,"ch");for(var end=text.length-1;end>=0&&text[end]===ch;)end--;return end>=0?text.substr(0,end+1):""},exports.trimStart=function(text,ch){Validate.isString(text,"text"),Validate.notNull(text,"text"),Validate.isString(ch,"ch"),Validate.notNullOrEmpty(ch,"ch"),Validate.length(ch,1,"ch");for(var start=0;start<text.length&&text[start]===ch;)start++;return start<text.length?text.substr(start,text.length-start):""},exports.compareCaseInsensitive=function(first,second){return _.isString(first)&&!_.isNullOrEmpty(first)&&(first=first.toUpperCase()),_.isString(first)&&!_.isNullOrEmpty(second)&&(second=second.toUpperCase()),first===second},exports.url={separator:"/",combinePathSegments:function(){var segments=[],i=0;for(Validate.notNullOrEmpty(arguments,"arguments"),i=0;i<arguments.length;i++){var segment=arguments[i];Validate.isString(segment,_.format("argument[{0}]",i)),0!==i&&(segment=_.trimStart(segment||"",_.url.separator)),i<arguments.length-1&&(segment=_.trimEnd(segment||"",_.url.separator)),segments.push(segment)}return segments.reduce(function(a,b){return a+_.url.separator+b})},getQueryString:function(parameters){Validate.notNull(parameters,"parameters"),Validate.isObject(parameters,"parameters");var pairs=[];for(var parameter in parameters){var value=parameters[parameter];exports.isObject(value)&&(value=exports.toJson(value)),pairs.push(encodeURIComponent(parameter)+"="+encodeURIComponent(value))}return pairs.join("&")},combinePathAndQuery:function(path,queryString){return Validate.notNullOrEmpty(path,"path"),Validate.isString(path,"path"),_.isNullOrEmpty(queryString)?path:(Validate.isString(queryString,"queryString"),path.indexOf("?")>=0?path+"&"+exports.trimStart(queryString,"?"):path+"?"+exports.trimStart(queryString,"?"))},isAbsoluteUrl:function(url){if(_.isNullOrEmpty(url))return!1;var start=url.substring(0,7).toLowerCase();return"http://"==start||"https:/"==start},isHttps:function(url){return!_.isNullOrEmpty(url)&&"https:/"==url.substring(0,7).toLowerCase()}},exports.tryParseIsoDateString=function(text){return Platform.tryParseIsoDateString(text)},exports.createError=function(exceptionOrMessage,request){var error;if(request){var message=Platform.getResourceString("Extensions_DefaultErrorMessage");if(0===request.status)message=Platform.getResourceString("Extensions_ConnectionFailureMessage");else{var isText=!1;if(request.getResponseHeader){var contentType=request.getResponseHeader("Content-Type");contentType&&(isText=contentType.toLowerCase().indexOf("text")>=0)}try{var response=JSON.parse(request.responseText);message="string"==typeof response?response:response.error||response.description||request.statusText||Platform.getResourceString("Extensions_DefaultErrorMessage")}catch(ex){message=isText?request.responseText:request.statusText||Platform.getResourceString("Extensions_DefaultErrorMessage")}}error=new Error(message),error.request=request}else _.isString(exceptionOrMessage)&&!_.isNullOrEmpty(exceptionOrMessage)?error=new Error(exceptionOrMessage):exceptionOrMessage instanceof Error?error=exceptionOrMessage:(error=new Error(Platform.getResourceString("Extensions_DefaultErrorMessage")),_.isNull(exceptionOrMessage)||(error.exception=exceptionOrMessage));return error}},{"../Platform":75,"./Validate":85}],83:[function(_dereq_,module,exports){(function(global){function PostMessageExchange(){var self=this;self._lastMessageId=0,self._hasListener=!1,self._pendingMessages={}}function getOriginRoot(url){var parsedUrl=parseUrl(url),portString=parsedUrl.port?parsedUrl.port.toString():null,isDefaultPort="http:"===parsedUrl.protocol&&"80"===portString||"https:"===parsedUrl.protocol&&"443"===portString,portSuffix=portString&&!isDefaultPort?":"+portString:"";return parsedUrl.protocol+"//"+parsedUrl.hostname+portSuffix}function parseUrl(url){var elem=global.document.createElement("a");return elem.href=url,elem}var Promises=_dereq_("./Promises");PostMessageExchange.prototype.request=function(targetWindow,messageData,origin){var self=this,messageId=++self._lastMessageId,envelope={messageId:messageId,contents:messageData};return self._ensureHasListener(),new Promises.Promise(function(complete,error){self._pendingMessages[messageId]={messageId:messageId,complete:complete,error:error,targetWindow:targetWindow,origin:origin},self._pendingMessages[messageId].timeoutId=global.setTimeout(function(){var pendingMessage=self._pendingMessages[messageId];pendingMessage&&(delete self._pendingMessages[messageId],pendingMessage.error({status:0,statusText:"Timeout",responseText:null}))},3e5),targetWindow.postMessage(JSON.stringify(envelope),origin)})},PostMessageExchange.prototype._ensureHasListener=function(){if(!this._hasListener){this._hasListener=!0;var self=this,boundHandleMessage=function(){self._handleMessage.apply(self,arguments)};window.addEventListener?window.addEventListener("message",boundHandleMessage,!1):window.attachEvent("onmessage",boundHandleMessage)}},PostMessageExchange.prototype._handleMessage=function(evt){var envelope=this._tryDeserializeMessage(evt.data),messageId=envelope&&envelope.messageId,pendingMessage=messageId&&this._pendingMessages[messageId];pendingMessage&&pendingMessage.targetWindow===evt.source&&pendingMessage.origin===getOriginRoot(evt.origin)&&(global.clearTimeout(pendingMessage.timeoutId),delete this._pendingMessages[messageId],pendingMessage.complete(envelope.contents))},PostMessageExchange.prototype._tryDeserializeMessage=function(messageString){
if(!messageString||"string"!=typeof messageString)return null;try{return JSON.parse(messageString)}catch(ex){return null}},exports.instance=new PostMessageExchange,exports.getOriginRoot=getOriginRoot}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Promises":84}],84:[function(_dereq_,module,exports){!function(exports){"use strict";function Promise(init){this._callbackFrames=[],this._resolutionState=null,this._resolutionValueOrError=null,this._resolveSuccess=bind(this._resolveSuccess,this),this._resolveError=bind(this._resolveError,this),init&&init(this._resolveSuccess,this._resolveError)}var resolutionState={success:{},error:{}},bind=function(func,target){return function(){func.apply(target,arguments)}},isGenericPromise=function(obj){return obj&&"function"==typeof obj.then};Promise.prototype.then=function(success,error){var callbackFrame={success:success,error:error,chainedPromise:new Promise};return this._resolutionState?this._invokeCallback(callbackFrame):this._callbackFrames.push(callbackFrame),callbackFrame.chainedPromise},Promise.prototype._resolveSuccess=function(val){this._resolve(resolutionState.success,val)},Promise.prototype._resolveError=function(err){this._resolve(resolutionState.error,err)},Promise.prototype._resolve=function(state,valueOrError){if(!this._resolutionState){this._resolutionState=state,this._resolutionValueOrError=valueOrError;for(var i=0,j=this._callbackFrames.length;i<j;i++)this._invokeCallback(this._callbackFrames[i])}},Promise.prototype._invokeCallback=function(frame){var callbackToInvoke=this._resolutionState===resolutionState.success?frame.success:frame.error;"function"==typeof callbackToInvoke?setTimeout(bind(function(){var passthroughValue,passthroughState,callbackDidNotThrow=!0;try{passthroughValue=callbackToInvoke(this._resolutionValueOrError),passthroughState=resolutionState.success}catch(ex){callbackDidNotThrow=!1,passthroughValue=ex,passthroughState=resolutionState.error}callbackDidNotThrow&&isGenericPromise(passthroughValue)?passthroughValue.then(frame.chainedPromise._resolveSuccess,frame.chainedPromise._resolveError):frame.chainedPromise._resolve(passthroughState,passthroughValue)},this),1):frame.chainedPromise._resolve(this._resolutionState,this._resolutionValueOrError)},Promise.prototype.done=function(success,error){this.then(success,error).then(null,function(err){setTimeout(function(){throw new Error(err)},1)})},exports.Promise=Promise}(exports)},{}],85:[function(_dereq_,module,exports){var _=_dereq_("./Extensions"),Platform=_dereq_("../Platform");exports.notNull=function(value,name){if(_.isNull(value))throw _.format(Platform.getResourceString("Validate_NotNullError"),name||"Value")},exports.notNullOrEmpty=function(value,name){if(_.isNullOrEmpty(value))throw _.format(Platform.getResourceString("Validate_NotNullOrEmptyError"),name||"Value")},exports.notNullOrZero=function(value,name){if(_.isNullOrZero(value))throw _.format(Platform.getResourceString("Validate_NotNullOrEmptyError"),name||"Value")},exports.isValidId=function(value,name){if(!_.isValidId(value))throw new Error((name||"id")+' "'+value+'" is not valid.')},exports.isDate=function(value,name){if(exports.notNull(value,name),!_.isDate(value))throw _.format(Platform.getResourceString("TypeCheckError"),name||"Value","Date",typeof value)},exports.isNumber=function(value,name){if(exports.notNull(value,name),!_.isNumber(value))throw _.format(Platform.getResourceString("TypeCheckError"),name||"Value","Number",typeof value)},exports.isFunction=function(value,name){if(!_.isFunction(value))throw _.format(Platform.getResourceString("TypeCheckError"),name||"Value","Function",typeof value)},exports.isValidParametersObject=function(value,name){exports.notNull(value,name),exports.isObject(value,name);for(var parameter in value)if(0===parameter.indexOf("$"))throw _.format(Platform.getResourceString("Validate_InvalidUserParameter"),name,parameter)},exports.isInteger=function(value,name){if(exports.notNull(value,name),exports.isNumber(value,name),parseInt(value,10)!==parseFloat(value))throw _.format(Platform.getResourceString("TypeCheckError"),name||"Value","number",typeof value)},exports.isBool=function(value,name){if(!_.isBool(value))throw _.format(Platform.getResourceString("TypeCheckError"),name||"Value","number",typeof value)},exports.isString=function(value,name){if(!_.isString(value))throw _.format(Platform.getResourceString("TypeCheckError"),name||"Value","string",typeof value)},exports.isObject=function(value,name){if(!_.isObject(value))throw _.format(Platform.getResourceString("TypeCheckError"),name||"Value","object",typeof value)},exports.isArray=function(value,name){if(!Array.isArray(value))throw _.format(Platform.getResourceString("TypeCheckError"),name||"Value","array",typeof value)},exports.length=function(value,length,name){if(exports.notNull(value,name),exports.isInteger(length,"length"),value.length!==length)throw _.format(Platform.getResourceString("Validate_LengthUnexpected"),name||"Value",length,value.length)}},{"../Platform":75,"./Extensions":82}],86:[function(_dereq_,module,exports){var Validate=_dereq_("./Validate"),Platform=_dereq_("../Platform");module.exports=function(){function run(task){return Platform.async(function(callback){Validate.isFunction(task),Validate.isFunction(callback),queue.push({task:task,callback:callback}),processTask()})()}function processTask(){setTimeout(function(){if(!isBusy&&0!==queue.length){isBusy=!0;var next=queue.shift();Platform.async(function(callback){callback()})().then(function(){return next.task()}).then(function(res){isBusy=!1,processTask(),next.callback(null,res)},function(err){isBusy=!1,processTask(),next.callback(err)})}},0)}var isBusy,queue=[];return{run:run}}},{"../Platform":75,"./Validate":85}],87:[function(_dereq_,module,exports){module.exports={featuresHeaderName:"X-ZUMO-FEATURES",features:{JsonApiCall:"AJ",GenericApiCall:"AG",AdditionalQueryParameters:"QS",OptimisticConcurrency:"OC",TableRefreshCall:"RF",TableReadRaw:"TR",TableReadQuery:"TQ",OfflineSync:"OL",IncrementalPull:"IP"},apiVersionHeaderName:"ZUMO-API-VERSION",apiVersion:"2.0.0",table:{idPropertyName:"id",sysProps:{deletedColumnName:"deleted",createdAtColumnName:"createdAt",updatedAtColumnName:"updatedAt",versionColumnName:"version"},includeDeletedFlag:"__includeDeleted",operationTableName:"__operations",pulltimeTableName:"__pulltime"}}},{}],88:[function(_dereq_,module,exports){var _=_dereq_("./Utilities/Extensions"),api={MobileServiceClient:_dereq_("./MobileServiceClient"),Query:_dereq_("azure-query-js").Query},targetExports=_dereq_("./Platform/sdkExports");for(var i in targetExports){if(!_.isNull(api[i]))throw new Error("Cannot export definition "+i+" outside the SDK. Multiple definitions with the same name exist");api[i]=targetExports[i]}module.exports=api},{"./MobileServiceClient":65,"./Platform/sdkExports":76,"./Utilities/Extensions":82,"azure-query-js":19}],89:[function(_dereq_,module,exports){module.exports={TypeCheckError:"'{0}' is expected to be a value of type {1}, not {2}.",Validate_NotNullError:"{0} cannot be null.",Validate_NotNullOrEmptyError:"{0} cannot be null or empty.",Validate_LengthUnexpected:"{0} is expected to have length {1}, not {2}.",Validate_InvalidUserParameter:"{0} contains an invalid user-defined query string parameter: {1}. User-defined query string parameters must not begin with a '$'.",Extensions_DefaultErrorMessage:"Unexpected failure.",Extensions_ConnectionFailureMessage:"Unexpected connection failure.",MobileServiceTable_ReadMismatchedQueryTables:"Cannot get the results of a query for table '{1}' via table '{0}'.",MobileServiceLogin_AuthenticationProviderNotSupported:"Unsupported authentication provider name. Please specify one of {0}.",MobileServiceLogin_InvalidResponseFormat:"Invalid format of the authentication response.",MobileServiceLogin_InvalidProvider:"The first parameter must be the name of the authentication provider or a Microsoft Account authentication token.",MobileServiceTable_NotSingleObject:"Could not get object from response {0}.",Push_ConflictWithReservedName:"Template name conflicts with reserved name '{0}'.",Push_InvalidTemplateName:"Template name can't contain ';' or ':'.",Push_NotSupportedXMLFormatAsBodyTemplateWin8:"The bodyTemplate is not in accepted XML format. The first node of the bodyTemplate should be Badge/Tile/Toast, except for the wns/raw template, which need to be a valid XML.",Push_BodyTemplateMustBeXml:"Valid XML is required for any template without a raw header.",Push_TagNoCommas:"Tags must not contain ','.",sqliteSerializer_SerializationFailed:"Failed to serialize value {0}. Column definition: {1}",sqliteSerializer_DeserializationFailed:"Failed to deserialize value {0}. Column definition: {1}",sqliteSerializer_UnsupportedColumnType:"Column type '{0}' is not supported",sqliteSerializer_UnsupportedTypeConversion:"Converting value {0} of type {1} to type {2} is not supported"}},{}],90:[function(_dereq_,module,exports){module.exports={Object:"object",Array:"array",Integer:"integer",Int:"int",Float:"float",Real:"real",String:"string",Text:"text",Boolean:"boolean",Bool:"bool",Date:"date"}},{}],91:[function(_dereq_,module,exports){function MobileServiceSyncContext(client){function upsertWithLogging(tableName,instance,action,shouldOverwrite){if(Validate.isString(tableName,"tableName"),Validate.notNullOrEmpty(tableName,"tableName"),Validate.notNull(instance,"instance"),Validate.isValidId(instance.id,"instance.id"),!store)throw new Error("MobileServiceSyncContext not initialized");return store.lookup(tableName,instance.id,!0).then(function(existingRecord){if(existingRecord&&!shouldOverwrite)throw new Error("Record with id "+existingRecord.id+" already exists in the table "+tableName)}).then(function(){return operationTableManager.getLoggingOperation(tableName,action,instance)}).then(function(loggingOperation){return store.executeBatch([{action:"upsert",tableName:tableName,data:instance},loggingOperation])}).then(function(){return instance})}function validateInitialization(){if(!isInitialized)throw new Error("MobileServiceSyncContext is being used before it is initialized")}Validate.notNull(client,"client");var store,operationTableManager,pullManager,pushManager,purgeManager,isInitialized=!1,syncTaskRunner=taskRunner(),storeTaskRunner=taskRunner();this.initialize=function(localStore){return Platform.async(function(callback){Validate.isObject(localStore),Validate.notNull(localStore),callback(null,createOperationTableManager(localStore))})().then(function(opManager){return operationTableManager=opManager,operationTableManager.initialize(localStore)}).then(function(){store=localStore,pullManager=createPullManager(client,store,storeTaskRunner,operationTableManager),pushManager=createPushManager(client,store,storeTaskRunner,operationTableManager),purgeManager=createPurgeManager(store,storeTaskRunner)}).then(function(){return pullManager.initialize()}).then(function(){isInitialized=!0})},this.insert=function(tableName,instance){return storeTaskRunner.run(function(){return validateInitialization(),_.isNull(instance.id)&&(instance.id=uuid.v4()),upsertWithLogging(tableName,instance,"insert")})},this.update=function(tableName,instance){return storeTaskRunner.run(function(){return validateInitialization(),upsertWithLogging(tableName,instance,"update",!0)})},this.lookup=function(tableName,id,suppressRecordNotFoundError){return Platform.async(function(callback){if(validateInitialization(),Validate.isString(tableName,"tableName"),Validate.notNullOrEmpty(tableName,"tableName"),Validate.isValidId(id,"id"),!store)throw new Error("MobileServiceSyncContext not initialized");callback()})().then(function(){return store.lookup(tableName,id,suppressRecordNotFoundError)})},this.read=function(query){return Platform.async(function(callback){callback()})().then(function(){return validateInitialization(),Validate.notNull(query,"query"),Validate.isObject(query,"query"),store.read(query)})},this.del=function(tableName,instance){return storeTaskRunner.run(function(){if(validateInitialization(),Validate.isString(tableName,"tableName"),Validate.notNullOrEmpty(tableName,"tableName"),Validate.notNull(instance),Validate.isValidId(instance.id),!store)throw new Error("MobileServiceSyncContext not initialized");return operationTableManager.getLoggingOperation(tableName,"delete",instance).then(function(loggingOperation){return store.executeBatch([{action:"delete",tableName:tableName,id:instance.id},loggingOperation])})})},this.pull=function(query,queryId,settings){return syncTaskRunner.run(function(){return validateInitialization(),pullManager.pull(query,queryId,settings)})},this.push=function(){return syncTaskRunner.run(function(){return validateInitialization(),pushManager.push(this.pushHandler)}.bind(this))},this.purge=function(query,forcePurge){return syncTaskRunner.run(function(){return Validate.isObject(query,"query"),Validate.notNull(query,"query"),_.isNull(forcePurge)||Validate.isBool(forcePurge,"forcePurge"),validateInitialization(),purgeManager.purge(query,forcePurge)}.bind(this))},this.pushHandler=void 0,this._getOperationTableManager=function(){return operationTableManager},this._getPurgeManager=function(){return purgeManager}}var Validate=_dereq_("../Utilities/Validate"),Platform=_dereq_("../Platform"),createOperationTableManager=_dereq_("./operations").createOperationTableManager,taskRunner=_dereq_("../Utilities/taskRunner"),createPullManager=_dereq_("./pull").createPullManager,createPushManager=_dereq_("./push").createPushManager,createPurgeManager=_dereq_("./purge").createPurgeManager,uuid=_dereq_("uuid"),_=_dereq_("../Utilities/Extensions");module.exports=MobileServiceSyncContext},{"../Platform":75,"../Utilities/Extensions":82,"../Utilities/Validate":85,"../Utilities/taskRunner":86,"./operations":93,"./pull":94,"./purge":95,"./push":96,uuid:55}],92:[function(_dereq_,module,exports){function MobileServiceSyncTable(tableName,client){Validate.isString(tableName,"tableName"),Validate.notNullOrEmpty(tableName,"tableName"),Validate.notNull(client,"client"),this.getTableName=function(){return tableName},this.getMobileServiceClient=function(){return client},this.insert=function(instance){return client.getSyncContext().insert(tableName,instance)},this.update=function(instance){return client.getSyncContext().update(tableName,instance)},this.lookup=function(id,suppressRecordNotFoundError){return client.getSyncContext().lookup(tableName,id,suppressRecordNotFoundError)},this.read=function(query){return _.isNull(query)&&(query=new Query(tableName)),client.getSyncContext().read(query)},this.del=function(instance){return client.getSyncContext().del(tableName,instance)},this.pull=function(query,queryId,settings){return query||(query=new Query(tableName)),client.getSyncContext().pull(query,queryId,settings)},this.purge=function(query,forcePurge){return query||(query=new Query(tableName)),client.getSyncContext().purge(query,forcePurge)}}var Validate=_dereq_("../Utilities/Validate"),Query=_dereq_("azure-query-js").Query,_=_dereq_("../Utilities/Extensions"),tableHelper=_dereq_("../tableHelper");_dereq_("../Platform");tableHelper.defineQueryOperators(MobileServiceSyncTable),exports.MobileServiceSyncTable=MobileServiceSyncTable},{"../Platform":75,"../Utilities/Extensions":82,"../Utilities/Validate":85,"../tableHelper":98,"azure-query-js":19}],93:[function(_dereq_,module,exports){function createOperationTableManager(store){function initialize(){return store.defineTable({name:operationTableName,columnDefinitions:{id:ColumnType.Integer,tableName:ColumnType.String,action:ColumnType.String,itemId:ColumnType.String,metadata:ColumnType.Object}}).then(function(){return getMaxOperationId()}).then(function(id){maxId=id,isInitialized=!0})}function lockOperation(id){return runner.run(function(){if(lockedOperationId!==id){if(!lockedOperationId)return void(lockedOperationId=id);throw new Error("Only one operation can be locked at a time")}})}function unlockOperation(){return runner.run(function(){lockedOperationId=void 0})}function getLoggingOperation(tableName,action,item){return runner.run(function(){if(Validate.notNull(tableName),Validate.isString(tableName),Validate.notNull(action),Validate.isString(action),Validate.notNull(item),Validate.isObject(item),Validate.isValidId(item[idPropertyName]),!isInitialized)throw new Error("Operation table manager is not initialized");return readPendingOperations(tableName,item[idPropertyName]).then(function(pendingOperations){var condenseAction,pendingOperation=pendingOperations.pop();if("add"===(condenseAction=pendingOperation?getCondenseAction(pendingOperation,action):"add"))return getOperationForInsertingLog(tableName,action,item);if("modify"===condenseAction)return getOperationForUpdatingLog(pendingOperation.id,tableName,action,item);if("remove"===condenseAction)return getOperationForDeletingLog(pendingOperation.id);if("nop"!==condenseAction)throw new Error("Unknown condenseAction: "+condenseAction)})})}function readPendingOperations(tableName,itemId){return Platform.async(function(callback){callback()})().then(function(){var query=new Query(operationTableName);return store.read(query.where(function(tableName,itemId){return this.tableName===tableName&&this.itemId===itemId},tableName,itemId).orderBy("id"))})}function readFirstPendingOperationWithData(lastProcessedOperationId){return runner.run(function(){return readFirstPendingOperationWithDataInternal(lastProcessedOperationId)})}function removeLockedOperation(){return removePendingOperation(lockedOperationId).then(function(){return unlockOperation()})}function isLocked(operation){return operation&&operation.id===lockedOperationId}function readFirstPendingOperationWithDataInternal(lastProcessedOperationId){var logRecord,query=new Query(operationTableName).where(function(lastProcessedOperationId){return this.id>lastProcessedOperationId},lastProcessedOperationId).orderBy("id").take(1);return store.read(query).then(function(result){if(1!==result.length){if(0===result.length)return;throw new Error("Something is wrong!")}logRecord=result[0]}).then(function(){if(logRecord)return"delete"===logRecord.action?{logRecord:logRecord}:store.lookup(logRecord.tableName,logRecord.itemId,!0).then(function(data){return data?{logRecord:logRecord,data:data}:removePendingOperationInternal(logRecord.id).then(function(){return lastProcessedOperationId=logRecord.id,readFirstPendingOperationWithDataInternal(lastProcessedOperationId)})})})}function removePendingOperation(id){return runner.run(function(){return removePendingOperationInternal(id)})}function removePendingOperationInternal(id){return Platform.async(function(callback){callback()})().then(function(){if(!id)throw new Error("Invalid operation id");return store.del(operationTableName,id)})}function getCondenseAction(pendingOperation,newAction){var condenseAction,pendingAction=pendingOperation.action;if("insert"===pendingAction&&"update"===newAction)condenseAction="nop";else if("insert"===pendingAction&&"delete"===newAction)condenseAction="remove";else if("update"===pendingAction&&"update"===newAction)condenseAction="nop";else if("update"===pendingAction&&"delete"===newAction)condenseAction="modify";else{if("delete"!==pendingAction||"delete"!==newAction)throw"delete"===pendingAction?new Error("Operation "+newAction+" not supported as a DELETE operation is pending"):new Error("Condense not supported when pending action is "+pendingAction+" and new action is "+newAction);condenseAction="nop"}return isLocked(pendingOperation)&&(condenseAction="add"),condenseAction}function getOperationForInsertingLog(tableName,action,item){return api.getMetadata(tableName,action,item).then(function(metadata){return{tableName:operationTableName,action:"upsert",data:{id:++maxId,tableName:tableName,action:action,itemId:item[idPropertyName],metadata:metadata}}})}function getOperationForUpdatingLog(operationId,tableName,action,item){return api.getMetadata(tableName,action,item).then(function(metadata){return{tableName:operationTableName,action:"upsert",data:{id:operationId,action:action,metadata:metadata}}})}function getOperationForDeletingLog(operationId){return{tableName:operationTableName,action:"delete",id:operationId}}function getMetadata(tableName,action,item){return Platform.async(function(callback){callback()})().then(function(){var metadata={};if("upsert"===action||"insert"===action||"update"===action&&item.hasOwnProperty(versionColumnName))return metadata[versionColumnName]=item[versionColumnName],metadata;if("update"==action||"delete"===action)return store.lookup(tableName,item[idPropertyName],!0).then(function(result){return result&&(metadata[versionColumnName]=result[versionColumnName]),metadata});throw new Error("Invalid action "+action)})}function getMaxOperationId(){var query=new Query(operationTableName);return store.read(query.orderByDescending("id").take(1)).then(function(result){if(Validate.isArray(result),0===result.length)return 0;if(1===result.length)return result[0].id;throw new Error("something is wrong!")})}Validate.isObject(store),Validate.notNull(store);var isInitialized,lockedOperationId,maxId,runner=taskRunner(),api={initialize:initialize,lockOperation:lockOperation,unlockOperation:unlockOperation,readPendingOperations:readPendingOperations,readFirstPendingOperationWithData:readFirstPendingOperationWithData,removeLockedOperation:removeLockedOperation,getLoggingOperation:getLoggingOperation,getMetadata:getMetadata};return api._getOperationForInsertingLog=getOperationForInsertingLog,api._getOperationForUpdatingLog=getOperationForUpdatingLog,api}var Validate=_dereq_("../Utilities/Validate"),Platform=_dereq_("../Platform"),ColumnType=_dereq_("./ColumnType"),taskRunner=_dereq_("../Utilities/taskRunner"),tableConstants=_dereq_("../constants").table,Query=(_dereq_("../Utilities/Extensions"),_dereq_("azure-query-js").Query),idPropertyName=tableConstants.idPropertyName,versionColumnName=tableConstants.sysProps.versionColumnName,operationTableName=tableConstants.operationTableName;module.exports={createOperationTableManager:createOperationTableManager}},{"../Platform":75,"../Utilities/Extensions":82,"../Utilities/Validate":85,"../Utilities/taskRunner":86,"../constants":87,"./ColumnType":90,"azure-query-js":19}],94:[function(_dereq_,module,exports){function createPullManager(client,store,storeTaskRunner,operationTableManager){function initialize(){return pullTaskRunner.run(function(){return store.defineTable({name:pulltimeTableName,columnDefinitions:{id:"string",tableName:"string",value:"date"}})})}function pull(query,queryId,settings){return pullTaskRunner.run(function(){if(validateQuery(query,"query"),Validate.isString(queryId,"queryId"),Validate.isObject(settings,"settings"),settings=settings||{},_.isNull(settings.pageSize))pageSize=defaultPageSize;else{if(!(_.isInteger(settings.pageSize)&&settings.pageSize>0))throw new Error("Page size must be a positive integer. Page size "+settings.pageSize+" is invalid.");pageSize=settings.pageSize}return tablePullQuery=copyQuery(query),mobileServiceTable=client.getTable(tablePullQuery.getComponents().table),mobileServiceTable._features=queryId?[constants.features.OfflineSync,constants.features.IncrementalPull]:[constants.features.OfflineSync],pullQueryId=queryId,setupQuery().then(function(){return pullAllPages()})})}function setupQuery(){return getLastKnownUpdatedAt().then(function(updatedAt){buildQueryFromLastKnownUpdateAt(updatedAt)})}function pullAllPages(){return pullPage().then(function(pulledRecords){if(!isPullComplete(pulledRecords))return updateQueryForNextPage(pulledRecords).then(function(){return pullAllPages()})})}function isPullComplete(pulledRecords){return 0===pulledRecords.length}function pullPage(){var params={};params[tableConstants.includeDeletedFlag]=!0;var pulledRecords,queryString=pagePullQuery.toOData(),tableName=pagePullQuery.getComponents().table;return queryString=queryString.replace(new RegExp("^/"+tableName),"").replace("datetime'","datetimeoffset'"),mobileServiceTable.read(queryString,params).then(function(result){pulledRecords=result||[];for(var chain=Platform.async(function(callback){callback()})(),i=0;i<pulledRecords.length;i++)chain=processPulledRecord(chain,tableName,pulledRecords[i]);return chain}).then(function(pulled){return onPagePulled()}).then(function(){return pulledRecords})}function processPulledRecord(chain,tableName,pulledRecord){return chain.then(function(){return storeTaskRunner.run(function(){if(Validate.isValidId(pulledRecord[idPropertyName]))throw new Error("Pulled record does not have a valid ID");return operationTableManager.readPendingOperations(tableName,pulledRecord[idPropertyName]).then(function(pendingOperations){if(!(pendingOperations.length>0)){if(!0===pulledRecord[sysProps.deletedColumnName])return store.del(tableName,pulledRecord.id);if(!1===pulledRecord[sysProps.deletedColumnName])return store.upsert(tableName,pulledRecord);throw new Error("'"+sysProps.deletedColumnName+"' system property is missing. Pull cannot work without it.'")}})})})}function getLastKnownUpdatedAt(){return Platform.async(function(callback){callback()})().then(function(){if(pullQueryId)return store.lookup(pulltimeTableName,pullQueryId,!0)}).then(function(result){return result?result.value:new Date(1970,0,0)})}function updateQueryForNextPage(pulledRecords){return Platform.async(function(callback){callback()})().then(function(){if(!pulledRecords)throw new Error("Something is wrong. pulledRecords cannot be null at this point");var lastRecord=pulledRecords[pulledRecords.length-1];if(!lastRecord)throw new Error("Something is wrong. Possibly invalid response from the server. lastRecord cannot be null!");var lastRecordTime=lastRecord[tableConstants.sysProps.updatedAtColumnName];if(!_.isDate(lastRecordTime))throw new Error("Property "+tableConstants.sysProps.updatedAtColumnName+" of the last record should be a valid date");lastRecordTime.getTime()===lastKnownUpdatedAt.getTime()?pagePullQuery.skip(pagePullQuery.getComponents().skip+pulledRecords.length):buildQueryFromLastKnownUpdateAt(lastRecordTime)})}function buildQueryFromLastKnownUpdateAt(updatedAt){lastKnownUpdatedAt=updatedAt,pagePullQuery=copyQuery(tablePullQuery),pagePullQuery=pagePullQuery.where(function(lastKnownUpdatedAt){return this.updatedAt>=lastKnownUpdatedAt},lastKnownUpdatedAt),pagePullQuery.orderBy(tableConstants.sysProps.updatedAtColumnName),pagePullQuery.take(pageSize)}function onPagePulled(){if(pullQueryId)return store.upsert(pulltimeTableName,{id:pullQueryId,tableName:pagePullQuery.getComponents().table,value:lastKnownUpdatedAt})}function validateQuery(query){Validate.isObject(query),Validate.notNull(query);var components=query.getComponents();for(var i in components.ordering)throw new Error("orderBy and orderByDescending clauses are not supported in the pull query");if(components.skip)throw new Error("skip is not supported in the pull query");if(components.take)throw new Error("take is not supported in the pull query");if(components.selections&&0!==components.selections.length)throw new Error("select is not supported in the pull query");if(components.includeTotalCount)throw new Error("includeTotalCount is not supported in the pull query")}function copyQuery(query){var components=query.getComponents(),queryCopy=new Query(components.table);return queryCopy.setComponents(components),queryCopy}var mobileServiceTable,pageSize,lastKnownUpdatedAt,tablePullQuery,pagePullQuery,pullQueryId,pullTaskRunner=taskRunner();return{initialize:initialize,pull:pull}}var Validate=_dereq_("../Utilities/Validate"),Query=_dereq_("azure-query-js").Query,Platform=_dereq_("../Platform"),taskRunner=_dereq_("../Utilities/taskRunner"),constants=(_dereq_("../MobileServiceTable"),_dereq_("../constants")),tableConstants=constants.table,_=_dereq_("../Utilities/Extensions"),defaultPageSize=50,idPropertyName=tableConstants.idPropertyName,pulltimeTableName=tableConstants.pulltimeTableName,sysProps=tableConstants.sysProps;exports.createPullManager=createPullManager},{"../MobileServiceTable":67,"../Platform":75,"../Utilities/Extensions":82,"../Utilities/Validate":85,"../Utilities/taskRunner":86,"../constants":87,"azure-query-js":19}],95:[function(_dereq_,module,exports){function createPurgeManager(store,storeTaskRunner){function purge(query,forcePurge){return storeTaskRunner.run(function(){Validate.isObject(query,"query"),Validate.notNull(query,"query"),_.isNull(forcePurge)||Validate.isBool(forcePurge,"forcePurge");var operationQuery=new Query(tableConstants.operationTableName).where(function(tableName){return this.tableName===tableName},query.getComponents().table),incrementalSyncStateQuery=new Query(tableConstants.pulltimeTableName).where(function(tableName){return this.tableName===tableName},query.getComponents().table);return Platform.async(function(callback){callback()})().then(function(){return forcePurge?store.del(operationQuery):store.read(operationQuery).then(function(operations){if(operations.length>0)throw new Error("Cannot purge the table as it contains pending operations")})}).then(function(){return store.del(incrementalSyncStateQuery)}).then(function(){return store.del(query)})})}return{purge:purge}}var Validate=_dereq_("../Utilities/Validate"),Query=_dereq_("azure-query-js").Query,Platform=_dereq_("../Platform"),tableConstants=(_dereq_("../Utilities/taskRunner"),_dereq_("../MobileServiceTable"),_dereq_("../constants").table),_=_dereq_("../Utilities/Extensions");exports.createPurgeManager=createPurgeManager},{"../MobileServiceTable":67,"../Platform":75,"../Utilities/Extensions":82,"../Utilities/Validate":85,"../Utilities/taskRunner":86,"../constants":87,"azure-query-js":19}],96:[function(_dereq_,module,exports){function createPushManager(client,store,storeTaskRunner,operationTableManager){function push(handler){return pushTaskRunner.run(function(){return reset(),pushHandler=handler,pushAllOperations().then(function(){return pushConflicts})})}function reset(){lastProcessedOperationId=-1,lastFailedOperationId=-1,retryCount=0,pushConflicts=[]}function pushAllOperations(){var pushError;return readAndLockFirstPendingOperation().then(function(pendingOperation){if(pendingOperation){var currentOperation=pendingOperation;return pushOperation(currentOperation).then(function(){return removeLockedOperation()},function(error){return unlockPendingOperation().then(function(){if(pushError=createPushError(store,operationTableManager,storeTaskRunner,currentOperation,error),lastFailedOperationId!==currentOperation.logRecord.id&&(lastFailedOperationId=currentOperation.logRecord.id,retryCount=0),retryCount<maxRetryCount)return++retryCount,handlePushError(pushError,pushHandler)})}).then(function(){if(pushError){if(pushError&&!pushError.isHandled){if(!pushError.isConflict())throw new verror.VError(pushError.getError(),"Push failed while pushing operation for tableName : "+currentOperation.logRecord.tableName+", action: "+currentOperation.logRecord.action+", and record ID: "+currentOperation.logRecord.itemId);lastProcessedOperationId=currentOperation.logRecord.id,pushConflicts.push(pushError)}}else lastProcessedOperationId=currentOperation.logRecord.id}).then(function(){return pushAllOperations()})}})}function readAndLockFirstPendingOperation(){return storeTaskRunner.run(function(){var pendingOperation;return operationTableManager.readFirstPendingOperationWithData(lastProcessedOperationId).then(function(operation){if(pendingOperation=operation)return operationTableManager.lockOperation(pendingOperation.logRecord.id)}).then(function(){return pendingOperation})})}function unlockPendingOperation(){return storeTaskRunner.run(function(){return operationTableManager.unlockOperation()})}function removeLockedOperation(){return storeTaskRunner.run(function(){return operationTableManager.removeLockedOperation()})}function pushOperation(operation){return Platform.async(function(callback){callback()
})().then(function(){}).then(function(){var mobileServiceTable=client.getTable(operation.logRecord.tableName);switch(mobileServiceTable._features=[constants.features.OfflineSync],operation.logRecord.action){case"insert":return removeSysProps(operation.data),mobileServiceTable.insert(operation.data).then(function(result){return store.upsert(operation.logRecord.tableName,result)});case"update":return mobileServiceTable.update(operation.data).then(function(result){return store.upsert(operation.logRecord.tableName,result)});case"delete":return operation.logRecord.metadata=operation.logRecord.metadata||{},mobileServiceTable.del({id:operation.logRecord.itemId,version:operation.logRecord.metadata.version});default:throw new Error("Unsupported action "+operation.logRecord.action)}}).then(function(){})}function removeSysProps(record){for(var i in sysProps)delete record[sysProps[i]]}var lastProcessedOperationId,pushConflicts,lastFailedOperationId,retryCount,pushHandler,pushTaskRunner=taskRunner(),maxRetryCount=5;return{push:push}}var verror=(_dereq_("../Utilities/Validate"),_dereq_("azure-query-js").Query,_dereq_("verror")),Platform=_dereq_("../Platform"),taskRunner=_dereq_("../Utilities/taskRunner"),constants=(_dereq_("../MobileServiceTable"),_dereq_("../constants")),sysProps=(constants.table,_dereq_("../constants").table.sysProps),createPushError=_dereq_("./pushError").createPushError,handlePushError=_dereq_("./pushError").handlePushError;_dereq_("../Utilities/Extensions");exports.createPushManager=createPushManager},{"../MobileServiceTable":67,"../Platform":75,"../Utilities/Extensions":82,"../Utilities/Validate":85,"../Utilities/taskRunner":86,"../constants":87,"./pushError":97,"azure-query-js":19,verror:60}],97:[function(_dereq_,module,exports){function createPushError(store,operationTableManager,storeTaskRunner,pushOperation,operationError){function getTableName(){return makeCopy(pushOperation.logRecord.tableName)}function getAction(){return makeCopy(pushOperation.logRecord.action)}function getServerRecord(){return makeCopy(serverRecord)}function getClientRecord(){return makeCopy(pushOperation.data)}function getError(){return operationError}function isConflict(){return 409===statusCode||412===statusCode}function cancelAndUpdate(newValue){var self=this;return storeTaskRunner.run(function(){if("delete"===pushOperation.logRecord.action)throw new Error("Cannot update a deleted record");if(_.isNull(newValue))throw new Error("Need a valid object to update the record");if(!_.isValidId(newValue.id))throw new Error("Invalid ID: "+newValue.id);if(newValue.id!==pushOperation.data.id)throw new Error("Only updating the record being pushed is allowed");var dataUpdateOperation={tableName:pushOperation.logRecord.tableName,action:"upsert",data:newValue},logDeleteOperation={tableName:operationTableName,action:"delete",id:pushOperation.logRecord.id},operations=[dataUpdateOperation,logDeleteOperation];return store.executeBatch(operations).then(function(){self.isHandled=!0})})}function cancelAndDiscard(){var self=this;return storeTaskRunner.run(function(){var dataDeleteOperation={tableName:pushOperation.logRecord.tableName,action:"delete",id:pushOperation.logRecord.itemId},logDeleteOperation={tableName:operationTableName,action:"delete",id:pushOperation.logRecord.id},operations=[dataDeleteOperation,logDeleteOperation];return store.executeBatch(operations).then(function(){self.isHandled=!0})})}function update(newValue){var self=this;return storeTaskRunner.run(function(){if("delete"===pushOperation.logRecord.action)throw new Error("Cannot update a deleted record");if(_.isNull(newValue))throw new Error("Need a valid object to update the record");if(!_.isValidId(newValue.id))throw new Error("Invalid ID: "+newValue.id);if(newValue.id!==pushOperation.data.id)throw new Error("Only updating the record being pushed is allowed");return operationTableManager.getMetadata(pushOperation.logRecord.tableName,"upsert",newValue).then(function(metadata){return pushOperation.logRecord.metadata=metadata,store.executeBatch([{tableName:operationTableName,action:"upsert",data:pushOperation.logRecord},{tableName:pushOperation.logRecord.tableName,action:"upsert",data:newValue}]).then(function(){self.isHandled=this})})})}function changeAction(newAction,newClientRecord){var self=this;return storeTaskRunner.run(function(){var dataOperation,logOperation={tableName:operationTableName,action:"upsert",data:makeCopy(pushOperation.logRecord)};if(newClientRecord){if(!newClientRecord.id)throw new Error("New client record value must specify the record ID");if(newClientRecord.id!==pushOperation.logRecord.itemId)throw new Error("New client record value cannot change the record ID. Original ID: "+pushOperation.logRecord.id+" New ID: "+newClientRecord.id);logOperation.data.metadata=logOperation.data.metadata||{},logOperation.data.metadata[tableConstants.sysProps.versionColumnName]=newClientRecord[tableConstants.sysProps.versionColumnName]}if("insert"===newAction||"update"===newAction){var oldAction=logOperation.data.action;if(logOperation.data.action=newAction,newClientRecord)dataOperation={tableName:pushOperation.logRecord.tableName,action:"upsert",data:newClientRecord};else if("insert"!==oldAction&&"update"!==oldAction)throw new Error("Changing action from "+oldAction+" to "+newAction+" without specifying a value for the associated record is not allowed!")}else{if("delete"!==newAction&&"del"!==newAction)throw new Error("Action "+newAction+" not supported.");logOperation.data.action="delete",dataOperation={tableName:pushOperation.logRecord.tableName,action:"delete",id:pushOperation.logRecord.id}}return store.executeBatch([logOperation,dataOperation]).then(function(){self.isHandled=!0})})}function cancel(){var self=this;return storeTaskRunner.run(function(){return store.del(operationTableName,pushOperation.logRecord.id).then(function(){self.isHandled=!0})})}var serverRecord=makeCopy(operationError.serverInstance),statusCode=makeCopy(operationError.request.status);return{isHandled:!1,getError:getError,isConflict:isConflict,getTableName:getTableName,getAction:getAction,getServerRecord:getServerRecord,getClientRecord:getClientRecord,cancelAndUpdate:cancelAndUpdate,cancelAndDiscard:cancelAndDiscard,cancel:cancel,update:update,changeAction:changeAction}}function makeCopy(value){return _.isNull(value)||(value=JSON.parse(JSON.stringify(value))),value}function handlePushError(pushError,pushHandler){return Platform.async(function(callback){callback()})().then(function(){if(pushError.isConflict()){if(pushHandler&&pushHandler.onConflict)return pushHandler.onConflict(pushError)}else if(pushHandler&&pushHandler.onError)return pushHandler.onError(pushError)}).then(void 0,function(error){pushError.isHandled=!1})}var Platform=_dereq_("../Platform"),_=_dereq_("../Utilities/Extensions"),tableConstants=_dereq_("../constants").table,operationTableName=tableConstants.operationTableName;tableConstants.sysProps.deletedColumnName;exports.createPushError=createPushError,exports.handlePushError=handlePushError},{"../Platform":75,"../Utilities/Extensions":82,"../constants":87}],98:[function(_dereq_,module,exports){function defineQueryOperators(table){for(var i=0;i<queryOperators.length;i++)copyOperator(table,queryOperators[i])}var Query=_dereq_("azure-query-js").Query,queryOperators=(_dereq_("./Platform"),["where","select","orderBy","orderByDescending","skip","take","includeTotalCount"]),copyOperator=function(table,operator){table.prototype[operator]=function(){var table=this,query=new Query(table.getTableName());return query.read=function(parameters){return table.read(query,parameters)},query[operator].apply(query,arguments)}};exports.defineQueryOperators=defineQueryOperators},{"./Platform":75,"azure-query-js":19}]},{},[88])(88)});